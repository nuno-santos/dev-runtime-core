{"default":{"cguid":"1","type":"0","version":"0.1","description":"description of VertxProtoStub","objectName":"NodejsProtoStub","sourcePackageURL":"/sourcePackage","sourcePackage":{"sourceCode":"KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCl9fSkoZnVuY3Rpb24oKXt2YXIgZGVmaW5lLG1vZHVsZSxleHBvcnRzO3JldHVybiAoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitvKyInIik7dGhyb3cgZi5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwpewovLyBOb2RlIEpTIFByb3RvU3R1YgoKInVzZSBzdHJpY3QiOwoKIShmdW5jdGlvbiAodCkgewogIGlmICgib2JqZWN0IiA9PSB0eXBlb2YgZXhwb3J0cyAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgbW9kdWxlKSBtb2R1bGUuZXhwb3J0cyA9IHQoKTtlbHNlIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKFtdLCB0KTtlbHNlIHsKICAgIHZhciBlO2UgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6IHRoaXMsIGUuYWN0aXZhdGUgPSB0KCk7CiAgfQp9KShmdW5jdGlvbiAoKSB7CiAgdmFyIHQ7cmV0dXJuIChmdW5jdGlvbiBlKHQsIG4sIHIpIHsKICAgIGZ1bmN0aW9uIG8ocywgYSkgewogICAgICBpZiAoIW5bc10pIHsKICAgICAgICBpZiAoIXRbc10pIHsKICAgICAgICAgIHZhciBjID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlO2lmICghYSAmJiBjKSByZXR1cm4gYyhzLCAhMCk7aWYgKGkpIHJldHVybiBpKHMsICEwKTt2YXIgcCA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgcyArICInIik7dGhyb3cgKHAuY29kZSA9ICJNT0RVTEVfTk9UX0ZPVU5EIiwgcCk7CiAgICAgICAgfXZhciB1ID0gbltzXSA9IHsgZXhwb3J0czoge30gfTt0W3NdWzBdLmNhbGwodS5leHBvcnRzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIG4gPSB0W3NdWzFdW2VdO3JldHVybiBvKG4gPyBuIDogZSk7CiAgICAgICAgfSwgdSwgdS5leHBvcnRzLCBlLCB0LCBuLCByKTsKICAgICAgfXJldHVybiBuW3NdLmV4cG9ydHM7CiAgICB9Zm9yICh2YXIgaSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHJlcXVpcmUgJiYgcmVxdWlyZSwgcyA9IDA7IHMgPCByLmxlbmd0aDsgcysrKSBvKHJbc10pO3JldHVybiBvOwogIH0pKHsgMTogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGZ1bmN0aW9uIHIodCwgZSwgbikgewogICAgICAgIGZ1bmN0aW9uIHIodCwgbykgewogICAgICAgICAgaWYgKHIuY291bnQgPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJhZnRlciBjYWxsZWQgdG9vIG1hbnkgdGltZXMiKTstLXIuY291bnQsIHQgPyAoaSA9ICEwLCBlKHQpLCBlID0gbikgOiAwICE9PSByLmNvdW50IHx8IGkgfHwgZShudWxsLCBvKTsKICAgICAgICB9dmFyIGkgPSAhMTtyZXR1cm4gbiA9IG4gfHwgbywgci5jb3VudCA9IHQsIDAgPT09IHQgPyBlKCkgOiByOwogICAgICB9ZnVuY3Rpb24gbygpIHt9ZS5leHBvcnRzID0gcjsKICAgIH0sIHt9XSwgMjogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgICAgdmFyIHIgPSB0LmJ5dGVMZW5ndGg7aWYgKChlID0gZSB8fCAwLCBuID0gbiB8fCByLCB0LnNsaWNlKSkgcmV0dXJuIHQuc2xpY2UoZSwgbik7aWYgKCgwID4gZSAmJiAoZSArPSByKSwgMCA+IG4gJiYgKG4gKz0gciksIG4gPiByICYmIChuID0gciksIGUgPj0gciB8fCBlID49IG4gfHwgMCA9PT0gcikpIHJldHVybiBuZXcgQXJyYXlCdWZmZXIoMCk7Zm9yICh2YXIgbyA9IG5ldyBVaW50OEFycmF5KHQpLCBpID0gbmV3IFVpbnQ4QXJyYXkobiAtIGUpLCBzID0gZSwgYSA9IDA7IG4gPiBzOyBzKyssIGErKykgaVthXSA9IG9bc107cmV0dXJuIGkuYnVmZmVyOwogICAgICB9OwogICAgfSwge31dLCAzOiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgZnVuY3Rpb24gcih0KSB7CiAgICAgICAgdCA9IHQgfHwge30sIHRoaXMubXMgPSB0Lm1pbiB8fCAxMDAsIHRoaXMubWF4ID0gdC5tYXggfHwgMWU0LCB0aGlzLmZhY3RvciA9IHQuZmFjdG9yIHx8IDIsIHRoaXMuaml0dGVyID0gdC5qaXR0ZXIgPiAwICYmIHQuaml0dGVyIDw9IDEgPyB0LmppdHRlciA6IDAsIHRoaXMuYXR0ZW1wdHMgPSAwOwogICAgICB9ZS5leHBvcnRzID0gciwgci5wcm90b3R5cGUuZHVyYXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLm1zICogTWF0aC5wb3codGhpcy5mYWN0b3IsIHRoaXMuYXR0ZW1wdHMrKyk7aWYgKHRoaXMuaml0dGVyKSB7CiAgICAgICAgICB2YXIgZSA9IE1hdGgucmFuZG9tKCksCiAgICAgICAgICAgICAgbiA9IE1hdGguZmxvb3IoZSAqIHRoaXMuaml0dGVyICogdCk7dCA9IDAgPT0gKDEgJiBNYXRoLmZsb29yKDEwICogZSkpID8gdCAtIG4gOiB0ICsgbjsKICAgICAgICB9cmV0dXJuIDAgfCBNYXRoLm1pbih0LCB0aGlzLm1heCk7CiAgICAgIH0sIHIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuYXR0ZW1wdHMgPSAwOwogICAgICB9LCByLnByb3RvdHlwZS5zZXRNaW4gPSBmdW5jdGlvbiAodCkgewogICAgICAgIHRoaXMubXMgPSB0OwogICAgICB9LCByLnByb3RvdHlwZS5zZXRNYXggPSBmdW5jdGlvbiAodCkgewogICAgICAgIHRoaXMubWF4ID0gdDsKICAgICAgfSwgci5wcm90b3R5cGUuc2V0Sml0dGVyID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0aGlzLmppdHRlciA9IHQ7CiAgICAgIH07CiAgICB9LCB7fV0sIDQ6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICAhKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgInVzZSBzdHJpY3QiO24uZW5jb2RlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgIHIgPSBuZXcgVWludDhBcnJheShlKSwKICAgICAgICAgICAgICBvID0gci5sZW5ndGgsCiAgICAgICAgICAgICAgaSA9ICIiO2ZvciAobiA9IDA7IG8gPiBuOyBuICs9IDMpIGkgKz0gdFtyW25dID4+IDJdLCBpICs9IHRbKDMgJiByW25dKSA8PCA0IHwgcltuICsgMV0gPj4gNF0sIGkgKz0gdFsoMTUgJiByW24gKyAxXSkgPDwgMiB8IHJbbiArIDJdID4+IDZdLCBpICs9IHRbNjMgJiByW24gKyAyXV07cmV0dXJuIG8gJSAzID09PSAyID8gaSA9IGkuc3Vic3RyaW5nKDAsIGkubGVuZ3RoIC0gMSkgKyAiPSIgOiBvICUgMyA9PT0gMSAmJiAoaSA9IGkuc3Vic3RyaW5nKDAsIGkubGVuZ3RoIC0gMikgKyAiPT0iKSwgaTsKICAgICAgICB9LCBuLmRlY29kZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICByLAogICAgICAgICAgICAgIG8sCiAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgIGEgPSAuNzUgKiBlLmxlbmd0aCwKICAgICAgICAgICAgICBjID0gZS5sZW5ndGgsCiAgICAgICAgICAgICAgcCA9IDA7Ij0iID09PSBlW2UubGVuZ3RoIC0gMV0gJiYgKGEtLSwgIj0iID09PSBlW2UubGVuZ3RoIC0gMl0gJiYgYS0tKTt2YXIgdSA9IG5ldyBBcnJheUJ1ZmZlcihhKSwKICAgICAgICAgICAgICBmID0gbmV3IFVpbnQ4QXJyYXkodSk7Zm9yIChuID0gMDsgYyA+IG47IG4gKz0gNCkgciA9IHQuaW5kZXhPZihlW25dKSwgbyA9IHQuaW5kZXhPZihlW24gKyAxXSksIGkgPSB0LmluZGV4T2YoZVtuICsgMl0pLCBzID0gdC5pbmRleE9mKGVbbiArIDNdKSwgZltwKytdID0gciA8PCAyIHwgbyA+PiA0LCBmW3ArK10gPSAoMTUgJiBvKSA8PCA0IHwgaSA+PiAyLCBmW3ArK10gPSAoMyAmIGkpIDw8IDYgfCA2MyAmIHM7cmV0dXJuIHU7CiAgICAgICAgfTsKICAgICAgfSkoIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iKTsKICAgIH0sIHt9XSwgNTogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIChmdW5jdGlvbiAodCkgewogICAgICAgIGZ1bmN0aW9uIG4odCkgewogICAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB7CiAgICAgICAgICAgIHZhciBuID0gdFtlXTtpZiAobi5idWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgICAgICAgICAgIHZhciByID0gbi5idWZmZXI7aWYgKG4uYnl0ZUxlbmd0aCAhPT0gci5ieXRlTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB2YXIgbyA9IG5ldyBVaW50OEFycmF5KG4uYnl0ZUxlbmd0aCk7by5zZXQobmV3IFVpbnQ4QXJyYXkociwgbi5ieXRlT2Zmc2V0LCBuLmJ5dGVMZW5ndGgpKSwgciA9IG8uYnVmZmVyOwogICAgICAgICAgICAgIH10W2VdID0gcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH1mdW5jdGlvbiByKHQsIGUpIHsKICAgICAgICAgIGUgPSBlIHx8IHt9O3ZhciByID0gbmV3IGkoKTtuKHQpO2ZvciAodmFyIG8gPSAwOyBvIDwgdC5sZW5ndGg7IG8rKykgci5hcHBlbmQodFtvXSk7cmV0dXJuIGUudHlwZSA/IHIuZ2V0QmxvYihlLnR5cGUpIDogci5nZXRCbG9iKCk7CiAgICAgICAgfWZ1bmN0aW9uIG8odCwgZSkgewogICAgICAgICAgcmV0dXJuIG4odCksIG5ldyBCbG9iKHQsIGUgfHwge30pOwogICAgICAgIH12YXIgaSA9IHQuQmxvYkJ1aWxkZXIgfHwgdC5XZWJLaXRCbG9iQnVpbGRlciB8fCB0Lk1TQmxvYkJ1aWxkZXIgfHwgdC5Nb3pCbG9iQnVpbGRlciwKICAgICAgICAgICAgcyA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgdCA9IG5ldyBCbG9iKFsiaGkiXSk7cmV0dXJuIDIgPT09IHQuc2l6ZTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmV0dXJuICExOwogICAgICAgICAgfQogICAgICAgIH0pKCksCiAgICAgICAgICAgIGEgPSBzICYmIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgdCA9IG5ldyBCbG9iKFtuZXcgVWludDhBcnJheShbMSwgMl0pXSk7cmV0dXJuIDIgPT09IHQuc2l6ZTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmV0dXJuICExOwogICAgICAgICAgfQogICAgICAgIH0pKCksCiAgICAgICAgICAgIGMgPSBpICYmIGkucHJvdG90eXBlLmFwcGVuZCAmJiBpLnByb3RvdHlwZS5nZXRCbG9iO2UuZXhwb3J0cyA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gcyA/IGEgPyB0LkJsb2IgOiBvIDogYyA/IHIgOiB2b2lkIDA7CiAgICAgICAgfSkoKTsKICAgICAgfSkuY2FsbCh0aGlzLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHt9KTsKICAgIH0sIHt9XSwgNjogW2Z1bmN0aW9uICh0LCBlLCBuKSB7fSwge31dLCA3OiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgdmFyIHIgPSBbXS5zbGljZTtlLmV4cG9ydHMgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGlmICgoInN0cmluZyIgPT0gdHlwZW9mIGUgJiYgKGUgPSB0W2VdKSwgImZ1bmN0aW9uIiAhPSB0eXBlb2YgZSkpIHRocm93IG5ldyBFcnJvcigiYmluZCgpIHJlcXVpcmVzIGEgZnVuY3Rpb24iKTt2YXIgbiA9IHIuY2FsbChhcmd1bWVudHMsIDIpO3JldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZS5hcHBseSh0LCBuLmNvbmNhdChyLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICAgIH07CiAgICAgIH07CiAgICB9LCB7fV0sIDg6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICByZXR1cm4gdCA/IG8odCkgOiB2b2lkIDA7CiAgICAgIH1mdW5jdGlvbiBvKHQpIHsKICAgICAgICBmb3IgKHZhciBlIGluIHIucHJvdG90eXBlKSB0W2VdID0gci5wcm90b3R5cGVbZV07cmV0dXJuIHQ7CiAgICAgIH1lLmV4cG9ydHMgPSByLCByLnByb3RvdHlwZS5vbiA9IHIucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiB0aGlzLl9jYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3MgfHwge30sICh0aGlzLl9jYWxsYmFja3NbdF0gPSB0aGlzLl9jYWxsYmFja3NbdF0gfHwgW10pLnB1c2goZSksIHRoaXM7CiAgICAgIH0sIHIucHJvdG90eXBlLm9uY2UgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICByLm9mZih0LCBuKSwgZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH12YXIgciA9IHRoaXM7cmV0dXJuIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fSwgbi5mbiA9IGUsIHRoaXMub24odCwgbiksIHRoaXM7CiAgICAgIH0sIHIucHJvdG90eXBlLm9mZiA9IHIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID0gci5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gci5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgaWYgKCh0aGlzLl9jYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3MgfHwge30sIDAgPT0gYXJndW1lbnRzLmxlbmd0aCkpIHJldHVybiB0aGlzLl9jYWxsYmFja3MgPSB7fSwgdGhpczt2YXIgbiA9IHRoaXMuX2NhbGxiYWNrc1t0XTtpZiAoIW4pIHJldHVybiB0aGlzO2lmICgxID09IGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBkZWxldGUgdGhpcy5fY2FsbGJhY2tzW3RdLCB0aGlzO2ZvciAodmFyIHIsIG8gPSAwOyBvIDwgbi5sZW5ndGg7IG8rKykgaWYgKChyID0gbltvXSwgciA9PT0gZSB8fCByLmZuID09PSBlKSkgewogICAgICAgICAgbi5zcGxpY2UobywgMSk7YnJlYWs7CiAgICAgICAgfXJldHVybiB0aGlzOwogICAgICB9LCByLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0aGlzLl9jYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3MgfHwge307dmFyIGUgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksCiAgICAgICAgICAgIG4gPSB0aGlzLl9jYWxsYmFja3NbdF07aWYgKG4pIHsKICAgICAgICAgIG4gPSBuLnNsaWNlKDApO2ZvciAodmFyIHIgPSAwLCBvID0gbi5sZW5ndGg7IG8gPiByOyArK3IpIG5bcl0uYXBwbHkodGhpcywgZSk7CiAgICAgICAgfXJldHVybiB0aGlzOwogICAgICB9LCByLnByb3RvdHlwZS5saXN0ZW5lcnMgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0aGlzLl9jYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3MgfHwge30sIHRoaXMuX2NhbGxiYWNrc1t0XSB8fCBbXTsKICAgICAgfSwgci5wcm90b3R5cGUuaGFzTGlzdGVuZXJzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gISF0aGlzLmxpc3RlbmVycyh0KS5sZW5ndGg7CiAgICAgIH07CiAgICB9LCB7fV0sIDk6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBlLmV4cG9ydHMgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciBuID0gZnVuY3Rpb24gbigpIHt9O24ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIHQucHJvdG90eXBlID0gbmV3IG4oKSwgdC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSB0OwogICAgICB9OwogICAgfSwge31dLCAxMDogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgcmV0dXJuICJXZWJraXRBcHBlYXJhbmNlIiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUgfHwgd2luZG93LmNvbnNvbGUgJiYgKGNvbnNvbGUuZmlyZWJ1ZyB8fCBjb25zb2xlLmV4Y2VwdGlvbiAmJiBjb25zb2xlLnRhYmxlKSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkubWF0Y2goL2ZpcmVmb3hcLyhcZCspLykgJiYgcGFyc2VJbnQoUmVnRXhwLiQxLCAxMCkgPj0gMzE7CiAgICAgIH1mdW5jdGlvbiBvKCkgewogICAgICAgIHZhciB0ID0gYXJndW1lbnRzLAogICAgICAgICAgICBlID0gdGhpcy51c2VDb2xvcnM7aWYgKCh0WzBdID0gKGUgPyAiJWMiIDogIiIpICsgdGhpcy5uYW1lc3BhY2UgKyAoZSA/ICIgJWMiIDogIiAiKSArIHRbMF0gKyAoZSA/ICIlYyAiIDogIiAiKSArICIrIiArIG4uaHVtYW5pemUodGhpcy5kaWZmKSwgIWUpKSByZXR1cm4gdDt2YXIgciA9ICJjb2xvcjogIiArIHRoaXMuY29sb3I7dCA9IFt0WzBdLCByLCAiY29sb3I6IGluaGVyaXQiXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodCwgMSkpO3ZhciBvID0gMCwKICAgICAgICAgICAgaSA9IDA7cmV0dXJuIHRbMF0ucmVwbGFjZSgvJVthLXolXS9nLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgIiUlIiAhPT0gdCAmJiAobysrLCAiJWMiID09PSB0ICYmIChpID0gbykpOwogICAgICAgIH0pLCB0LnNwbGljZShpLCAwLCByKSwgdDsKICAgICAgfWZ1bmN0aW9uIGkoKSB7CiAgICAgICAgcmV0dXJuICJvYmplY3QiID09IHR5cGVvZiBjb25zb2xlICYmIGNvbnNvbGUubG9nICYmIEZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseS5jYWxsKGNvbnNvbGUubG9nLCBjb25zb2xlLCBhcmd1bWVudHMpOwogICAgICB9ZnVuY3Rpb24gcyh0KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIG51bGwgPT0gdCA/IG4uc3RvcmFnZS5yZW1vdmVJdGVtKCJkZWJ1ZyIpIDogbi5zdG9yYWdlLmRlYnVnID0gdDsKICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICB9ZnVuY3Rpb24gYSgpIHsKICAgICAgICB2YXIgdDt0cnkgewogICAgICAgICAgdCA9IG4uc3RvcmFnZS5kZWJ1ZzsKICAgICAgICB9IGNhdGNoIChlKSB7fXJldHVybiB0OwogICAgICB9ZnVuY3Rpb24gYygpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2U7CiAgICAgICAgfSBjYXRjaCAodCkge30KICAgICAgfW4gPSBlLmV4cG9ydHMgPSB0KCIuL2RlYnVnIiksIG4ubG9nID0gaSwgbi5mb3JtYXRBcmdzID0gbywgbi5zYXZlID0gcywgbi5sb2FkID0gYSwgbi51c2VDb2xvcnMgPSByLCBuLnN0b3JhZ2UgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2YgY2hyb21lICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiBjaHJvbWUuc3RvcmFnZSA/IGNocm9tZS5zdG9yYWdlLmxvY2FsIDogYygpLCBuLmNvbG9ycyA9IFsibGlnaHRzZWFncmVlbiIsICJmb3Jlc3RncmVlbiIsICJnb2xkZW5yb2QiLCAiZG9kZ2VyYmx1ZSIsICJkYXJrb3JjaGlkIiwgImNyaW1zb24iXSwgbi5mb3JtYXR0ZXJzLmogPSBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0KTsKICAgICAgfSwgbi5lbmFibGUoYSgpKTsKICAgIH0sIHsgIi4vZGVidWciOiAxMSB9XSwgMTE6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBmdW5jdGlvbiByKCkgewogICAgICAgIHJldHVybiBuLmNvbG9yc1t1KysgJSBuLmNvbG9ycy5sZW5ndGhdOwogICAgICB9ZnVuY3Rpb24gbyh0KSB7CiAgICAgICAgZnVuY3Rpb24gZSgpIHt9ZnVuY3Rpb24gbygpIHsKICAgICAgICAgIHZhciB0ID0gbywKICAgICAgICAgICAgICBlID0gK25ldyBEYXRlKCksCiAgICAgICAgICAgICAgaSA9IGUgLSAocCB8fCBlKTt0LmRpZmYgPSBpLCB0LnByZXYgPSBwLCB0LmN1cnIgPSBlLCBwID0gZSwgbnVsbCA9PSB0LnVzZUNvbG9ycyAmJiAodC51c2VDb2xvcnMgPSBuLnVzZUNvbG9ycygpKSwgbnVsbCA9PSB0LmNvbG9yICYmIHQudXNlQ29sb3JzICYmICh0LmNvbG9yID0gcigpKTt2YXIgcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7c1swXSA9IG4uY29lcmNlKHNbMF0pLCAic3RyaW5nIiAhPSB0eXBlb2Ygc1swXSAmJiAocyA9IFsiJW8iXS5jb25jYXQocykpO3ZhciBhID0gMDtzWzBdID0gc1swXS5yZXBsYWNlKC8lKFthLXolXSkvZywgZnVuY3Rpb24gKGUsIHIpIHsKICAgICAgICAgICAgaWYgKCIlJSIgPT09IGUpIHJldHVybiBlO2ErKzt2YXIgbyA9IG4uZm9ybWF0dGVyc1tyXTtpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgbykgewogICAgICAgICAgICAgIHZhciBpID0gc1thXTtlID0gby5jYWxsKHQsIGkpLCBzLnNwbGljZShhLCAxKSwgYS0tOwogICAgICAgICAgICB9cmV0dXJuIGU7CiAgICAgICAgICB9KSwgImZ1bmN0aW9uIiA9PSB0eXBlb2Ygbi5mb3JtYXRBcmdzICYmIChzID0gbi5mb3JtYXRBcmdzLmFwcGx5KHQsIHMpKTt2YXIgYyA9IG8ubG9nIHx8IG4ubG9nIHx8IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7Yy5hcHBseSh0LCBzKTsKICAgICAgICB9ZS5lbmFibGVkID0gITEsIG8uZW5hYmxlZCA9ICEwO3ZhciBpID0gbi5lbmFibGVkKHQpID8gbyA6IGU7cmV0dXJuIGkubmFtZXNwYWNlID0gdCwgaTsKICAgICAgfWZ1bmN0aW9uIGkodCkgewogICAgICAgIG4uc2F2ZSh0KTtmb3IgKHZhciBlID0gKHQgfHwgIiIpLnNwbGl0KC9bXHMsXSsvKSwgciA9IGUubGVuZ3RoLCBvID0gMDsgciA+IG87IG8rKykgZVtvXSAmJiAodCA9IGVbb10ucmVwbGFjZSgvXCovZywgIi4qPyIpLCAiLSIgPT09IHRbMF0gPyBuLnNraXBzLnB1c2gobmV3IFJlZ0V4cCgiXiIgKyB0LnN1YnN0cigxKSArICIkIikpIDogbi5uYW1lcy5wdXNoKG5ldyBSZWdFeHAoIl4iICsgdCArICIkIikpKTsKICAgICAgfWZ1bmN0aW9uIHMoKSB7CiAgICAgICAgbi5lbmFibGUoIiIpOwogICAgICB9ZnVuY3Rpb24gYSh0KSB7CiAgICAgICAgdmFyIGUsIHI7Zm9yIChlID0gMCwgciA9IG4uc2tpcHMubGVuZ3RoOyByID4gZTsgZSsrKSBpZiAobi5za2lwc1tlXS50ZXN0KHQpKSByZXR1cm4gITE7Zm9yIChlID0gMCwgciA9IG4ubmFtZXMubGVuZ3RoOyByID4gZTsgZSsrKSBpZiAobi5uYW1lc1tlXS50ZXN0KHQpKSByZXR1cm4gITA7cmV0dXJuICExOwogICAgICB9ZnVuY3Rpb24gYyh0KSB7CiAgICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBFcnJvciA/IHQuc3RhY2sgfHwgdC5tZXNzYWdlIDogdDsKICAgICAgfW4gPSBlLmV4cG9ydHMgPSBvLCBuLmNvZXJjZSA9IGMsIG4uZGlzYWJsZSA9IHMsIG4uZW5hYmxlID0gaSwgbi5lbmFibGVkID0gYSwgbi5odW1hbml6ZSA9IHQoIm1zIiksIG4ubmFtZXMgPSBbXSwgbi5za2lwcyA9IFtdLCBuLmZvcm1hdHRlcnMgPSB7fTt2YXIgcCwKICAgICAgICAgIHUgPSAwOwogICAgfSwgeyBtczogMjkgfV0sIDEyOiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgZS5leHBvcnRzID0gdCgiLi9saWIvIik7CiAgICB9LCB7ICIuL2xpYi8iOiAxMyB9XSwgMTM6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBlLmV4cG9ydHMgPSB0KCIuL3NvY2tldCIpLCBlLmV4cG9ydHMucGFyc2VyID0gdCgiZW5naW5lLmlvLXBhcnNlciIpOwogICAgfSwgeyAiLi9zb2NrZXQiOiAxNCwgImVuZ2luZS5pby1wYXJzZXIiOiAyMiB9XSwgMTQ6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICAoZnVuY3Rpb24gKG4pIHsKICAgICAgICBmdW5jdGlvbiByKHQsIGUpIHsKICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiByKSkgcmV0dXJuIG5ldyByKHQsIGUpO2UgPSBlIHx8IHt9LCB0ICYmICJvYmplY3QiID09IHR5cGVvZiB0ICYmIChlID0gdCwgdCA9IG51bGwpLCB0ID8gKHQgPSB1KHQpLCBlLmhvc3RuYW1lID0gdC5ob3N0LCBlLnNlY3VyZSA9ICJodHRwcyIgPT0gdC5wcm90b2NvbCB8fCAid3NzIiA9PSB0LnByb3RvY29sLCBlLnBvcnQgPSB0LnBvcnQsIHQucXVlcnkgJiYgKGUucXVlcnkgPSB0LnF1ZXJ5KSkgOiBlLmhvc3QgJiYgKGUuaG9zdG5hbWUgPSB1KGUuaG9zdCkuaG9zdCksIHRoaXMuc2VjdXJlID0gbnVsbCAhPSBlLnNlY3VyZSA/IGUuc2VjdXJlIDogbi5sb2NhdGlvbiAmJiAiaHR0cHM6IiA9PSBsb2NhdGlvbi5wcm90b2NvbCwgZS5ob3N0bmFtZSAmJiAhZS5wb3J0ICYmIChlLnBvcnQgPSB0aGlzLnNlY3VyZSA/ICI0NDMiIDogIjgwIiksIHRoaXMuYWdlbnQgPSBlLmFnZW50IHx8ICExLCB0aGlzLmhvc3RuYW1lID0gZS5ob3N0bmFtZSB8fCAobi5sb2NhdGlvbiA/IGxvY2F0aW9uLmhvc3RuYW1lIDogImxvY2FsaG9zdCIpLCB0aGlzLnBvcnQgPSBlLnBvcnQgfHwgKG4ubG9jYXRpb24gJiYgbG9jYXRpb24ucG9ydCA/IGxvY2F0aW9uLnBvcnQgOiB0aGlzLnNlY3VyZSA/IDQ0MyA6IDgwKSwgdGhpcy5xdWVyeSA9IGUucXVlcnkgfHwge30sICJzdHJpbmciID09IHR5cGVvZiB0aGlzLnF1ZXJ5ICYmICh0aGlzLnF1ZXJ5ID0gaC5kZWNvZGUodGhpcy5xdWVyeSkpLCB0aGlzLnVwZ3JhZGUgPSAhMSAhPT0gZS51cGdyYWRlLCB0aGlzLnBhdGggPSAoZS5wYXRoIHx8ICIvZW5naW5lLmlvIikucmVwbGFjZSgvXC8kLywgIiIpICsgIi8iLCB0aGlzLmZvcmNlSlNPTlAgPSAhIWUuZm9yY2VKU09OUCwgdGhpcy5qc29ucCA9ICExICE9PSBlLmpzb25wLCB0aGlzLmZvcmNlQmFzZTY0ID0gISFlLmZvcmNlQmFzZTY0LCB0aGlzLmVuYWJsZXNYRFIgPSAhIWUuZW5hYmxlc1hEUiwgdGhpcy50aW1lc3RhbXBQYXJhbSA9IGUudGltZXN0YW1wUGFyYW0gfHwgInQiLCB0aGlzLnRpbWVzdGFtcFJlcXVlc3RzID0gZS50aW1lc3RhbXBSZXF1ZXN0cywgdGhpcy50cmFuc3BvcnRzID0gZS50cmFuc3BvcnRzIHx8IFsicG9sbGluZyIsICJ3ZWJzb2NrZXQiXSwgdGhpcy5yZWFkeVN0YXRlID0gIiIsIHRoaXMud3JpdGVCdWZmZXIgPSBbXSwgdGhpcy5wb2xpY3lQb3J0ID0gZS5wb2xpY3lQb3J0IHx8IDg0MywgdGhpcy5yZW1lbWJlclVwZ3JhZGUgPSBlLnJlbWVtYmVyVXBncmFkZSB8fCAhMSwgdGhpcy5iaW5hcnlUeXBlID0gbnVsbCwgdGhpcy5vbmx5QmluYXJ5VXBncmFkZXMgPSBlLm9ubHlCaW5hcnlVcGdyYWRlcywgdGhpcy5wZXJNZXNzYWdlRGVmbGF0ZSA9ICExICE9PSBlLnBlck1lc3NhZ2VEZWZsYXRlID8gZS5wZXJNZXNzYWdlRGVmbGF0ZSB8fCB7fSA6ICExLCAhMCA9PT0gdGhpcy5wZXJNZXNzYWdlRGVmbGF0ZSAmJiAodGhpcy5wZXJNZXNzYWdlRGVmbGF0ZSA9IHt9KSwgdGhpcy5wZXJNZXNzYWdlRGVmbGF0ZSAmJiBudWxsID09IHRoaXMucGVyTWVzc2FnZURlZmxhdGUudGhyZXNob2xkICYmICh0aGlzLnBlck1lc3NhZ2VEZWZsYXRlLnRocmVzaG9sZCA9IDEwMjQpLCB0aGlzLnBmeCA9IGUucGZ4IHx8IG51bGwsIHRoaXMua2V5ID0gZS5rZXkgfHwgbnVsbCwgdGhpcy5wYXNzcGhyYXNlID0gZS5wYXNzcGhyYXNlIHx8IG51bGwsIHRoaXMuY2VydCA9IGUuY2VydCB8fCBudWxsLCB0aGlzLmNhID0gZS5jYSB8fCBudWxsLCB0aGlzLmNpcGhlcnMgPSBlLmNpcGhlcnMgfHwgbnVsbCwgdGhpcy5yZWplY3RVbmF1dGhvcml6ZWQgPSB2b2lkIDAgPT09IGUucmVqZWN0VW5hdXRob3JpemVkID8gbnVsbCA6IGUucmVqZWN0VW5hdXRob3JpemVkO3ZhciBvID0gIm9iamVjdCIgPT0gdHlwZW9mIG4gJiYgbjtvLmdsb2JhbCA9PT0gbyAmJiBlLmV4dHJhSGVhZGVycyAmJiBPYmplY3Qua2V5cyhlLmV4dHJhSGVhZGVycykubGVuZ3RoID4gMCAmJiAodGhpcy5leHRyYUhlYWRlcnMgPSBlLmV4dHJhSGVhZGVycyksIHRoaXMub3BlbigpOwogICAgICAgIH1mdW5jdGlvbiBvKHQpIHsKICAgICAgICAgIHZhciBlID0ge307Zm9yICh2YXIgbiBpbiB0KSB0Lmhhc093blByb3BlcnR5KG4pICYmIChlW25dID0gdFtuXSk7cmV0dXJuIGU7CiAgICAgICAgfXZhciBpID0gdCgiLi90cmFuc3BvcnRzIiksCiAgICAgICAgICAgIHMgPSB0KCJjb21wb25lbnQtZW1pdHRlciIpLAogICAgICAgICAgICBhID0gdCgiZGVidWciKSgiZW5naW5lLmlvLWNsaWVudDpzb2NrZXQiKSwKICAgICAgICAgICAgYyA9IHQoImluZGV4b2YiKSwKICAgICAgICAgICAgcCA9IHQoImVuZ2luZS5pby1wYXJzZXIiKSwKICAgICAgICAgICAgdSA9IHQoInBhcnNldXJpIiksCiAgICAgICAgICAgIGYgPSB0KCJwYXJzZWpzb24iKSwKICAgICAgICAgICAgaCA9IHQoInBhcnNlcXMiKTtlLmV4cG9ydHMgPSByLCByLnByaW9yV2Vic29ja2V0U3VjY2VzcyA9ICExLCBzKHIucHJvdG90eXBlKSwgci5wcm90b2NvbCA9IHAucHJvdG9jb2wsIHIuU29ja2V0ID0gciwgci5UcmFuc3BvcnQgPSB0KCIuL3RyYW5zcG9ydCIpLCByLnRyYW5zcG9ydHMgPSB0KCIuL3RyYW5zcG9ydHMiKSwgci5wYXJzZXIgPSB0KCJlbmdpbmUuaW8tcGFyc2VyIiksIHIucHJvdG90eXBlLmNyZWF0ZVRyYW5zcG9ydCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBhKCdjcmVhdGluZyB0cmFuc3BvcnQgIiVzIicsIHQpO3ZhciBlID0gbyh0aGlzLnF1ZXJ5KTtlLkVJTyA9IHAucHJvdG9jb2wsIGUudHJhbnNwb3J0ID0gdCwgdGhpcy5pZCAmJiAoZS5zaWQgPSB0aGlzLmlkKTt2YXIgbiA9IG5ldyBpW3RdKHsgYWdlbnQ6IHRoaXMuYWdlbnQsIGhvc3RuYW1lOiB0aGlzLmhvc3RuYW1lLCBwb3J0OiB0aGlzLnBvcnQsIHNlY3VyZTogdGhpcy5zZWN1cmUsIHBhdGg6IHRoaXMucGF0aCwgcXVlcnk6IGUsIGZvcmNlSlNPTlA6IHRoaXMuZm9yY2VKU09OUCwganNvbnA6IHRoaXMuanNvbnAsIGZvcmNlQmFzZTY0OiB0aGlzLmZvcmNlQmFzZTY0LCBlbmFibGVzWERSOiB0aGlzLmVuYWJsZXNYRFIsIHRpbWVzdGFtcFJlcXVlc3RzOiB0aGlzLnRpbWVzdGFtcFJlcXVlc3RzLCB0aW1lc3RhbXBQYXJhbTogdGhpcy50aW1lc3RhbXBQYXJhbSwgcG9saWN5UG9ydDogdGhpcy5wb2xpY3lQb3J0LCBzb2NrZXQ6IHRoaXMsIHBmeDogdGhpcy5wZngsIGtleTogdGhpcy5rZXksIHBhc3NwaHJhc2U6IHRoaXMucGFzc3BocmFzZSwgY2VydDogdGhpcy5jZXJ0LCBjYTogdGhpcy5jYSwgY2lwaGVyczogdGhpcy5jaXBoZXJzLCByZWplY3RVbmF1dGhvcml6ZWQ6IHRoaXMucmVqZWN0VW5hdXRob3JpemVkLCBwZXJNZXNzYWdlRGVmbGF0ZTogdGhpcy5wZXJNZXNzYWdlRGVmbGF0ZSwgZXh0cmFIZWFkZXJzOiB0aGlzLmV4dHJhSGVhZGVycyB9KTtyZXR1cm4gbjsKICAgICAgICB9LCByLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQ7aWYgKHRoaXMucmVtZW1iZXJVcGdyYWRlICYmIHIucHJpb3JXZWJzb2NrZXRTdWNjZXNzICYmIC0xICE9IHRoaXMudHJhbnNwb3J0cy5pbmRleE9mKCJ3ZWJzb2NrZXQiKSkgdCA9ICJ3ZWJzb2NrZXQiO2Vsc2UgewogICAgICAgICAgICBpZiAoMCA9PT0gdGhpcy50cmFuc3BvcnRzLmxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBlID0gdGhpcztyZXR1cm4gdm9pZCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGUuZW1pdCgiZXJyb3IiLCAiTm8gdHJhbnNwb3J0cyBhdmFpbGFibGUiKTsKICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfXQgPSB0aGlzLnRyYW5zcG9ydHNbMF07CiAgICAgICAgICB9dGhpcy5yZWFkeVN0YXRlID0gIm9wZW5pbmciO3RyeSB7CiAgICAgICAgICAgIHQgPSB0aGlzLmNyZWF0ZVRyYW5zcG9ydCh0KTsKICAgICAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNwb3J0cy5zaGlmdCgpLCB2b2lkIHRoaXMub3BlbigpOwogICAgICAgICAgfXQub3BlbigpLCB0aGlzLnNldFRyYW5zcG9ydCh0KTsKICAgICAgICB9LCByLnByb3RvdHlwZS5zZXRUcmFuc3BvcnQgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgYSgic2V0dGluZyB0cmFuc3BvcnQgJXMiLCB0Lm5hbWUpO3ZhciBlID0gdGhpczt0aGlzLnRyYW5zcG9ydCAmJiAoYSgiY2xlYXJpbmcgZXhpc3RpbmcgdHJhbnNwb3J0ICVzIiwgdGhpcy50cmFuc3BvcnQubmFtZSksIHRoaXMudHJhbnNwb3J0LnJlbW92ZUFsbExpc3RlbmVycygpKSwgdGhpcy50cmFuc3BvcnQgPSB0LCB0Lm9uKCJkcmFpbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZS5vbkRyYWluKCk7CiAgICAgICAgICB9KS5vbigicGFja2V0IiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZS5vblBhY2tldCh0KTsKICAgICAgICAgIH0pLm9uKCJlcnJvciIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIGUub25FcnJvcih0KTsKICAgICAgICAgIH0pLm9uKCJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZS5vbkNsb3NlKCJ0cmFuc3BvcnQgY2xvc2UiKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sIHIucHJvdG90eXBlLnByb2JlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICAgIGlmIChoLm9ubHlCaW5hcnlVcGdyYWRlcykgewogICAgICAgICAgICAgIHZhciBlID0gIXRoaXMuc3VwcG9ydHNCaW5hcnkgJiYgaC50cmFuc3BvcnQuc3VwcG9ydHNCaW5hcnk7ZiA9IGYgfHwgZTsKICAgICAgICAgICAgfWYgfHwgKGEoJ3Byb2JlIHRyYW5zcG9ydCAiJXMiIG9wZW5lZCcsIHQpLCB1LnNlbmQoW3sgdHlwZTogInBpbmciLCBkYXRhOiAicHJvYmUiIH1dKSwgdS5vbmNlKCJwYWNrZXQiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmICghZikgaWYgKCJwb25nIiA9PSBlLnR5cGUgJiYgInByb2JlIiA9PSBlLmRhdGEpIHsKICAgICAgICAgICAgICAgIGlmICgoYSgncHJvYmUgdHJhbnNwb3J0ICIlcyIgcG9uZycsIHQpLCBoLnVwZ3JhZGluZyA9ICEwLCBoLmVtaXQoInVwZ3JhZGluZyIsIHUpLCAhdSkpIHJldHVybjtyLnByaW9yV2Vic29ja2V0U3VjY2VzcyA9ICJ3ZWJzb2NrZXQiID09IHUubmFtZSwgYSgncGF1c2luZyBjdXJyZW50IHRyYW5zcG9ydCAiJXMiJywgaC50cmFuc3BvcnQubmFtZSksIGgudHJhbnNwb3J0LnBhdXNlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgZiB8fCAiY2xvc2VkIiAhPSBoLnJlYWR5U3RhdGUgJiYgKGEoImNoYW5naW5nIHRyYW5zcG9ydCBhbmQgc2VuZGluZyB1cGdyYWRlIHBhY2tldCIpLCBwKCksIGguc2V0VHJhbnNwb3J0KHUpLCB1LnNlbmQoW3sgdHlwZTogInVwZ3JhZGUiIH1dKSwgaC5lbWl0KCJ1cGdyYWRlIiwgdSksIHUgPSBudWxsLCBoLnVwZ3JhZGluZyA9ICExLCBoLmZsdXNoKCkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGEoJ3Byb2JlIHRyYW5zcG9ydCAiJXMiIGZhaWxlZCcsIHQpO3ZhciBuID0gbmV3IEVycm9yKCJwcm9iZSBlcnJvciIpO24udHJhbnNwb3J0ID0gdS5uYW1lLCBoLmVtaXQoInVwZ3JhZGVFcnJvciIsIG4pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpOwogICAgICAgICAgfWZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICAgIGYgfHwgKGYgPSAhMCwgcCgpLCB1LmNsb3NlKCksIHUgPSBudWxsKTsKICAgICAgICAgIH1mdW5jdGlvbiBvKGUpIHsKICAgICAgICAgICAgdmFyIHIgPSBuZXcgRXJyb3IoInByb2JlIGVycm9yOiAiICsgZSk7ci50cmFuc3BvcnQgPSB1Lm5hbWUsIG4oKSwgYSgncHJvYmUgdHJhbnNwb3J0ICIlcyIgZmFpbGVkIGJlY2F1c2Ugb2YgZXJyb3I6ICVzJywgdCwgZSksIGguZW1pdCgidXBncmFkZUVycm9yIiwgcik7CiAgICAgICAgICB9ZnVuY3Rpb24gaSgpIHsKICAgICAgICAgICAgbygidHJhbnNwb3J0IGNsb3NlZCIpOwogICAgICAgICAgfWZ1bmN0aW9uIHMoKSB7CiAgICAgICAgICAgIG8oInNvY2tldCBjbG9zZWQiKTsKICAgICAgICAgIH1mdW5jdGlvbiBjKHQpIHsKICAgICAgICAgICAgdSAmJiB0Lm5hbWUgIT0gdS5uYW1lICYmIChhKCciJXMiIHdvcmtzIC0gYWJvcnRpbmcgIiVzIicsIHQubmFtZSwgdS5uYW1lKSwgbigpKTsKICAgICAgICAgIH1mdW5jdGlvbiBwKCkgewogICAgICAgICAgICB1LnJlbW92ZUxpc3RlbmVyKCJvcGVuIiwgZSksIHUucmVtb3ZlTGlzdGVuZXIoImVycm9yIiwgbyksIHUucmVtb3ZlTGlzdGVuZXIoImNsb3NlIiwgaSksIGgucmVtb3ZlTGlzdGVuZXIoImNsb3NlIiwgcyksIGgucmVtb3ZlTGlzdGVuZXIoInVwZ3JhZGluZyIsIGMpOwogICAgICAgICAgfWEoJ3Byb2JpbmcgdHJhbnNwb3J0ICIlcyInLCB0KTt2YXIgdSA9IHRoaXMuY3JlYXRlVHJhbnNwb3J0KHQsIHsgcHJvYmU6IDEgfSksCiAgICAgICAgICAgICAgZiA9ICExLAogICAgICAgICAgICAgIGggPSB0aGlzO3IucHJpb3JXZWJzb2NrZXRTdWNjZXNzID0gITEsIHUub25jZSgib3BlbiIsIGUpLCB1Lm9uY2UoImVycm9yIiwgbyksIHUub25jZSgiY2xvc2UiLCBpKSwgdGhpcy5vbmNlKCJjbG9zZSIsIHMpLCB0aGlzLm9uY2UoInVwZ3JhZGluZyIsIGMpLCB1Lm9wZW4oKTsKICAgICAgICB9LCByLnByb3RvdHlwZS5vbk9wZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoKGEoInNvY2tldCBvcGVuIiksIHRoaXMucmVhZHlTdGF0ZSA9ICJvcGVuIiwgci5wcmlvcldlYnNvY2tldFN1Y2Nlc3MgPSAid2Vic29ja2V0IiA9PSB0aGlzLnRyYW5zcG9ydC5uYW1lLCB0aGlzLmVtaXQoIm9wZW4iKSwgdGhpcy5mbHVzaCgpLCAib3BlbiIgPT0gdGhpcy5yZWFkeVN0YXRlICYmIHRoaXMudXBncmFkZSAmJiB0aGlzLnRyYW5zcG9ydC5wYXVzZSkpIHsKICAgICAgICAgICAgYSgic3RhcnRpbmcgdXBncmFkZSBwcm9iZXMiKTtmb3IgKHZhciB0ID0gMCwgZSA9IHRoaXMudXBncmFkZXMubGVuZ3RoOyBlID4gdDsgdCsrKSB0aGlzLnByb2JlKHRoaXMudXBncmFkZXNbdF0pOwogICAgICAgICAgfQogICAgICAgIH0sIHIucHJvdG90eXBlLm9uUGFja2V0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGlmICgib3BlbmluZyIgPT0gdGhpcy5yZWFkeVN0YXRlIHx8ICJvcGVuIiA9PSB0aGlzLnJlYWR5U3RhdGUpIHN3aXRjaCAoKGEoJ3NvY2tldCByZWNlaXZlOiB0eXBlICIlcyIsIGRhdGEgIiVzIicsIHQudHlwZSwgdC5kYXRhKSwgdGhpcy5lbWl0KCJwYWNrZXQiLCB0KSwgdGhpcy5lbWl0KCJoZWFydGJlYXQiKSwgdC50eXBlKSkge2Nhc2UgIm9wZW4iOgogICAgICAgICAgICAgIHRoaXMub25IYW5kc2hha2UoZih0LmRhdGEpKTticmVhaztjYXNlICJwb25nIjoKICAgICAgICAgICAgICB0aGlzLnNldFBpbmcoKSwgdGhpcy5lbWl0KCJwb25nIik7YnJlYWs7Y2FzZSAiZXJyb3IiOgogICAgICAgICAgICAgIHZhciBlID0gbmV3IEVycm9yKCJzZXJ2ZXIgZXJyb3IiKTtlLmNvZGUgPSB0LmRhdGEsIHRoaXMub25FcnJvcihlKTticmVhaztjYXNlICJtZXNzYWdlIjoKICAgICAgICAgICAgICB0aGlzLmVtaXQoImRhdGEiLCB0LmRhdGEpLCB0aGlzLmVtaXQoIm1lc3NhZ2UiLCB0LmRhdGEpO30gZWxzZSBhKCdwYWNrZXQgcmVjZWl2ZWQgd2l0aCBzb2NrZXQgcmVhZHlTdGF0ZSAiJXMiJywgdGhpcy5yZWFkeVN0YXRlKTsKICAgICAgICB9LCByLnByb3RvdHlwZS5vbkhhbmRzaGFrZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB0aGlzLmVtaXQoImhhbmRzaGFrZSIsIHQpLCB0aGlzLmlkID0gdC5zaWQsIHRoaXMudHJhbnNwb3J0LnF1ZXJ5LnNpZCA9IHQuc2lkLCB0aGlzLnVwZ3JhZGVzID0gdGhpcy5maWx0ZXJVcGdyYWRlcyh0LnVwZ3JhZGVzKSwgdGhpcy5waW5nSW50ZXJ2YWwgPSB0LnBpbmdJbnRlcnZhbCwgdGhpcy5waW5nVGltZW91dCA9IHQucGluZ1RpbWVvdXQsIHRoaXMub25PcGVuKCksICJjbG9zZWQiICE9IHRoaXMucmVhZHlTdGF0ZSAmJiAodGhpcy5zZXRQaW5nKCksIHRoaXMucmVtb3ZlTGlzdGVuZXIoImhlYXJ0YmVhdCIsIHRoaXMub25IZWFydGJlYXQpLCB0aGlzLm9uKCJoZWFydGJlYXQiLCB0aGlzLm9uSGVhcnRiZWF0KSk7CiAgICAgICAgfSwgci5wcm90b3R5cGUub25IZWFydGJlYXQgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucGluZ1RpbWVvdXRUaW1lcik7dmFyIGUgPSB0aGlzO2UucGluZ1RpbWVvdXRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAiY2xvc2VkIiAhPSBlLnJlYWR5U3RhdGUgJiYgZS5vbkNsb3NlKCJwaW5nIHRpbWVvdXQiKTsKICAgICAgICAgIH0sIHQgfHwgZS5waW5nSW50ZXJ2YWwgKyBlLnBpbmdUaW1lb3V0KTsKICAgICAgICB9LCByLnByb3RvdHlwZS5zZXRQaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSB0aGlzO2NsZWFyVGltZW91dCh0LnBpbmdJbnRlcnZhbFRpbWVyKSwgdC5waW5nSW50ZXJ2YWxUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBhKCJ3cml0aW5nIHBpbmcgcGFja2V0IC0gZXhwZWN0aW5nIHBvbmcgd2l0aGluICVzbXMiLCB0LnBpbmdUaW1lb3V0KSwgdC5waW5nKCksIHQub25IZWFydGJlYXQodC5waW5nVGltZW91dCk7CiAgICAgICAgICB9LCB0LnBpbmdJbnRlcnZhbCk7CiAgICAgICAgfSwgci5wcm90b3R5cGUucGluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ID0gdGhpczt0aGlzLnNlbmRQYWNrZXQoInBpbmciLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHQuZW1pdCgicGluZyIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgci5wcm90b3R5cGUub25EcmFpbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoaXMud3JpdGVCdWZmZXIuc3BsaWNlKDAsIHRoaXMucHJldkJ1ZmZlckxlbiksIHRoaXMucHJldkJ1ZmZlckxlbiA9IDAsIDAgPT09IHRoaXMud3JpdGVCdWZmZXIubGVuZ3RoID8gdGhpcy5lbWl0KCJkcmFpbiIpIDogdGhpcy5mbHVzaCgpOwogICAgICAgIH0sIHIucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgImNsb3NlZCIgIT0gdGhpcy5yZWFkeVN0YXRlICYmIHRoaXMudHJhbnNwb3J0LndyaXRhYmxlICYmICF0aGlzLnVwZ3JhZGluZyAmJiB0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCAmJiAoYSgiZmx1c2hpbmcgJWQgcGFja2V0cyBpbiBzb2NrZXQiLCB0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCksIHRoaXMudHJhbnNwb3J0LnNlbmQodGhpcy53cml0ZUJ1ZmZlciksIHRoaXMucHJldkJ1ZmZlckxlbiA9IHRoaXMud3JpdGVCdWZmZXIubGVuZ3RoLCB0aGlzLmVtaXQoImZsdXNoIikpOwogICAgICAgIH0sIHIucHJvdG90eXBlLndyaXRlID0gci5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5zZW5kUGFja2V0KCJtZXNzYWdlIiwgdCwgZSwgbiksIHRoaXM7CiAgICAgICAgfSwgci5wcm90b3R5cGUuc2VuZFBhY2tldCA9IGZ1bmN0aW9uICh0LCBlLCBuLCByKSB7CiAgICAgICAgICBpZiAoKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgJiYgKHIgPSBlLCBlID0gdm9pZCAwKSwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgbiAmJiAociA9IG4sIG4gPSBudWxsKSwgImNsb3NpbmciICE9IHRoaXMucmVhZHlTdGF0ZSAmJiAiY2xvc2VkIiAhPSB0aGlzLnJlYWR5U3RhdGUpKSB7CiAgICAgICAgICAgIG4gPSBuIHx8IHt9LCBuLmNvbXByZXNzID0gITEgIT09IG4uY29tcHJlc3M7dmFyIG8gPSB7IHR5cGU6IHQsIGRhdGE6IGUsIG9wdGlvbnM6IG4gfTt0aGlzLmVtaXQoInBhY2tldENyZWF0ZSIsIG8pLCB0aGlzLndyaXRlQnVmZmVyLnB1c2gobyksIHIgJiYgdGhpcy5vbmNlKCJmbHVzaCIsIHIpLCB0aGlzLmZsdXNoKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmdW5jdGlvbiB0KCkgewogICAgICAgICAgICByLm9uQ2xvc2UoImZvcmNlZCBjbG9zZSIpLCBhKCJzb2NrZXQgY2xvc2luZyAtIHRlbGxpbmcgdHJhbnNwb3J0IHRvIGNsb3NlIiksIHIudHJhbnNwb3J0LmNsb3NlKCk7CiAgICAgICAgICB9ZnVuY3Rpb24gZSgpIHsKICAgICAgICAgICAgci5yZW1vdmVMaXN0ZW5lcigidXBncmFkZSIsIGUpLCByLnJlbW92ZUxpc3RlbmVyKCJ1cGdyYWRlRXJyb3IiLCBlKSwgdCgpOwogICAgICAgICAgfWZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICAgIHIub25jZSgidXBncmFkZSIsIGUpLCByLm9uY2UoInVwZ3JhZGVFcnJvciIsIGUpOwogICAgICAgICAgfWlmICgib3BlbmluZyIgPT0gdGhpcy5yZWFkeVN0YXRlIHx8ICJvcGVuIiA9PSB0aGlzLnJlYWR5U3RhdGUpIHsKICAgICAgICAgICAgdGhpcy5yZWFkeVN0YXRlID0gImNsb3NpbmciO3ZhciByID0gdGhpczt0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCA/IHRoaXMub25jZSgiZHJhaW4iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdGhpcy51cGdyYWRpbmcgPyBuKCkgOiB0KCk7CiAgICAgICAgICAgIH0pIDogdGhpcy51cGdyYWRpbmcgPyBuKCkgOiB0KCk7CiAgICAgICAgICB9cmV0dXJuIHRoaXM7CiAgICAgICAgfSwgci5wcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBhKCJzb2NrZXQgZXJyb3IgJWoiLCB0KSwgci5wcmlvcldlYnNvY2tldFN1Y2Nlc3MgPSAhMSwgdGhpcy5lbWl0KCJlcnJvciIsIHQpLCB0aGlzLm9uQ2xvc2UoInRyYW5zcG9ydCBlcnJvciIsIHQpOwogICAgICAgIH0sIHIucHJvdG90eXBlLm9uQ2xvc2UgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgaWYgKCJvcGVuaW5nIiA9PSB0aGlzLnJlYWR5U3RhdGUgfHwgIm9wZW4iID09IHRoaXMucmVhZHlTdGF0ZSB8fCAiY2xvc2luZyIgPT0gdGhpcy5yZWFkeVN0YXRlKSB7CiAgICAgICAgICAgIGEoJ3NvY2tldCBjbG9zZSB3aXRoIHJlYXNvbjogIiVzIicsIHQpO3ZhciBuID0gdGhpcztjbGVhclRpbWVvdXQodGhpcy5waW5nSW50ZXJ2YWxUaW1lciksIGNsZWFyVGltZW91dCh0aGlzLnBpbmdUaW1lb3V0VGltZXIpLCB0aGlzLnRyYW5zcG9ydC5yZW1vdmVBbGxMaXN0ZW5lcnMoImNsb3NlIiksIHRoaXMudHJhbnNwb3J0LmNsb3NlKCksIHRoaXMudHJhbnNwb3J0LnJlbW92ZUFsbExpc3RlbmVycygpLCB0aGlzLnJlYWR5U3RhdGUgPSAiY2xvc2VkIiwgdGhpcy5pZCA9IG51bGwsIHRoaXMuZW1pdCgiY2xvc2UiLCB0LCBlKSwgbi53cml0ZUJ1ZmZlciA9IFtdLCBuLnByZXZCdWZmZXJMZW4gPSAwOwogICAgICAgICAgfQogICAgICAgIH0sIHIucHJvdG90eXBlLmZpbHRlclVwZ3JhZGVzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGZvciAodmFyIGUgPSBbXSwgbiA9IDAsIHIgPSB0Lmxlbmd0aDsgciA+IG47IG4rKykgfmModGhpcy50cmFuc3BvcnRzLCB0W25dKSAmJiBlLnB1c2godFtuXSk7cmV0dXJuIGU7CiAgICAgICAgfTsKICAgICAgfSkuY2FsbCh0aGlzLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHt9KTsKICAgIH0sIHsgIi4vdHJhbnNwb3J0IjogMTUsICIuL3RyYW5zcG9ydHMiOiAxNiwgImNvbXBvbmVudC1lbWl0dGVyIjogOCwgZGVidWc6IDEwLCAiZW5naW5lLmlvLXBhcnNlciI6IDIyLCBpbmRleG9mOiAyNywgcGFyc2Vqc29uOiAzMCwgcGFyc2VxczogMzEsIHBhcnNldXJpOiAzMiB9XSwgMTU6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICB0aGlzLnBhdGggPSB0LnBhdGgsIHRoaXMuaG9zdG5hbWUgPSB0Lmhvc3RuYW1lLCB0aGlzLnBvcnQgPSB0LnBvcnQsIHRoaXMuc2VjdXJlID0gdC5zZWN1cmUsIHRoaXMucXVlcnkgPSB0LnF1ZXJ5LCB0aGlzLnRpbWVzdGFtcFBhcmFtID0gdC50aW1lc3RhbXBQYXJhbSwgdGhpcy50aW1lc3RhbXBSZXF1ZXN0cyA9IHQudGltZXN0YW1wUmVxdWVzdHMsIHRoaXMucmVhZHlTdGF0ZSA9ICIiLCB0aGlzLmFnZW50ID0gdC5hZ2VudCB8fCAhMSwgdGhpcy5zb2NrZXQgPSB0LnNvY2tldCwgdGhpcy5lbmFibGVzWERSID0gdC5lbmFibGVzWERSLCB0aGlzLnBmeCA9IHQucGZ4LCB0aGlzLmtleSA9IHQua2V5LCB0aGlzLnBhc3NwaHJhc2UgPSB0LnBhc3NwaHJhc2UsIHRoaXMuY2VydCA9IHQuY2VydCwgdGhpcy5jYSA9IHQuY2EsIHRoaXMuY2lwaGVycyA9IHQuY2lwaGVycywgdGhpcy5yZWplY3RVbmF1dGhvcml6ZWQgPSB0LnJlamVjdFVuYXV0aG9yaXplZCwgdGhpcy5leHRyYUhlYWRlcnMgPSB0LmV4dHJhSGVhZGVyczsKICAgICAgfXZhciBvID0gdCgiZW5naW5lLmlvLXBhcnNlciIpLAogICAgICAgICAgaSA9IHQoImNvbXBvbmVudC1lbWl0dGVyIik7ZS5leHBvcnRzID0gciwgaShyLnByb3RvdHlwZSksIHIucHJvdG90eXBlLm9uRXJyb3IgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHZhciBuID0gbmV3IEVycm9yKHQpO3JldHVybiBuLnR5cGUgPSAiVHJhbnNwb3J0RXJyb3IiLCBuLmRlc2NyaXB0aW9uID0gZSwgdGhpcy5lbWl0KCJlcnJvciIsIG4pLCB0aGlzOwogICAgICB9LCByLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAoImNsb3NlZCIgPT0gdGhpcy5yZWFkeVN0YXRlIHx8ICIiID09IHRoaXMucmVhZHlTdGF0ZSkgJiYgKHRoaXMucmVhZHlTdGF0ZSA9ICJvcGVuaW5nIiwgdGhpcy5kb09wZW4oKSksIHRoaXM7CiAgICAgIH0sIHIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAoIm9wZW5pbmciID09IHRoaXMucmVhZHlTdGF0ZSB8fCAib3BlbiIgPT0gdGhpcy5yZWFkeVN0YXRlKSAmJiAodGhpcy5kb0Nsb3NlKCksIHRoaXMub25DbG9zZSgpKSwgdGhpczsKICAgICAgfSwgci5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKCJvcGVuIiAhPSB0aGlzLnJlYWR5U3RhdGUpIHRocm93IG5ldyBFcnJvcigiVHJhbnNwb3J0IG5vdCBvcGVuIik7dGhpcy53cml0ZSh0KTsKICAgICAgfSwgci5wcm90b3R5cGUub25PcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMucmVhZHlTdGF0ZSA9ICJvcGVuIiwgdGhpcy53cml0YWJsZSA9ICEwLCB0aGlzLmVtaXQoIm9wZW4iKTsKICAgICAgfSwgci5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IG8uZGVjb2RlUGFja2V0KHQsIHRoaXMuc29ja2V0LmJpbmFyeVR5cGUpO3RoaXMub25QYWNrZXQoZSk7CiAgICAgIH0sIHIucHJvdG90eXBlLm9uUGFja2V0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0aGlzLmVtaXQoInBhY2tldCIsIHQpOwogICAgICB9LCByLnByb3RvdHlwZS5vbkNsb3NlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMucmVhZHlTdGF0ZSA9ICJjbG9zZWQiLCB0aGlzLmVtaXQoImNsb3NlIik7CiAgICAgIH07CiAgICB9LCB7ICJjb21wb25lbnQtZW1pdHRlciI6IDgsICJlbmdpbmUuaW8tcGFyc2VyIjogMjIgfV0sIDE2OiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZnVuY3Rpb24gcih0KSB7CiAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICByID0gITEsCiAgICAgICAgICAgICAgYSA9ICExLAogICAgICAgICAgICAgIGMgPSAhMSAhPT0gdC5qc29ucDtpZiAoZS5sb2NhdGlvbikgewogICAgICAgICAgICB2YXIgcCA9ICJodHRwczoiID09IGxvY2F0aW9uLnByb3RvY29sLAogICAgICAgICAgICAgICAgdSA9IGxvY2F0aW9uLnBvcnQ7dSB8fCAodSA9IHAgPyA0NDMgOiA4MCksIHIgPSB0Lmhvc3RuYW1lICE9IGxvY2F0aW9uLmhvc3RuYW1lIHx8IHUgIT0gdC5wb3J0LCBhID0gdC5zZWN1cmUgIT0gcDsKICAgICAgICAgIH1pZiAoKHQueGRvbWFpbiA9IHIsIHQueHNjaGVtZSA9IGEsIG4gPSBuZXcgbyh0KSwgIm9wZW4iIGluIG4gJiYgIXQuZm9yY2VKU09OUCkpIHJldHVybiBuZXcgaSh0KTtpZiAoIWMpIHRocm93IG5ldyBFcnJvcigiSlNPTlAgZGlzYWJsZWQiKTtyZXR1cm4gbmV3IHModCk7CiAgICAgICAgfXZhciBvID0gdCgieG1saHR0cHJlcXVlc3Qtc3NsIiksCiAgICAgICAgICAgIGkgPSB0KCIuL3BvbGxpbmcteGhyIiksCiAgICAgICAgICAgIHMgPSB0KCIuL3BvbGxpbmctanNvbnAiKSwKICAgICAgICAgICAgYSA9IHQoIi4vd2Vic29ja2V0Iik7bi5wb2xsaW5nID0gciwgbi53ZWJzb2NrZXQgPSBhOwogICAgICB9KS5jYWxsKHRoaXMsICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWwgPyBnbG9iYWwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygc2VsZiA/IHNlbGYgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDoge30pOwogICAgfSwgeyAiLi9wb2xsaW5nLWpzb25wIjogMTcsICIuL3BvbGxpbmcteGhyIjogMTgsICIuL3dlYnNvY2tldCI6IDIwLCAieG1saHR0cHJlcXVlc3Qtc3NsIjogMjEgfV0sIDE3OiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgZnVuY3Rpb24gcigpIHt9ZnVuY3Rpb24gbyh0KSB7CiAgICAgICAgICBpLmNhbGwodGhpcywgdCksIHRoaXMucXVlcnkgPSB0aGlzLnF1ZXJ5IHx8IHt9LCBhIHx8IChuLl9fX2VpbyB8fCAobi5fX19laW8gPSBbXSksIGEgPSBuLl9fX2VpbyksIHRoaXMuaW5kZXggPSBhLmxlbmd0aDt2YXIgZSA9IHRoaXM7YS5wdXNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIGUub25EYXRhKHQpOwogICAgICAgICAgfSksIHRoaXMucXVlcnkuaiA9IHRoaXMuaW5kZXgsIG4uZG9jdW1lbnQgJiYgbi5hZGRFdmVudExpc3RlbmVyICYmIG4uYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JldW5sb2FkIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBlLnNjcmlwdCAmJiAoZS5zY3JpcHQub25lcnJvciA9IHIpOwogICAgICAgICAgfSwgITEpOwogICAgICAgIH12YXIgaSA9IHQoIi4vcG9sbGluZyIpLAogICAgICAgICAgICBzID0gdCgiY29tcG9uZW50LWluaGVyaXQiKTtlLmV4cG9ydHMgPSBvO3ZhciBhLAogICAgICAgICAgICBjID0gL1xuL2csCiAgICAgICAgICAgIHAgPSAvXFxuL2c7cyhvLCBpKSwgby5wcm90b3R5cGUuc3VwcG9ydHNCaW5hcnkgPSAhMSwgby5wcm90b3R5cGUuZG9DbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoaXMuc2NyaXB0ICYmICh0aGlzLnNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuc2NyaXB0KSwgdGhpcy5zY3JpcHQgPSBudWxsKSwgdGhpcy5mb3JtICYmICh0aGlzLmZvcm0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmZvcm0pLCB0aGlzLmZvcm0gPSBudWxsLCB0aGlzLmlmcmFtZSA9IG51bGwpLCBpLnByb3RvdHlwZS5kb0Nsb3NlLmNhbGwodGhpcyk7CiAgICAgICAgfSwgby5wcm90b3R5cGUuZG9Qb2xsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICAgIGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTt0aGlzLnNjcmlwdCAmJiAodGhpcy5zY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnNjcmlwdCksIHRoaXMuc2NyaXB0ID0gbnVsbCksIGUuYXN5bmMgPSAhMCwgZS5zcmMgPSB0aGlzLnVyaSgpLCBlLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB0Lm9uRXJyb3IoImpzb25wIHBvbGwgZXJyb3IiLCBlKTsKICAgICAgICAgIH07dmFyIG4gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07biA/IG4ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZSwgbikgOiAoZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5ib2R5KS5hcHBlbmRDaGlsZChlKSwgdGhpcy5zY3JpcHQgPSBlO3ZhciByID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIG5hdmlnYXRvciAmJiAvZ2Vja28vaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO3IgJiYgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaWZyYW1lIik7ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0KSwgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0KTsKICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgfSwgby5wcm90b3R5cGUuZG9Xcml0ZSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICBmdW5jdGlvbiBuKCkgewogICAgICAgICAgICByKCksIGUoKTsKICAgICAgICAgIH1mdW5jdGlvbiByKCkgewogICAgICAgICAgICBpZiAoby5pZnJhbWUpIHRyeSB7CiAgICAgICAgICAgICAgby5mb3JtLnJlbW92ZUNoaWxkKG8uaWZyYW1lKTsKICAgICAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgICAgIG8ub25FcnJvcigianNvbnAgcG9sbGluZyBpZnJhbWUgcmVtb3ZhbCBlcnJvciIsIHQpOwogICAgICAgICAgICB9dHJ5IHsKICAgICAgICAgICAgICB2YXIgZSA9ICc8aWZyYW1lIHNyYz0iamF2YXNjcmlwdDowIiBuYW1lPSInICsgby5pZnJhbWVJZCArICciPic7aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgICBpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaWZyYW1lIiksIGkubmFtZSA9IG8uaWZyYW1lSWQsIGkuc3JjID0gImphdmFzY3JpcHQ6MCI7CiAgICAgICAgICAgIH1pLmlkID0gby5pZnJhbWVJZCwgby5mb3JtLmFwcGVuZENoaWxkKGkpLCBvLmlmcmFtZSA9IGk7CiAgICAgICAgICB9dmFyIG8gPSB0aGlzO2lmICghdGhpcy5mb3JtKSB7CiAgICAgICAgICAgIHZhciBpLAogICAgICAgICAgICAgICAgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImZvcm0iKSwKICAgICAgICAgICAgICAgIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpLAogICAgICAgICAgICAgICAgdSA9IHRoaXMuaWZyYW1lSWQgPSAiZWlvX2lmcmFtZV8iICsgdGhpcy5pbmRleDtzLmNsYXNzTmFtZSA9ICJzb2NrZXRpbyIsIHMuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiLCBzLnN0eWxlLnRvcCA9ICItMTAwMHB4Iiwgcy5zdHlsZS5sZWZ0ID0gIi0xMDAwcHgiLCBzLnRhcmdldCA9IHUsIHMubWV0aG9kID0gIlBPU1QiLCBzLnNldEF0dHJpYnV0ZSgiYWNjZXB0LWNoYXJzZXQiLCAidXRmLTgiKSwgYS5uYW1lID0gImQiLCBzLmFwcGVuZENoaWxkKGEpLCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHMpLCB0aGlzLmZvcm0gPSBzLCB0aGlzLmFyZWEgPSBhOwogICAgICAgICAgfXRoaXMuZm9ybS5hY3Rpb24gPSB0aGlzLnVyaSgpLCByKCksIHQgPSB0LnJlcGxhY2UocCwgIlxcXG4iKSwgdGhpcy5hcmVhLnZhbHVlID0gdC5yZXBsYWNlKGMsICJcXG4iKTt0cnkgewogICAgICAgICAgICB0aGlzLmZvcm0uc3VibWl0KCk7CiAgICAgICAgICB9IGNhdGNoIChmKSB7fXRoaXMuaWZyYW1lLmF0dGFjaEV2ZW50ID8gdGhpcy5pZnJhbWUub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAiY29tcGxldGUiID09IG8uaWZyYW1lLnJlYWR5U3RhdGUgJiYgbigpOwogICAgICAgICAgfSA6IHRoaXMuaWZyYW1lLm9ubG9hZCA9IG47CiAgICAgICAgfTsKICAgICAgfSkuY2FsbCh0aGlzLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHt9KTsKICAgIH0sIHsgIi4vcG9sbGluZyI6IDE5LCAiY29tcG9uZW50LWluaGVyaXQiOiA5IH1dLCAxODogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIChmdW5jdGlvbiAobikgewogICAgICAgIGZ1bmN0aW9uIHIoKSB7fWZ1bmN0aW9uIG8odCkgewogICAgICAgICAgaWYgKChjLmNhbGwodGhpcywgdCksIG4ubG9jYXRpb24pKSB7CiAgICAgICAgICAgIHZhciBlID0gImh0dHBzOiIgPT0gbG9jYXRpb24ucHJvdG9jb2wsCiAgICAgICAgICAgICAgICByID0gbG9jYXRpb24ucG9ydDtyIHx8IChyID0gZSA/IDQ0MyA6IDgwKSwgdGhpcy54ZCA9IHQuaG9zdG5hbWUgIT0gbi5sb2NhdGlvbi5ob3N0bmFtZSB8fCByICE9IHQucG9ydCwgdGhpcy54cyA9IHQuc2VjdXJlICE9IGU7CiAgICAgICAgICB9IGVsc2UgdGhpcy5leHRyYUhlYWRlcnMgPSB0LmV4dHJhSGVhZGVyczsKICAgICAgICB9ZnVuY3Rpb24gaSh0KSB7CiAgICAgICAgICB0aGlzLm1ldGhvZCA9IHQubWV0aG9kIHx8ICJHRVQiLCB0aGlzLnVyaSA9IHQudXJpLCB0aGlzLnhkID0gISF0LnhkLCB0aGlzLnhzID0gISF0LnhzLCB0aGlzLmFzeW5jID0gITEgIT09IHQuYXN5bmMsIHRoaXMuZGF0YSA9IHZvaWQgMCAhPSB0LmRhdGEgPyB0LmRhdGEgOiBudWxsLCB0aGlzLmFnZW50ID0gdC5hZ2VudCwgdGhpcy5pc0JpbmFyeSA9IHQuaXNCaW5hcnksIHRoaXMuc3VwcG9ydHNCaW5hcnkgPSB0LnN1cHBvcnRzQmluYXJ5LCB0aGlzLmVuYWJsZXNYRFIgPSB0LmVuYWJsZXNYRFIsIHRoaXMucGZ4ID0gdC5wZngsIHRoaXMua2V5ID0gdC5rZXksIHRoaXMucGFzc3BocmFzZSA9IHQucGFzc3BocmFzZSwgdGhpcy5jZXJ0ID0gdC5jZXJ0LCB0aGlzLmNhID0gdC5jYSwgdGhpcy5jaXBoZXJzID0gdC5jaXBoZXJzLCB0aGlzLnJlamVjdFVuYXV0aG9yaXplZCA9IHQucmVqZWN0VW5hdXRob3JpemVkLCB0aGlzLmV4dHJhSGVhZGVycyA9IHQuZXh0cmFIZWFkZXJzLCB0aGlzLmNyZWF0ZSgpOwogICAgICAgIH1mdW5jdGlvbiBzKCkgewogICAgICAgICAgZm9yICh2YXIgdCBpbiBpLnJlcXVlc3RzKSBpLnJlcXVlc3RzLmhhc093blByb3BlcnR5KHQpICYmIGkucmVxdWVzdHNbdF0uYWJvcnQoKTsKICAgICAgICB9dmFyIGEgPSB0KCJ4bWxodHRwcmVxdWVzdC1zc2wiKSwKICAgICAgICAgICAgYyA9IHQoIi4vcG9sbGluZyIpLAogICAgICAgICAgICBwID0gdCgiY29tcG9uZW50LWVtaXR0ZXIiKSwKICAgICAgICAgICAgdSA9IHQoImNvbXBvbmVudC1pbmhlcml0IiksCiAgICAgICAgICAgIGYgPSB0KCJkZWJ1ZyIpKCJlbmdpbmUuaW8tY2xpZW50OnBvbGxpbmcteGhyIik7ZS5leHBvcnRzID0gbywgZS5leHBvcnRzLlJlcXVlc3QgPSBpLCB1KG8sIGMpLCBvLnByb3RvdHlwZS5zdXBwb3J0c0JpbmFyeSA9ICEwLCBvLnByb3RvdHlwZS5yZXF1ZXN0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0ID0gdCB8fCB7fSwgdC51cmkgPSB0aGlzLnVyaSgpLCB0LnhkID0gdGhpcy54ZCwgdC54cyA9IHRoaXMueHMsIHQuYWdlbnQgPSB0aGlzLmFnZW50IHx8ICExLCB0LnN1cHBvcnRzQmluYXJ5ID0gdGhpcy5zdXBwb3J0c0JpbmFyeSwgdC5lbmFibGVzWERSID0gdGhpcy5lbmFibGVzWERSLCB0LnBmeCA9IHRoaXMucGZ4LCB0LmtleSA9IHRoaXMua2V5LCB0LnBhc3NwaHJhc2UgPSB0aGlzLnBhc3NwaHJhc2UsIHQuY2VydCA9IHRoaXMuY2VydCwgdC5jYSA9IHRoaXMuY2EsIHQuY2lwaGVycyA9IHRoaXMuY2lwaGVycywgdC5yZWplY3RVbmF1dGhvcml6ZWQgPSB0aGlzLnJlamVjdFVuYXV0aG9yaXplZCwgdC5leHRyYUhlYWRlcnMgPSB0aGlzLmV4dHJhSGVhZGVycywgbmV3IGkodCk7CiAgICAgICAgfSwgby5wcm90b3R5cGUuZG9Xcml0ZSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICB2YXIgbiA9ICJzdHJpbmciICE9IHR5cGVvZiB0ICYmIHZvaWQgMCAhPT0gdCwKICAgICAgICAgICAgICByID0gdGhpcy5yZXF1ZXN0KHsgbWV0aG9kOiAiUE9TVCIsIGRhdGE6IHQsIGlzQmluYXJ5OiBuIH0pLAogICAgICAgICAgICAgIG8gPSB0aGlzO3Iub24oInN1Y2Nlc3MiLCBlKSwgci5vbigiZXJyb3IiLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICBvLm9uRXJyb3IoInhociBwb3N0IGVycm9yIiwgdCk7CiAgICAgICAgICB9KSwgdGhpcy5zZW5kWGhyID0gcjsKICAgICAgICB9LCBvLnByb3RvdHlwZS5kb1BvbGwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmKCJ4aHIgcG9sbCIpO3ZhciB0ID0gdGhpcy5yZXF1ZXN0KCksCiAgICAgICAgICAgICAgZSA9IHRoaXM7dC5vbigiZGF0YSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIGUub25EYXRhKHQpOwogICAgICAgICAgfSksIHQub24oImVycm9yIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZS5vbkVycm9yKCJ4aHIgcG9sbCBlcnJvciIsIHQpOwogICAgICAgICAgfSksIHRoaXMucG9sbFhociA9IHQ7CiAgICAgICAgfSwgcChpLnByb3RvdHlwZSksIGkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ID0geyBhZ2VudDogdGhpcy5hZ2VudCwgeGRvbWFpbjogdGhpcy54ZCwgeHNjaGVtZTogdGhpcy54cywgZW5hYmxlc1hEUjogdGhpcy5lbmFibGVzWERSIH07dC5wZnggPSB0aGlzLnBmeCwgdC5rZXkgPSB0aGlzLmtleSwgdC5wYXNzcGhyYXNlID0gdGhpcy5wYXNzcGhyYXNlLCB0LmNlcnQgPSB0aGlzLmNlcnQsIHQuY2EgPSB0aGlzLmNhLCB0LmNpcGhlcnMgPSB0aGlzLmNpcGhlcnMsIHQucmVqZWN0VW5hdXRob3JpemVkID0gdGhpcy5yZWplY3RVbmF1dGhvcml6ZWQ7dmFyIGUgPSB0aGlzLnhociA9IG5ldyBhKHQpLAogICAgICAgICAgICAgIHIgPSB0aGlzO3RyeSB7CiAgICAgICAgICAgIGYoInhociBvcGVuICVzOiAlcyIsIHRoaXMubWV0aG9kLCB0aGlzLnVyaSksIGUub3Blbih0aGlzLm1ldGhvZCwgdGhpcy51cmksIHRoaXMuYXN5bmMpO3RyeSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuZXh0cmFIZWFkZXJzKSB7CiAgICAgICAgICAgICAgICBlLnNldERpc2FibGVIZWFkZXJDaGVjayghMCk7Zm9yICh2YXIgbyBpbiB0aGlzLmV4dHJhSGVhZGVycykgdGhpcy5leHRyYUhlYWRlcnMuaGFzT3duUHJvcGVydHkobykgJiYgZS5zZXRSZXF1ZXN0SGVhZGVyKG8sIHRoaXMuZXh0cmFIZWFkZXJzW29dKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKHMpIHt9aWYgKCh0aGlzLnN1cHBvcnRzQmluYXJ5ICYmIChlLnJlc3BvbnNlVHlwZSA9ICJhcnJheWJ1ZmZlciIpLCAiUE9TVCIgPT0gdGhpcy5tZXRob2QpKSB0cnkgewogICAgICAgICAgICAgIHRoaXMuaXNCaW5hcnkgPyBlLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtdHlwZSIsICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iKSA6IGUuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC10eXBlIiwgInRleHQvcGxhaW47Y2hhcnNldD1VVEYtOCIpOwogICAgICAgICAgICB9IGNhdGNoIChzKSB7fSJ3aXRoQ3JlZGVudGlhbHMiIGluIGUgJiYgKGUud2l0aENyZWRlbnRpYWxzID0gITApLCB0aGlzLmhhc1hEUigpID8gKGUub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHIub25Mb2FkKCk7CiAgICAgICAgICAgIH0sIGUub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByLm9uRXJyb3IoZS5yZXNwb25zZVRleHQpOwogICAgICAgICAgICB9KSA6IGUub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIDQgPT0gZS5yZWFkeVN0YXRlICYmICgyMDAgPT0gZS5zdGF0dXMgfHwgMTIyMyA9PSBlLnN0YXR1cyA/IHIub25Mb2FkKCkgOiBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHIub25FcnJvcihlLnN0YXR1cyk7CiAgICAgICAgICAgICAgfSwgMCkpOwogICAgICAgICAgICB9LCBmKCJ4aHIgZGF0YSAlcyIsIHRoaXMuZGF0YSksIGUuc2VuZCh0aGlzLmRhdGEpOwogICAgICAgICAgfSBjYXRjaCAocykgewogICAgICAgICAgICByZXR1cm4gdm9pZCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByLm9uRXJyb3Iocyk7CiAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgfW4uZG9jdW1lbnQgJiYgKHRoaXMuaW5kZXggPSBpLnJlcXVlc3RzQ291bnQrKywgaS5yZXF1ZXN0c1t0aGlzLmluZGV4XSA9IHRoaXMpOwogICAgICAgIH0sIGkucHJvdG90eXBlLm9uU3VjY2VzcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoaXMuZW1pdCgic3VjY2VzcyIpLCB0aGlzLmNsZWFudXAoKTsKICAgICAgICB9LCBpLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgdGhpcy5lbWl0KCJkYXRhIiwgdCksIHRoaXMub25TdWNjZXNzKCk7CiAgICAgICAgfSwgaS5wcm90b3R5cGUub25FcnJvciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB0aGlzLmVtaXQoImVycm9yIiwgdCksIHRoaXMuY2xlYW51cCghMCk7CiAgICAgICAgfSwgaS5wcm90b3R5cGUuY2xlYW51cCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBpZiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIHRoaXMueGhyICYmIG51bGwgIT09IHRoaXMueGhyKSB7CiAgICAgICAgICAgIGlmICgodGhpcy5oYXNYRFIoKSA/IHRoaXMueGhyLm9ubG9hZCA9IHRoaXMueGhyLm9uZXJyb3IgPSByIDogdGhpcy54aHIub25yZWFkeXN0YXRlY2hhbmdlID0gciwgdCkpIHRyeSB7CiAgICAgICAgICAgICAgdGhpcy54aHIuYWJvcnQoKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkge31uLmRvY3VtZW50ICYmIGRlbGV0ZSBpLnJlcXVlc3RzW3RoaXMuaW5kZXhdLCB0aGlzLnhociA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwgaS5wcm90b3R5cGUub25Mb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQ7dHJ5IHsKICAgICAgICAgICAgdmFyIGU7dHJ5IHsKICAgICAgICAgICAgICBlID0gdGhpcy54aHIuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpLnNwbGl0KCI7IilbMF07CiAgICAgICAgICAgIH0gY2F0Y2ggKG4pIHt9aWYgKCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iID09PSBlKSB0ID0gdGhpcy54aHIucmVzcG9uc2U7ZWxzZSBpZiAodGhpcy5zdXBwb3J0c0JpbmFyeSkgdHJ5IHsKICAgICAgICAgICAgICB0ID0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheSh0aGlzLnhoci5yZXNwb25zZSkpOwogICAgICAgICAgICB9IGNhdGNoIChuKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgciA9IG5ldyBVaW50OEFycmF5KHRoaXMueGhyLnJlc3BvbnNlKSwgbyA9IFtdLCBpID0gMCwgcyA9IHIubGVuZ3RoOyBzID4gaTsgaSsrKSBvLnB1c2gocltpXSk7dCA9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbyk7CiAgICAgICAgICAgIH0gZWxzZSB0ID0gdGhpcy54aHIucmVzcG9uc2VUZXh0OwogICAgICAgICAgfSBjYXRjaCAobikgewogICAgICAgICAgICB0aGlzLm9uRXJyb3Iobik7CiAgICAgICAgICB9bnVsbCAhPSB0ICYmIHRoaXMub25EYXRhKHQpOwogICAgICAgIH0sIGkucHJvdG90eXBlLmhhc1hEUiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygbi5YRG9tYWluUmVxdWVzdCAmJiAhdGhpcy54cyAmJiB0aGlzLmVuYWJsZXNYRFI7CiAgICAgICAgfSwgaS5wcm90b3R5cGUuYWJvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aGlzLmNsZWFudXAoKTsKICAgICAgICB9LCBuLmRvY3VtZW50ICYmIChpLnJlcXVlc3RzQ291bnQgPSAwLCBpLnJlcXVlc3RzID0ge30sIG4uYXR0YWNoRXZlbnQgPyBuLmF0dGFjaEV2ZW50KCJvbnVubG9hZCIsIHMpIDogbi5hZGRFdmVudExpc3RlbmVyICYmIG4uYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JldW5sb2FkIiwgcywgITEpKTsKICAgICAgfSkuY2FsbCh0aGlzLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHt9KTsKICAgIH0sIHsgIi4vcG9sbGluZyI6IDE5LCAiY29tcG9uZW50LWVtaXR0ZXIiOiA4LCAiY29tcG9uZW50LWluaGVyaXQiOiA5LCBkZWJ1ZzogMTAsICJ4bWxodHRwcmVxdWVzdC1zc2wiOiAyMSB9XSwgMTk6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICB2YXIgZSA9IHQgJiYgdC5mb3JjZUJhc2U2NDsoIXUgfHwgZSkgJiYgKHRoaXMuc3VwcG9ydHNCaW5hcnkgPSAhMSksIG8uY2FsbCh0aGlzLCB0KTsKICAgICAgfXZhciBvID0gdCgiLi4vdHJhbnNwb3J0IiksCiAgICAgICAgICBpID0gdCgicGFyc2VxcyIpLAogICAgICAgICAgcyA9IHQoImVuZ2luZS5pby1wYXJzZXIiKSwKICAgICAgICAgIGEgPSB0KCJjb21wb25lbnQtaW5oZXJpdCIpLAogICAgICAgICAgYyA9IHQoInllYXN0IiksCiAgICAgICAgICBwID0gdCgiZGVidWciKSgiZW5naW5lLmlvLWNsaWVudDpwb2xsaW5nIik7ZS5leHBvcnRzID0gcjt2YXIgdSA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSB0KCJ4bWxodHRwcmVxdWVzdC1zc2wiKSwKICAgICAgICAgICAgbiA9IG5ldyBlKHsgeGRvbWFpbjogITEgfSk7cmV0dXJuIG51bGwgIT0gbi5yZXNwb25zZVR5cGU7CiAgICAgIH0pKCk7YShyLCBvKSwgci5wcm90b3R5cGUubmFtZSA9ICJwb2xsaW5nIiwgci5wcm90b3R5cGUuZG9PcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMucG9sbCgpOwogICAgICB9LCByLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgZnVuY3Rpb24gZSgpIHsKICAgICAgICAgIHAoInBhdXNlZCIpLCBuLnJlYWR5U3RhdGUgPSAicGF1c2VkIiwgdCgpOwogICAgICAgIH12YXIgbiA9IHRoaXM7aWYgKCh0aGlzLnJlYWR5U3RhdGUgPSAicGF1c2luZyIsIHRoaXMucG9sbGluZyB8fCAhdGhpcy53cml0YWJsZSkpIHsKICAgICAgICAgIHZhciByID0gMDt0aGlzLnBvbGxpbmcgJiYgKHAoIndlIGFyZSBjdXJyZW50bHkgcG9sbGluZyAtIHdhaXRpbmcgdG8gcGF1c2UiKSwgcisrLCB0aGlzLm9uY2UoInBvbGxDb21wbGV0ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcCgicHJlLXBhdXNlIHBvbGxpbmcgY29tcGxldGUiKSwgLS1yIHx8IGUoKTsKICAgICAgICAgIH0pKSwgdGhpcy53cml0YWJsZSB8fCAocCgid2UgYXJlIGN1cnJlbnRseSB3cml0aW5nIC0gd2FpdGluZyB0byBwYXVzZSIpLCByKyssIHRoaXMub25jZSgiZHJhaW4iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHAoInByZS1wYXVzZSB3cml0aW5nIGNvbXBsZXRlIiksIC0tciB8fCBlKCk7CiAgICAgICAgICB9KSk7CiAgICAgICAgfSBlbHNlIGUoKTsKICAgICAgfSwgci5wcm90b3R5cGUucG9sbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBwKCJwb2xsaW5nIiksIHRoaXMucG9sbGluZyA9ICEwLCB0aGlzLmRvUG9sbCgpLCB0aGlzLmVtaXQoInBvbGwiKTsKICAgICAgfSwgci5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IHRoaXM7cCgicG9sbGluZyBnb3QgZGF0YSAlcyIsIHQpO3ZhciBuID0gZnVuY3Rpb24gbih0LCBfbiwgcikgewogICAgICAgICAgcmV0dXJuICJvcGVuaW5nIiA9PSBlLnJlYWR5U3RhdGUgJiYgZS5vbk9wZW4oKSwgImNsb3NlIiA9PSB0LnR5cGUgPyAoZS5vbkNsb3NlKCksICExKSA6IHZvaWQgZS5vblBhY2tldCh0KTsKICAgICAgICB9O3MuZGVjb2RlUGF5bG9hZCh0LCB0aGlzLnNvY2tldC5iaW5hcnlUeXBlLCBuKSwgImNsb3NlZCIgIT0gdGhpcy5yZWFkeVN0YXRlICYmICh0aGlzLnBvbGxpbmcgPSAhMSwgdGhpcy5lbWl0KCJwb2xsQ29tcGxldGUiKSwgIm9wZW4iID09IHRoaXMucmVhZHlTdGF0ZSA/IHRoaXMucG9sbCgpIDogcCgnaWdub3JpbmcgcG9sbCAtIHRyYW5zcG9ydCBzdGF0ZSAiJXMiJywgdGhpcy5yZWFkeVN0YXRlKSk7CiAgICAgIH0sIHIucHJvdG90eXBlLmRvQ2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gdCgpIHsKICAgICAgICAgIHAoIndyaXRpbmcgY2xvc2UgcGFja2V0IiksIGUud3JpdGUoW3sgdHlwZTogImNsb3NlIiB9XSk7CiAgICAgICAgfXZhciBlID0gdGhpczsib3BlbiIgPT0gdGhpcy5yZWFkeVN0YXRlID8gKHAoInRyYW5zcG9ydCBvcGVuIC0gY2xvc2luZyIpLCB0KCkpIDogKHAoInRyYW5zcG9ydCBub3Qgb3BlbiAtIGRlZmVycmluZyBjbG9zZSIpLCB0aGlzLm9uY2UoIm9wZW4iLCB0KSk7CiAgICAgIH0sIHIucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IHRoaXM7dGhpcy53cml0YWJsZSA9ICExO3ZhciBuID0gZnVuY3Rpb24gbigpIHsKICAgICAgICAgIGUud3JpdGFibGUgPSAhMCwgZS5lbWl0KCJkcmFpbiIpOwogICAgICAgIH0sCiAgICAgICAgICAgIGUgPSB0aGlzO3MuZW5jb2RlUGF5bG9hZCh0LCB0aGlzLnN1cHBvcnRzQmluYXJ5LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgZS5kb1dyaXRlKHQsIG4pOwogICAgICAgIH0pOwogICAgICB9LCByLnByb3RvdHlwZS51cmkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLnF1ZXJ5IHx8IHt9LAogICAgICAgICAgICBlID0gdGhpcy5zZWN1cmUgPyAiaHR0cHMiIDogImh0dHAiLAogICAgICAgICAgICBuID0gIiI7ITEgIT09IHRoaXMudGltZXN0YW1wUmVxdWVzdHMgJiYgKHRbdGhpcy50aW1lc3RhbXBQYXJhbV0gPSBjKCkpLCB0aGlzLnN1cHBvcnRzQmluYXJ5IHx8IHQuc2lkIHx8ICh0LmI2NCA9IDEpLCB0ID0gaS5lbmNvZGUodCksIHRoaXMucG9ydCAmJiAoImh0dHBzIiA9PSBlICYmIDQ0MyAhPSB0aGlzLnBvcnQgfHwgImh0dHAiID09IGUgJiYgODAgIT0gdGhpcy5wb3J0KSAmJiAobiA9ICI6IiArIHRoaXMucG9ydCksIHQubGVuZ3RoICYmICh0ID0gIj8iICsgdCk7dmFyIHIgPSAtMSAhPT0gdGhpcy5ob3N0bmFtZS5pbmRleE9mKCI6Iik7cmV0dXJuIGUgKyAiOi8vIiArIChyID8gIlsiICsgdGhpcy5ob3N0bmFtZSArICJdIiA6IHRoaXMuaG9zdG5hbWUpICsgbiArIHRoaXMucGF0aCArIHQ7CiAgICAgIH07CiAgICB9LCB7ICIuLi90cmFuc3BvcnQiOiAxNSwgImNvbXBvbmVudC1pbmhlcml0IjogOSwgZGVidWc6IDEwLCAiZW5naW5lLmlvLXBhcnNlciI6IDIyLCBwYXJzZXFzOiAzMSwgInhtbGh0dHByZXF1ZXN0LXNzbCI6IDIxLCB5ZWFzdDogNDYgfV0sIDIwOiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgZnVuY3Rpb24gcih0KSB7CiAgICAgICAgICB2YXIgZSA9IHQgJiYgdC5mb3JjZUJhc2U2NDtlICYmICh0aGlzLnN1cHBvcnRzQmluYXJ5ID0gITEpLCB0aGlzLnBlck1lc3NhZ2VEZWZsYXRlID0gdC5wZXJNZXNzYWdlRGVmbGF0ZSwgby5jYWxsKHRoaXMsIHQpOwogICAgICAgIH12YXIgbyA9IHQoIi4uL3RyYW5zcG9ydCIpLAogICAgICAgICAgICBpID0gdCgiZW5naW5lLmlvLXBhcnNlciIpLAogICAgICAgICAgICBzID0gdCgicGFyc2VxcyIpLAogICAgICAgICAgICBhID0gdCgiY29tcG9uZW50LWluaGVyaXQiKSwKICAgICAgICAgICAgYyA9IHQoInllYXN0IiksCiAgICAgICAgICAgIHAgPSB0KCJkZWJ1ZyIpKCJlbmdpbmUuaW8tY2xpZW50OndlYnNvY2tldCIpLAogICAgICAgICAgICB1ID0gbi5XZWJTb2NrZXQgfHwgbi5Nb3pXZWJTb2NrZXQsCiAgICAgICAgICAgIGYgPSB1IHx8ICgidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gbnVsbCA6IHQoIndzIikpO2UuZXhwb3J0cyA9IHIsIGEociwgbyksIHIucHJvdG90eXBlLm5hbWUgPSAid2Vic29ja2V0Iiwgci5wcm90b3R5cGUuc3VwcG9ydHNCaW5hcnkgPSAhMCwgci5wcm90b3R5cGUuZG9PcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHRoaXMuY2hlY2soKSkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXMudXJpKCksCiAgICAgICAgICAgICAgICBlID0gdm9pZCAwLAogICAgICAgICAgICAgICAgbiA9IHsgYWdlbnQ6IHRoaXMuYWdlbnQsIHBlck1lc3NhZ2VEZWZsYXRlOiB0aGlzLnBlck1lc3NhZ2VEZWZsYXRlIH07bi5wZnggPSB0aGlzLnBmeCwgbi5rZXkgPSB0aGlzLmtleSwgbi5wYXNzcGhyYXNlID0gdGhpcy5wYXNzcGhyYXNlLCBuLmNlcnQgPSB0aGlzLmNlcnQsIG4uY2EgPSB0aGlzLmNhLCBuLmNpcGhlcnMgPSB0aGlzLmNpcGhlcnMsIG4ucmVqZWN0VW5hdXRob3JpemVkID0gdGhpcy5yZWplY3RVbmF1dGhvcml6ZWQsIHRoaXMuZXh0cmFIZWFkZXJzICYmIChuLmhlYWRlcnMgPSB0aGlzLmV4dHJhSGVhZGVycyksIHRoaXMud3MgPSB1ID8gbmV3IGYodCkgOiBuZXcgZih0LCBlLCBuKSwgdm9pZCAwID09PSB0aGlzLndzLmJpbmFyeVR5cGUgJiYgKHRoaXMuc3VwcG9ydHNCaW5hcnkgPSAhMSksIHRoaXMud3Muc3VwcG9ydHMgJiYgdGhpcy53cy5zdXBwb3J0cy5iaW5hcnkgPyAodGhpcy5zdXBwb3J0c0JpbmFyeSA9ICEwLCB0aGlzLndzLmJpbmFyeVR5cGUgPSAiYnVmZmVyIikgOiB0aGlzLndzLmJpbmFyeVR5cGUgPSAiYXJyYXlidWZmZXIiLCB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgci5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdCA9IHRoaXM7dGhpcy53cy5vbm9wZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHQub25PcGVuKCk7CiAgICAgICAgICB9LCB0aGlzLndzLm9uY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHQub25DbG9zZSgpOwogICAgICAgICAgfSwgdGhpcy53cy5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB0Lm9uRGF0YShlLmRhdGEpOwogICAgICAgICAgfSwgdGhpcy53cy5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdC5vbkVycm9yKCJ3ZWJzb2NrZXQgZXJyb3IiLCBlKTsKICAgICAgICAgIH07CiAgICAgICAgfSwgInVuZGVmaW5lZCIgIT0gdHlwZW9mIG5hdmlnYXRvciAmJiAvaVBhZHxpUGhvbmV8aVBvZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgKHIucHJvdG90eXBlLm9uRGF0YSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgZSA9IHRoaXM7c2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG8ucHJvdG90eXBlLm9uRGF0YS5jYWxsKGUsIHQpOwogICAgICAgICAgfSwgMCk7CiAgICAgICAgfSksIHIucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICAgIHIuZW1pdCgiZmx1c2giKSwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgci53cml0YWJsZSA9ICEwLCByLmVtaXQoImRyYWluIik7CiAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgfXZhciByID0gdGhpczt0aGlzLndyaXRhYmxlID0gITE7Zm9yICh2YXIgbyA9IHQubGVuZ3RoLCBzID0gMCwgYSA9IG87IGEgPiBzOyBzKyspICEoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgaS5lbmNvZGVQYWNrZXQodCwgci5zdXBwb3J0c0JpbmFyeSwgZnVuY3Rpb24gKGkpIHsKICAgICAgICAgICAgICBpZiAoIXUpIHsKICAgICAgICAgICAgICAgIHZhciBzID0ge307aWYgKCh0Lm9wdGlvbnMgJiYgKHMuY29tcHJlc3MgPSB0Lm9wdGlvbnMuY29tcHJlc3MpLCByLnBlck1lc3NhZ2VEZWZsYXRlKSkgewogICAgICAgICAgICAgICAgICB2YXIgYSA9ICJzdHJpbmciID09IHR5cGVvZiBpID8gbi5CdWZmZXIuYnl0ZUxlbmd0aChpKSA6IGkubGVuZ3RoO2EgPCByLnBlck1lc3NhZ2VEZWZsYXRlLnRocmVzaG9sZCAmJiAocy5jb21wcmVzcyA9ICExKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9dHJ5IHsKICAgICAgICAgICAgICAgIHUgPyByLndzLnNlbmQoaSkgOiByLndzLnNlbmQoaSwgcyk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoYykgewogICAgICAgICAgICAgICAgcCgid2Vic29ja2V0IGNsb3NlZCBiZWZvcmUgb25jbG9zZSBldmVudCIpOwogICAgICAgICAgICAgIH0tLW8gfHwgZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKHRbc10pOwogICAgICAgIH0sIHIucHJvdG90eXBlLm9uQ2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvLnByb3RvdHlwZS5vbkNsb3NlLmNhbGwodGhpcyk7CiAgICAgICAgfSwgci5wcm90b3R5cGUuZG9DbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICJ1bmRlZmluZWQiICE9IHR5cGVvZiB0aGlzLndzICYmIHRoaXMud3MuY2xvc2UoKTsKICAgICAgICB9LCByLnByb3RvdHlwZS51cmkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdCA9IHRoaXMucXVlcnkgfHwge30sCiAgICAgICAgICAgICAgZSA9IHRoaXMuc2VjdXJlID8gIndzcyIgOiAid3MiLAogICAgICAgICAgICAgIG4gPSAiIjt0aGlzLnBvcnQgJiYgKCJ3c3MiID09IGUgJiYgNDQzICE9IHRoaXMucG9ydCB8fCAid3MiID09IGUgJiYgODAgIT0gdGhpcy5wb3J0KSAmJiAobiA9ICI6IiArIHRoaXMucG9ydCksIHRoaXMudGltZXN0YW1wUmVxdWVzdHMgJiYgKHRbdGhpcy50aW1lc3RhbXBQYXJhbV0gPSBjKCkpLCB0aGlzLnN1cHBvcnRzQmluYXJ5IHx8ICh0LmI2NCA9IDEpLCB0ID0gcy5lbmNvZGUodCksIHQubGVuZ3RoICYmICh0ID0gIj8iICsgdCk7dmFyIHIgPSAtMSAhPT0gdGhpcy5ob3N0bmFtZS5pbmRleE9mKCI6Iik7cmV0dXJuIGUgKyAiOi8vIiArIChyID8gIlsiICsgdGhpcy5ob3N0bmFtZSArICJdIiA6IHRoaXMuaG9zdG5hbWUpICsgbiArIHRoaXMucGF0aCArIHQ7CiAgICAgICAgfSwgci5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gISghZiB8fCAiX19pbml0aWFsaXplIiBpbiBmICYmIHRoaXMubmFtZSA9PT0gci5wcm90b3R5cGUubmFtZSk7CiAgICAgICAgfTsKICAgICAgfSkuY2FsbCh0aGlzLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHt9KTsKICAgIH0sIHsgIi4uL3RyYW5zcG9ydCI6IDE1LCAiY29tcG9uZW50LWluaGVyaXQiOiA5LCBkZWJ1ZzogMTAsICJlbmdpbmUuaW8tcGFyc2VyIjogMjIsIHBhcnNlcXM6IDMxLCB3czogNiwgeWVhc3Q6IDQ2IH1dLCAyMTogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIHZhciByID0gdCgiaGFzLWNvcnMiKTtlLmV4cG9ydHMgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBlID0gdC54ZG9tYWluLAogICAgICAgICAgICBuID0gdC54c2NoZW1lLAogICAgICAgICAgICBvID0gdC5lbmFibGVzWERSO3RyeSB7CiAgICAgICAgICBpZiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIFhNTEh0dHBSZXF1ZXN0ICYmICghZSB8fCByKSkgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgIH0gY2F0Y2ggKGkpIHt9dHJ5IHsKICAgICAgICAgIGlmICgidW5kZWZpbmVkIiAhPSB0eXBlb2YgWERvbWFpblJlcXVlc3QgJiYgIW4gJiYgbykgcmV0dXJuIG5ldyBYRG9tYWluUmVxdWVzdCgpOwogICAgICAgIH0gY2F0Y2ggKGkpIHt9aWYgKCFlKSB0cnkgewogICAgICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpOwogICAgICAgIH0gY2F0Y2ggKGkpIHt9CiAgICAgIH07CiAgICB9LCB7ICJoYXMtY29ycyI6IDI2IH1dLCAyMjogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIChmdW5jdGlvbiAoZSkgewogICAgICAgIGZ1bmN0aW9uIHIodCwgZSkgewogICAgICAgICAgdmFyIHIgPSAiYiIgKyBuLnBhY2tldHNbdC50eXBlXSArIHQuZGF0YS5kYXRhO3JldHVybiBlKHIpOwogICAgICAgIH1mdW5jdGlvbiBvKHQsIGUsIHIpIHsKICAgICAgICAgIGlmICghZSkgcmV0dXJuIG4uZW5jb2RlQmFzZTY0UGFja2V0KHQsIHIpO3ZhciBvID0gdC5kYXRhLAogICAgICAgICAgICAgIGkgPSBuZXcgVWludDhBcnJheShvKSwKICAgICAgICAgICAgICBzID0gbmV3IFVpbnQ4QXJyYXkoMSArIG8uYnl0ZUxlbmd0aCk7CiAgICAgICAgICBzWzBdID0gbVt0LnR5cGVdO2ZvciAodmFyIGEgPSAwOyBhIDwgaS5sZW5ndGg7IGErKykgc1thICsgMV0gPSBpW2FdO3JldHVybiByKHMuYnVmZmVyKTsKICAgICAgICB9ZnVuY3Rpb24gaSh0LCBlLCByKSB7CiAgICAgICAgICBpZiAoIWUpIHJldHVybiBuLmVuY29kZUJhc2U2NFBhY2tldCh0LCByKTt2YXIgbyA9IG5ldyBGaWxlUmVhZGVyKCk7cmV0dXJuIG8ub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0LmRhdGEgPSBvLnJlc3VsdCwgbi5lbmNvZGVQYWNrZXQodCwgZSwgITAsIHIpOwogICAgICAgICAgfSwgby5yZWFkQXNBcnJheUJ1ZmZlcih0LmRhdGEpOwogICAgICAgIH1mdW5jdGlvbiBzKHQsIGUsIHIpIHsKICAgICAgICAgIGlmICghZSkgcmV0dXJuIG4uZW5jb2RlQmFzZTY0UGFja2V0KHQsIHIpO2lmIChnKSByZXR1cm4gaSh0LCBlLCByKTt2YXIgbyA9IG5ldyBVaW50OEFycmF5KDEpO29bMF0gPSBtW3QudHlwZV07dmFyIHMgPSBuZXcgdyhbby5idWZmZXIsIHQuZGF0YV0pO3JldHVybiByKHMpOwogICAgICAgIH1mdW5jdGlvbiBhKHQsIGUsIG4pIHsKICAgICAgICAgIGZvciAodmFyIHIgPSBuZXcgQXJyYXkodC5sZW5ndGgpLCBvID0gaCh0Lmxlbmd0aCwgbiksIGkgPSBmdW5jdGlvbiBpKHQsIG4sIG8pIHsKICAgICAgICAgICAgZShuLCBmdW5jdGlvbiAoZSwgbikgewogICAgICAgICAgICAgIHJbdF0gPSBuLCBvKGUsIHIpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sIHMgPSAwOyBzIDwgdC5sZW5ndGg7IHMrKykgaShzLCB0W3NdLCBvKTsKICAgICAgICB9dmFyIGMgPSB0KCIuL2tleXMiKSwKICAgICAgICAgICAgcCA9IHQoImhhcy1iaW5hcnkiKSwKICAgICAgICAgICAgdSA9IHQoImFycmF5YnVmZmVyLnNsaWNlIiksCiAgICAgICAgICAgIGYgPSB0KCJiYXNlNjQtYXJyYXlidWZmZXIiKSwKICAgICAgICAgICAgaCA9IHQoImFmdGVyIiksCiAgICAgICAgICAgIGwgPSB0KCJ1dGY4IiksCiAgICAgICAgICAgIGQgPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9BbmRyb2lkL2kpLAogICAgICAgICAgICB5ID0gL1BoYW50b21KUy9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksCiAgICAgICAgICAgIGcgPSBkIHx8IHk7bi5wcm90b2NvbCA9IDM7dmFyIG0gPSBuLnBhY2tldHMgPSB7IG9wZW46IDAsIGNsb3NlOiAxLCBwaW5nOiAyLCBwb25nOiAzLCBtZXNzYWdlOiA0LCB1cGdyYWRlOiA1LCBub29wOiA2IH0sCiAgICAgICAgICAgIGIgPSBjKG0pLAogICAgICAgICAgICB2ID0geyB0eXBlOiAiZXJyb3IiLCBkYXRhOiAicGFyc2VyIGVycm9yIiB9LAogICAgICAgICAgICB3ID0gdCgiYmxvYiIpO24uZW5jb2RlUGFja2V0ID0gZnVuY3Rpb24gKHQsIG4sIGksIGEpIHsKICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4gJiYgKGEgPSBuLCBuID0gITEpLCAiZnVuY3Rpb24iID09IHR5cGVvZiBpICYmIChhID0gaSwgaSA9IG51bGwpO3ZhciBjID0gdm9pZCAwID09PSB0LmRhdGEgPyB2b2lkIDAgOiB0LmRhdGEuYnVmZmVyIHx8IHQuZGF0YTtpZiAoZS5BcnJheUJ1ZmZlciAmJiBjIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHJldHVybiBvKHQsIG4sIGEpO2lmICh3ICYmIGMgaW5zdGFuY2VvZiBlLkJsb2IpIHJldHVybiBzKHQsIG4sIGEpO2lmIChjICYmIGMuYmFzZTY0KSByZXR1cm4gcih0LCBhKTt2YXIgcCA9IG1bdC50eXBlXTtyZXR1cm4gdm9pZCAwICE9PSB0LmRhdGEgJiYgKHAgKz0gaSA/IGwuZW5jb2RlKFN0cmluZyh0LmRhdGEpKSA6IFN0cmluZyh0LmRhdGEpKSwgYSgiIiArIHApOwogICAgICAgIH0sIG4uZW5jb2RlQmFzZTY0UGFja2V0ID0gZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgIHZhciBvID0gImIiICsgbi5wYWNrZXRzW3QudHlwZV07aWYgKHcgJiYgdC5kYXRhIGluc3RhbmNlb2YgZS5CbG9iKSB7CiAgICAgICAgICAgIHZhciBpID0gbmV3IEZpbGVSZWFkZXIoKTtyZXR1cm4gaS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBpLnJlc3VsdC5zcGxpdCgiLCIpWzFdO3IobyArIHQpOwogICAgICAgICAgICB9LCBpLnJlYWRBc0RhdGFVUkwodC5kYXRhKTsKICAgICAgICAgIH12YXIgczt0cnkgewogICAgICAgICAgICBzID0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheSh0LmRhdGEpKTsKICAgICAgICAgIH0gY2F0Y2ggKGEpIHsKICAgICAgICAgICAgZm9yICh2YXIgYyA9IG5ldyBVaW50OEFycmF5KHQuZGF0YSksIHAgPSBuZXcgQXJyYXkoYy5sZW5ndGgpLCB1ID0gMDsgdSA8IGMubGVuZ3RoOyB1KyspIHBbdV0gPSBjW3VdO3MgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHApOwogICAgICAgICAgfXJldHVybiBvICs9IGUuYnRvYShzKSwgcihvKTsKICAgICAgICB9LCBuLmRlY29kZVBhY2tldCA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHQgfHwgdm9pZCAwID09PSB0KSB7CiAgICAgICAgICAgIGlmICgiYiIgPT0gdC5jaGFyQXQoMCkpIHJldHVybiBuLmRlY29kZUJhc2U2NFBhY2tldCh0LnN1YnN0cigxKSwgZSk7aWYgKHIpIHRyeSB7CiAgICAgICAgICAgICAgdCA9IGwuZGVjb2RlKHQpOwogICAgICAgICAgICB9IGNhdGNoIChvKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHY7CiAgICAgICAgICAgIH12YXIgaSA9IHQuY2hhckF0KDApO3JldHVybiBOdW1iZXIoaSkgPT0gaSAmJiBiW2ldID8gdC5sZW5ndGggPiAxID8geyB0eXBlOiBiW2ldLCBkYXRhOiB0LnN1YnN0cmluZygxKSB9IDogeyB0eXBlOiBiW2ldIH0gOiB2OwogICAgICAgICAgfXZhciBzID0gbmV3IFVpbnQ4QXJyYXkodCksCiAgICAgICAgICAgICAgaSA9IHNbMF0sCiAgICAgICAgICAgICAgYSA9IHUodCwgMSk7cmV0dXJuIHcgJiYgImJsb2IiID09PSBlICYmIChhID0gbmV3IHcoW2FdKSksIHsgdHlwZTogYltpXSwgZGF0YTogYSB9OwogICAgICAgIH0sIG4uZGVjb2RlQmFzZTY0UGFja2V0ID0gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHZhciByID0gYlt0LmNoYXJBdCgwKV07aWYgKCFlLkFycmF5QnVmZmVyKSByZXR1cm4geyB0eXBlOiByLCBkYXRhOiB7IGJhc2U2NDogITAsIGRhdGE6IHQuc3Vic3RyKDEpIH0gfTt2YXIgbyA9IGYuZGVjb2RlKHQuc3Vic3RyKDEpKTtyZXR1cm4gImJsb2IiID09PSBuICYmIHcgJiYgKG8gPSBuZXcgdyhbb10pKSwgeyB0eXBlOiByLCBkYXRhOiBvIH07CiAgICAgICAgfSwgbi5lbmNvZGVQYXlsb2FkID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgIGZ1bmN0aW9uIG8odCkgewogICAgICAgICAgICByZXR1cm4gdC5sZW5ndGggKyAiOiIgKyB0OwogICAgICAgICAgfWZ1bmN0aW9uIGkodCwgcikgewogICAgICAgICAgICBuLmVuY29kZVBhY2tldCh0LCBzID8gZSA6ICExLCAhMCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByKG51bGwsIG8odCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0iZnVuY3Rpb24iID09IHR5cGVvZiBlICYmIChyID0gZSwgZSA9IG51bGwpO3ZhciBzID0gcCh0KTtyZXR1cm4gZSAmJiBzID8gdyAmJiAhZyA/IG4uZW5jb2RlUGF5bG9hZEFzQmxvYih0LCByKSA6IG4uZW5jb2RlUGF5bG9hZEFzQXJyYXlCdWZmZXIodCwgcikgOiB0Lmxlbmd0aCA/IHZvaWQgYSh0LCBpLCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICByZXR1cm4gcihlLmpvaW4oIiIpKTsKICAgICAgICAgIH0pIDogcigiMDoiKTsKICAgICAgICB9LCBuLmRlY29kZVBheWxvYWQgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgICAgaWYgKCJzdHJpbmciICE9IHR5cGVvZiB0KSByZXR1cm4gbi5kZWNvZGVQYXlsb2FkQXNCaW5hcnkodCwgZSwgcik7ImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSAmJiAociA9IGUsIGUgPSBudWxsKTt2YXIgbztpZiAoIiIgPT0gdCkgcmV0dXJuIHIodiwgMCwgMSk7Zm9yICh2YXIgaSwgcywgYSA9ICIiLCBjID0gMCwgcCA9IHQubGVuZ3RoOyBwID4gYzsgYysrKSB7CiAgICAgICAgICAgIHZhciB1ID0gdC5jaGFyQXQoYyk7aWYgKCI6IiAhPSB1KSBhICs9IHU7ZWxzZSB7CiAgICAgICAgICAgICAgaWYgKCIiID09IGEgfHwgYSAhPSAoaSA9IE51bWJlcihhKSkpIHJldHVybiByKHYsIDAsIDEpO2lmICgocyA9IHQuc3Vic3RyKGMgKyAxLCBpKSwgYSAhPSBzLmxlbmd0aCkpIHJldHVybiByKHYsIDAsIDEpO2lmIChzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaWYgKChvID0gbi5kZWNvZGVQYWNrZXQocywgZSwgITApLCB2LnR5cGUgPT0gby50eXBlICYmIHYuZGF0YSA9PSBvLmRhdGEpKSByZXR1cm4gcih2LCAwLCAxKTt2YXIgZiA9IHIobywgYyArIGksIHApO2lmICghMSA9PT0gZikgcmV0dXJuOwogICAgICAgICAgICAgIH1jICs9IGksIGEgPSAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgfXJldHVybiAiIiAhPSBhID8gcih2LCAwLCAxKSA6IHZvaWQgMDsKICAgICAgICB9LCBuLmVuY29kZVBheWxvYWRBc0FycmF5QnVmZmVyID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgIGZ1bmN0aW9uIHIodCwgZSkgewogICAgICAgICAgICBuLmVuY29kZVBhY2tldCh0LCAhMCwgITAsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUobnVsbCwgdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfXJldHVybiB0Lmxlbmd0aCA/IHZvaWQgYSh0LCByLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICB2YXIgciA9IG4ucmVkdWNlKGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgdmFyIG47cmV0dXJuIG4gPSAic3RyaW5nIiA9PSB0eXBlb2YgZSA/IGUubGVuZ3RoIDogZS5ieXRlTGVuZ3RoLCB0ICsgbi50b1N0cmluZygpLmxlbmd0aCArIG4gKyAyOwogICAgICAgICAgICB9LCAwKSwKICAgICAgICAgICAgICAgIG8gPSBuZXcgVWludDhBcnJheShyKSwKICAgICAgICAgICAgICAgIGkgPSAwO3JldHVybiBuLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB2YXIgZSA9ICJzdHJpbmciID09IHR5cGVvZiB0LAogICAgICAgICAgICAgICAgICBuID0gdDtpZiAoZSkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgciA9IG5ldyBVaW50OEFycmF5KHQubGVuZ3RoKSwgcyA9IDA7IHMgPCB0Lmxlbmd0aDsgcysrKSByW3NdID0gdC5jaGFyQ29kZUF0KHMpO24gPSByLmJ1ZmZlcjsKICAgICAgICAgICAgICB9ZSA/IG9baSsrXSA9IDAgOiBvW2krK10gPSAxO2ZvciAodmFyIGEgPSBuLmJ5dGVMZW5ndGgudG9TdHJpbmcoKSwgcyA9IDA7IHMgPCBhLmxlbmd0aDsgcysrKSBvW2krK10gPSBwYXJzZUludChhW3NdKTtvW2krK10gPSAyNTU7Zm9yICh2YXIgciA9IG5ldyBVaW50OEFycmF5KG4pLCBzID0gMDsgcyA8IHIubGVuZ3RoOyBzKyspIG9baSsrXSA9IHJbc107CiAgICAgICAgICAgIH0pLCBlKG8uYnVmZmVyKTsKICAgICAgICAgIH0pIDogZShuZXcgQXJyYXlCdWZmZXIoMCkpOwogICAgICAgIH0sIG4uZW5jb2RlUGF5bG9hZEFzQmxvYiA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICBmdW5jdGlvbiByKHQsIGUpIHsKICAgICAgICAgICAgbi5lbmNvZGVQYWNrZXQodCwgITAsICEwLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHZhciBuID0gbmV3IFVpbnQ4QXJyYXkoMSk7aWYgKChuWzBdID0gMSwgInN0cmluZyIgPT0gdHlwZW9mIHQpKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciByID0gbmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpLCBvID0gMDsgbyA8IHQubGVuZ3RoOyBvKyspIHJbb10gPSB0LmNoYXJDb2RlQXQobyk7dCA9IHIuYnVmZmVyLCBuWzBdID0gMDsKICAgICAgICAgICAgICB9Zm9yICh2YXIgaSA9IHQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciA/IHQuYnl0ZUxlbmd0aCA6IHQuc2l6ZSwgcyA9IGkudG9TdHJpbmcoKSwgYSA9IG5ldyBVaW50OEFycmF5KHMubGVuZ3RoICsgMSksIG8gPSAwOyBvIDwgcy5sZW5ndGg7IG8rKykgYVtvXSA9IHBhcnNlSW50KHNbb10pO2lmICgoYVtzLmxlbmd0aF0gPSAyNTUsIHcpKSB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IG5ldyB3KFtuLmJ1ZmZlciwgYS5idWZmZXIsIHRdKTtlKG51bGwsIGMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9YSh0LCByLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICByZXR1cm4gZShuZXcgdyhuKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9LCBuLmRlY29kZVBheWxvYWRBc0JpbmFyeSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiBlICYmIChyID0gZSwgZSA9IG51bGwpO2ZvciAodmFyIG8gPSB0LCBpID0gW10sIHMgPSAhMTsgby5ieXRlTGVuZ3RoID4gMDspIHsKICAgICAgICAgICAgZm9yICh2YXIgYSA9IG5ldyBVaW50OEFycmF5KG8pLCBjID0gMCA9PT0gYVswXSwgcCA9ICIiLCBmID0gMTsgMjU1ICE9IGFbZl07IGYrKykgewogICAgICAgICAgICAgIGlmIChwLmxlbmd0aCA+IDMxMCkgewogICAgICAgICAgICAgICAgcyA9ICEwO2JyZWFrOwogICAgICAgICAgICAgIH1wICs9IGFbZl07CiAgICAgICAgICAgIH1pZiAocykgcmV0dXJuIHIodiwgMCwgMSk7byA9IHUobywgMiArIHAubGVuZ3RoKSwgcCA9IHBhcnNlSW50KHApO3ZhciBoID0gdShvLCAwLCBwKTtpZiAoYykgdHJ5IHsKICAgICAgICAgICAgICBoID0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheShoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGwpIHsKICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBVaW50OEFycmF5KGgpO2ggPSAiIjtmb3IgKHZhciBmID0gMDsgZiA8IGQubGVuZ3RoOyBmKyspIGggKz0gU3RyaW5nLmZyb21DaGFyQ29kZShkW2ZdKTsKICAgICAgICAgICAgfWkucHVzaChoKSwgbyA9IHUobywgcCk7CiAgICAgICAgICB9dmFyIHkgPSBpLmxlbmd0aDtpLmZvckVhY2goZnVuY3Rpb24gKHQsIG8pIHsKICAgICAgICAgICAgcihuLmRlY29kZVBhY2tldCh0LCBlLCAhMCksIG8sIHkpOwogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfSkuY2FsbCh0aGlzLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHt9KTsKICAgIH0sIHsgIi4va2V5cyI6IDIzLCBhZnRlcjogMSwgImFycmF5YnVmZmVyLnNsaWNlIjogMiwgImJhc2U2NC1hcnJheWJ1ZmZlciI6IDQsIGJsb2I6IDUsICJoYXMtYmluYXJ5IjogMjQsIHV0Zjg6IDQ1IH1dLCAyMzogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGUuZXhwb3J0cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGUgPSBbXSwKICAgICAgICAgICAgbiA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7Zm9yICh2YXIgciBpbiB0KSBuLmNhbGwodCwgcikgJiYgZS5wdXNoKHIpO3JldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCAyNDogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIChmdW5jdGlvbiAobikgewogICAgICAgIGZ1bmN0aW9uIHIodCkgewogICAgICAgICAgZnVuY3Rpb24gZSh0KSB7CiAgICAgICAgICAgIGlmICghdCkgcmV0dXJuICExO2lmIChuLkJ1ZmZlciAmJiBuLkJ1ZmZlci5pc0J1ZmZlcih0KSB8fCBuLkFycmF5QnVmZmVyICYmIHQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciB8fCBuLkJsb2IgJiYgdCBpbnN0YW5jZW9mIEJsb2IgfHwgbi5GaWxlICYmIHQgaW5zdGFuY2VvZiBGaWxlKSByZXR1cm4gITA7aWYgKG8odCkpIHsKICAgICAgICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IHQubGVuZ3RoOyByKyspIGlmIChlKHRbcl0pKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodCAmJiAib2JqZWN0IiA9PSB0eXBlb2YgdCkgewogICAgICAgICAgICAgIHQudG9KU09OICYmICh0ID0gdC50b0pTT04oKSk7Zm9yICh2YXIgaSBpbiB0KSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsIGkpICYmIGUodFtpXSkpIHJldHVybiAhMDsKICAgICAgICAgICAgfXJldHVybiAhMTsKICAgICAgICAgIH1yZXR1cm4gZSh0KTsKICAgICAgICB9dmFyIG8gPSB0KCJpc2FycmF5Iik7ZS5leHBvcnRzID0gcjsKICAgICAgfSkuY2FsbCh0aGlzLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHt9KTsKICAgIH0sIHsgaXNhcnJheTogMjggfV0sIDI1OiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgZnVuY3Rpb24gcih0KSB7CiAgICAgICAgICBmdW5jdGlvbiBlKHQpIHsKICAgICAgICAgICAgaWYgKCF0KSByZXR1cm4gITE7aWYgKG4uQnVmZmVyICYmIG4uQnVmZmVyLmlzQnVmZmVyICYmIG4uQnVmZmVyLmlzQnVmZmVyKHQpIHx8IG4uQXJyYXlCdWZmZXIgJiYgdCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyIHx8IG4uQmxvYiAmJiB0IGluc3RhbmNlb2YgQmxvYiB8fCBuLkZpbGUgJiYgdCBpbnN0YW5jZW9mIEZpbGUpIHJldHVybiAhMDtpZiAobyh0KSkgewogICAgICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykgaWYgKGUodFtyXSkpIHJldHVybiAhMDsKICAgICAgICAgICAgfSBlbHNlIGlmICh0ICYmICJvYmplY3QiID09IHR5cGVvZiB0KSB7CiAgICAgICAgICAgICAgdC50b0pTT04gJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgdC50b0pTT04gJiYgKHQgPSB0LnRvSlNPTigpKTtmb3IgKHZhciBpIGluIHQpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwgaSkgJiYgZSh0W2ldKSkgcmV0dXJuICEwOwogICAgICAgICAgICB9cmV0dXJuICExOwogICAgICAgICAgfXJldHVybiBlKHQpOwogICAgICAgIH12YXIgbyA9IHQoImlzYXJyYXkiKTtlLmV4cG9ydHMgPSByOwogICAgICB9KS5jYWxsKHRoaXMsICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWwgPyBnbG9iYWwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygc2VsZiA/IHNlbGYgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDoge30pOwogICAgfSwgeyBpc2FycmF5OiAyOCB9XSwgMjY6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICB0cnkgewogICAgICAgIGUuZXhwb3J0cyA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBYTUxIdHRwUmVxdWVzdCAmJiAid2l0aENyZWRlbnRpYWxzIiBpbiBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgfSBjYXRjaCAocikgewogICAgICAgIGUuZXhwb3J0cyA9ICExOwogICAgICB9CiAgICB9LCB7fV0sIDI3OiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgdmFyIHIgPSBbXS5pbmRleE9mO2UuZXhwb3J0cyA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgaWYgKHIpIHJldHVybiB0LmluZGV4T2YoZSk7Zm9yICh2YXIgbiA9IDA7IG4gPCB0Lmxlbmd0aDsgKytuKSBpZiAodFtuXSA9PT0gZSkgcmV0dXJuIG47cmV0dXJuIC0xOwogICAgICB9OwogICAgfSwge31dLCAyODogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGUuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gIltvYmplY3QgQXJyYXldIiA9PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDI5OiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgZnVuY3Rpb24gcih0KSB7CiAgICAgICAgaWYgKCh0ID0gIiIgKyB0LCAhKHQubGVuZ3RoID4gMWU0KSkpIHsKICAgICAgICAgIHZhciBlID0gL14oKD86XGQrKT9cLj9cZCspICoobWlsbGlzZWNvbmRzP3xtc2Vjcz98bXN8c2Vjb25kcz98c2Vjcz98c3xtaW51dGVzP3xtaW5zP3xtfGhvdXJzP3xocnM/fGh8ZGF5cz98ZHx5ZWFycz98eXJzP3x5KT8kL2kuZXhlYyh0KTtpZiAoZSkgewogICAgICAgICAgICB2YXIgbiA9IHBhcnNlRmxvYXQoZVsxXSksCiAgICAgICAgICAgICAgICByID0gKGVbMl0gfHwgIm1zIikudG9Mb3dlckNhc2UoKTtzd2l0Y2ggKHIpIHtjYXNlICJ5ZWFycyI6Y2FzZSAieWVhciI6Y2FzZSAieXJzIjpjYXNlICJ5ciI6Y2FzZSAieSI6CiAgICAgICAgICAgICAgICByZXR1cm4gbiAqIGY7Y2FzZSAiZGF5cyI6Y2FzZSAiZGF5IjpjYXNlICJkIjoKICAgICAgICAgICAgICAgIHJldHVybiBuICogdTtjYXNlICJob3VycyI6Y2FzZSAiaG91ciI6Y2FzZSAiaHJzIjpjYXNlICJociI6Y2FzZSAiaCI6CiAgICAgICAgICAgICAgICByZXR1cm4gbiAqIHA7Y2FzZSAibWludXRlcyI6Y2FzZSAibWludXRlIjpjYXNlICJtaW5zIjpjYXNlICJtaW4iOmNhc2UgIm0iOgogICAgICAgICAgICAgICAgcmV0dXJuIG4gKiBjO2Nhc2UgInNlY29uZHMiOmNhc2UgInNlY29uZCI6Y2FzZSAic2VjcyI6Y2FzZSAic2VjIjpjYXNlICJzIjoKICAgICAgICAgICAgICAgIHJldHVybiBuICogYTtjYXNlICJtaWxsaXNlY29uZHMiOmNhc2UgIm1pbGxpc2Vjb25kIjpjYXNlICJtc2VjcyI6Y2FzZSAibXNlYyI6Y2FzZSAibXMiOgogICAgICAgICAgICAgICAgcmV0dXJuIG47fQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfWZ1bmN0aW9uIG8odCkgewogICAgICAgIHJldHVybiB0ID49IHUgPyBNYXRoLnJvdW5kKHQgLyB1KSArICJkIiA6IHQgPj0gcCA/IE1hdGgucm91bmQodCAvIHApICsgImgiIDogdCA+PSBjID8gTWF0aC5yb3VuZCh0IC8gYykgKyAibSIgOiB0ID49IGEgPyBNYXRoLnJvdW5kKHQgLyBhKSArICJzIiA6IHQgKyAibXMiOwogICAgICB9ZnVuY3Rpb24gaSh0KSB7CiAgICAgICAgcmV0dXJuIHModCwgdSwgImRheSIpIHx8IHModCwgcCwgImhvdXIiKSB8fCBzKHQsIGMsICJtaW51dGUiKSB8fCBzKHQsIGEsICJzZWNvbmQiKSB8fCB0ICsgIiBtcyI7CiAgICAgIH1mdW5jdGlvbiBzKHQsIGUsIG4pIHsKICAgICAgICByZXR1cm4gZSA+IHQgPyB2b2lkIDAgOiAxLjUgKiBlID4gdCA/IE1hdGguZmxvb3IodCAvIGUpICsgIiAiICsgbiA6IE1hdGguY2VpbCh0IC8gZSkgKyAiICIgKyBuICsgInMiOwogICAgICB9dmFyIGEgPSAxZTMsCiAgICAgICAgICBjID0gNjAgKiBhLAogICAgICAgICAgcCA9IDYwICogYywKICAgICAgICAgIHUgPSAyNCAqIHAsCiAgICAgICAgICBmID0gMzY1LjI1ICogdTtlLmV4cG9ydHMgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiBlID0gZSB8fCB7fSwgInN0cmluZyIgPT0gdHlwZW9mIHQgPyByKHQpIDogZVsibG9uZyJdID8gaSh0KSA6IG8odCk7CiAgICAgIH07CiAgICB9LCB7fV0sIDMwOiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSAvXltcXSw6e31cc10qJC8sCiAgICAgICAgICAgIHIgPSAvXFwoPzpbIlxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLAogICAgICAgICAgICBvID0gLyJbXiJcXFxuXHJdKiJ8dHJ1ZXxmYWxzZXxudWxsfC0/XGQrKD86XC5cZCopPyg/OltlRV1bK1wtXT9cZCspPy9nLAogICAgICAgICAgICBpID0gLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywKICAgICAgICAgICAgcyA9IC9eXHMrLywKICAgICAgICAgICAgYSA9IC9ccyskLztlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiBlICYmIGUgPyAoZSA9IGUucmVwbGFjZShzLCAiIikucmVwbGFjZShhLCAiIiksIHQuSlNPTiAmJiBKU09OLnBhcnNlID8gSlNPTi5wYXJzZShlKSA6IG4udGVzdChlLnJlcGxhY2UociwgIkAiKS5yZXBsYWNlKG8sICJdIikucmVwbGFjZShpLCAiIikpID8gbmV3IEZ1bmN0aW9uKCJyZXR1cm4gIiArIGUpKCkgOiB2b2lkIDApIDogbnVsbDsKICAgICAgICB9OwogICAgICB9KS5jYWxsKHRoaXMsICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWwgPyBnbG9iYWwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygc2VsZiA/IHNlbGYgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDoge30pOwogICAgfSwge31dLCAzMTogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIG4uZW5jb2RlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9ICIiO2ZvciAodmFyIG4gaW4gdCkgdC5oYXNPd25Qcm9wZXJ0eShuKSAmJiAoZS5sZW5ndGggJiYgKGUgKz0gIiYiKSwgZSArPSBlbmNvZGVVUklDb21wb25lbnQobikgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQodFtuXSkpO3JldHVybiBlOwogICAgICB9LCBuLmRlY29kZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgZm9yICh2YXIgZSA9IHt9LCBuID0gdC5zcGxpdCgiJiIpLCByID0gMCwgbyA9IG4ubGVuZ3RoOyBvID4gcjsgcisrKSB7CiAgICAgICAgICB2YXIgaSA9IG5bcl0uc3BsaXQoIj0iKTtlW2RlY29kZVVSSUNvbXBvbmVudChpWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQoaVsxXSk7CiAgICAgICAgfXJldHVybiBlOwogICAgICB9OwogICAgfSwge31dLCAzMjogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIHZhciByID0gL14oPzooPyFbXjpAXSs6W146QFwvXSpAKShodHRwfGh0dHBzfHdzfHdzcyk6XC9cLyk/KCg/OigoW146QF0qKSg/OjooW146QF0qKSk/KT9AKT8oKD86W2EtZjAtOV17MCw0fTopezIsN31bYS1mMC05XXswLDR9fFteOlwvPyNdKikoPzo6KFxkKikpPykoKChcLyg/OltePyNdKD8hW14/I1wvXSpcLltePyNcLy5dKyg/Ols/I118JCkpKSpcLz8pPyhbXj8jXC9dKikpKD86XD8oW14jXSopKT8oPzojKC4qKSk/KS8sCiAgICAgICAgICBvID0gWyJzb3VyY2UiLCAicHJvdG9jb2wiLCAiYXV0aG9yaXR5IiwgInVzZXJJbmZvIiwgInVzZXIiLCAicGFzc3dvcmQiLCAiaG9zdCIsICJwb3J0IiwgInJlbGF0aXZlIiwgInBhdGgiLCAiZGlyZWN0b3J5IiwgImZpbGUiLCAicXVlcnkiLCAiYW5jaG9yIl07ZS5leHBvcnRzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IHQsCiAgICAgICAgICAgIG4gPSB0LmluZGV4T2YoIlsiKSwKICAgICAgICAgICAgaSA9IHQuaW5kZXhPZigiXSIpOy0xICE9IG4gJiYgLTEgIT0gaSAmJiAodCA9IHQuc3Vic3RyaW5nKDAsIG4pICsgdC5zdWJzdHJpbmcobiwgaSkucmVwbGFjZSgvOi9nLCAiOyIpICsgdC5zdWJzdHJpbmcoaSwgdC5sZW5ndGgpKTtmb3IgKHZhciBzID0gci5leGVjKHQgfHwgIiIpLCBhID0ge30sIGMgPSAxNDsgYy0tOykgYVtvW2NdXSA9IHNbY10gfHwgIiI7cmV0dXJuIC0xICE9IG4gJiYgLTEgIT0gaSAmJiAoYS5zb3VyY2UgPSBlLCBhLmhvc3QgPSBhLmhvc3Quc3Vic3RyaW5nKDEsIGEuaG9zdC5sZW5ndGggLSAxKS5yZXBsYWNlKC87L2csICI6IiksIGEuYXV0aG9yaXR5ID0gYS5hdXRob3JpdHkucmVwbGFjZSgiWyIsICIiKS5yZXBsYWNlKCJdIiwgIiIpLnJlcGxhY2UoLzsvZywgIjoiKSwgYS5pcHY2dXJpID0gITApLCBhOwogICAgICB9OwogICAgfSwge31dLCAzMzogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGZ1bmN0aW9uIHIodCwgZSkgewogICAgICAgICJvYmplY3QiID09IHR5cGVvZiB0ICYmIChlID0gdCwgdCA9IHZvaWQgMCksIGUgPSBlIHx8IHt9O3ZhciBuLAogICAgICAgICAgICByID0gbyh0KSwKICAgICAgICAgICAgaSA9IHIuc291cmNlLAogICAgICAgICAgICBwID0gci5pZCwKICAgICAgICAgICAgdSA9IHIucGF0aCwKICAgICAgICAgICAgZiA9IGNbcF0gJiYgdSBpbiBjW3BdLm5zcHMsCiAgICAgICAgICAgIGggPSBlLmZvcmNlTmV3IHx8IGVbImZvcmNlIG5ldyBjb25uZWN0aW9uIl0gfHwgITEgPT09IGUubXVsdGlwbGV4IHx8IGY7cmV0dXJuIGggPyAoYSgiaWdub3Jpbmcgc29ja2V0IGNhY2hlIGZvciAlcyIsIGkpLCBuID0gcyhpLCBlKSkgOiAoY1twXSB8fCAoYSgibmV3IGlvIGluc3RhbmNlIGZvciAlcyIsIGkpLCBjW3BdID0gcyhpLCBlKSksIG4gPSBjW3BdKSwgbi5zb2NrZXQoci5wYXRoKTsKICAgICAgfXZhciBvID0gdCgiLi91cmwiKSwKICAgICAgICAgIGkgPSB0KCJzb2NrZXQuaW8tcGFyc2VyIiksCiAgICAgICAgICBzID0gdCgiLi9tYW5hZ2VyIiksCiAgICAgICAgICBhID0gdCgiZGVidWciKSgic29ja2V0LmlvLWNsaWVudCIpO2UuZXhwb3J0cyA9IG4gPSByO3ZhciBjID0gbi5tYW5hZ2VycyA9IHt9O24ucHJvdG9jb2wgPSBpLnByb3RvY29sLCBuLmNvbm5lY3QgPSByLCBuLk1hbmFnZXIgPSB0KCIuL21hbmFnZXIiKSwgbi5Tb2NrZXQgPSB0KCIuL3NvY2tldCIpOwogICAgfSwgeyAiLi9tYW5hZ2VyIjogMzQsICIuL3NvY2tldCI6IDM2LCAiLi91cmwiOiAzNywgZGVidWc6IDEwLCAic29ja2V0LmlvLXBhcnNlciI6IDQxIH1dLCAzNDogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGZ1bmN0aW9uIHIodCwgZSkgewogICAgICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgciA/ICh0ICYmICJvYmplY3QiID09IHR5cGVvZiB0ICYmIChlID0gdCwgdCA9IHZvaWQgMCksIGUgPSBlIHx8IHt9LCBlLnBhdGggPSBlLnBhdGggfHwgIi9zb2NrZXQuaW8iLCB0aGlzLm5zcHMgPSB7fSwgdGhpcy5zdWJzID0gW10sIHRoaXMub3B0cyA9IGUsIHRoaXMucmVjb25uZWN0aW9uKGUucmVjb25uZWN0aW9uICE9PSAhMSksIHRoaXMucmVjb25uZWN0aW9uQXR0ZW1wdHMoZS5yZWNvbm5lY3Rpb25BdHRlbXB0cyB8fCAxIC8gMCksIHRoaXMucmVjb25uZWN0aW9uRGVsYXkoZS5yZWNvbm5lY3Rpb25EZWxheSB8fCAxZTMpLCB0aGlzLnJlY29ubmVjdGlvbkRlbGF5TWF4KGUucmVjb25uZWN0aW9uRGVsYXlNYXggfHwgNWUzKSwgdGhpcy5yYW5kb21pemF0aW9uRmFjdG9yKGUucmFuZG9taXphdGlvbkZhY3RvciB8fCAuNSksIHRoaXMuYmFja29mZiA9IG5ldyBoKHsgbWluOiB0aGlzLnJlY29ubmVjdGlvbkRlbGF5KCksIG1heDogdGhpcy5yZWNvbm5lY3Rpb25EZWxheU1heCgpLCBqaXR0ZXI6IHRoaXMucmFuZG9taXphdGlvbkZhY3RvcigpIH0pLCB0aGlzLnRpbWVvdXQobnVsbCA9PSBlLnRpbWVvdXQgPyAyZTQgOiBlLnRpbWVvdXQpLCB0aGlzLnJlYWR5U3RhdGUgPSAiY2xvc2VkIiwgdGhpcy51cmkgPSB0LCB0aGlzLmNvbm5lY3RpbmcgPSBbXSwgdGhpcy5sYXN0UGluZyA9IG51bGwsIHRoaXMuZW5jb2RpbmcgPSAhMSwgdGhpcy5wYWNrZXRCdWZmZXIgPSBbXSwgdGhpcy5lbmNvZGVyID0gbmV3IGEuRW5jb2RlcigpLCB0aGlzLmRlY29kZXIgPSBuZXcgYS5EZWNvZGVyKCksIHRoaXMuYXV0b0Nvbm5lY3QgPSBlLmF1dG9Db25uZWN0ICE9PSAhMSwgdm9pZCAodGhpcy5hdXRvQ29ubmVjdCAmJiB0aGlzLm9wZW4oKSkpIDogbmV3IHIodCwgZSk7CiAgICAgIH12YXIgbyA9IHQoImVuZ2luZS5pby1jbGllbnQiKSwKICAgICAgICAgIGkgPSB0KCIuL3NvY2tldCIpLAogICAgICAgICAgcyA9IHQoImNvbXBvbmVudC1lbWl0dGVyIiksCiAgICAgICAgICBhID0gdCgic29ja2V0LmlvLXBhcnNlciIpLAogICAgICAgICAgYyA9IHQoIi4vb24iKSwKICAgICAgICAgIHAgPSB0KCJjb21wb25lbnQtYmluZCIpLAogICAgICAgICAgdSA9IHQoImRlYnVnIikoInNvY2tldC5pby1jbGllbnQ6bWFuYWdlciIpLAogICAgICAgICAgZiA9IHQoImluZGV4b2YiKSwKICAgICAgICAgIGggPSB0KCJiYWNrbzIiKSwKICAgICAgICAgIGwgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O2UuZXhwb3J0cyA9IHIsIHIucHJvdG90eXBlLmVtaXRBbGwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5lbWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Zm9yICh2YXIgdCBpbiB0aGlzLm5zcHMpIGwuY2FsbCh0aGlzLm5zcHMsIHQpICYmIHRoaXMubnNwc1t0XS5lbWl0LmFwcGx5KHRoaXMubnNwc1t0XSwgYXJndW1lbnRzKTsKICAgICAgfSwgci5wcm90b3R5cGUudXBkYXRlU29ja2V0SWRzID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZvciAodmFyIHQgaW4gdGhpcy5uc3BzKSBsLmNhbGwodGhpcy5uc3BzLCB0KSAmJiAodGhpcy5uc3BzW3RdLmlkID0gdGhpcy5lbmdpbmUuaWQpOwogICAgICB9LCBzKHIucHJvdG90eXBlKSwgci5wcm90b3R5cGUucmVjb25uZWN0aW9uID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aGlzLl9yZWNvbm5lY3Rpb24gPSAhIXQsIHRoaXMpIDogdGhpcy5fcmVjb25uZWN0aW9uOwogICAgICB9LCByLnByb3RvdHlwZS5yZWNvbm5lY3Rpb25BdHRlbXB0cyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGhpcy5fcmVjb25uZWN0aW9uQXR0ZW1wdHMgPSB0LCB0aGlzKSA6IHRoaXMuX3JlY29ubmVjdGlvbkF0dGVtcHRzOwogICAgICB9LCByLnByb3RvdHlwZS5yZWNvbm5lY3Rpb25EZWxheSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGhpcy5fcmVjb25uZWN0aW9uRGVsYXkgPSB0LCB0aGlzLmJhY2tvZmYgJiYgdGhpcy5iYWNrb2ZmLnNldE1pbih0KSwgdGhpcykgOiB0aGlzLl9yZWNvbm5lY3Rpb25EZWxheTsKICAgICAgfSwgci5wcm90b3R5cGUucmFuZG9taXphdGlvbkZhY3RvciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGhpcy5fcmFuZG9taXphdGlvbkZhY3RvciA9IHQsIHRoaXMuYmFja29mZiAmJiB0aGlzLmJhY2tvZmYuc2V0Sml0dGVyKHQpLCB0aGlzKSA6IHRoaXMuX3JhbmRvbWl6YXRpb25GYWN0b3I7CiAgICAgIH0sIHIucHJvdG90eXBlLnJlY29ubmVjdGlvbkRlbGF5TWF4ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aGlzLl9yZWNvbm5lY3Rpb25EZWxheU1heCA9IHQsIHRoaXMuYmFja29mZiAmJiB0aGlzLmJhY2tvZmYuc2V0TWF4KHQpLCB0aGlzKSA6IHRoaXMuX3JlY29ubmVjdGlvbkRlbGF5TWF4OwogICAgICB9LCByLnByb3RvdHlwZS50aW1lb3V0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aGlzLl90aW1lb3V0ID0gdCwgdGhpcykgOiB0aGlzLl90aW1lb3V0OwogICAgICB9LCByLnByb3RvdHlwZS5tYXliZVJlY29ubmVjdE9uT3BlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAhdGhpcy5yZWNvbm5lY3RpbmcgJiYgdGhpcy5fcmVjb25uZWN0aW9uICYmIDAgPT09IHRoaXMuYmFja29mZi5hdHRlbXB0cyAmJiB0aGlzLnJlY29ubmVjdCgpOwogICAgICB9LCByLnByb3RvdHlwZS5vcGVuID0gci5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKCh1KCJyZWFkeVN0YXRlICVzIiwgdGhpcy5yZWFkeVN0YXRlKSwgfnRoaXMucmVhZHlTdGF0ZS5pbmRleE9mKCJvcGVuIikpKSByZXR1cm4gdGhpczt1KCJvcGVuaW5nICVzIiwgdGhpcy51cmkpLCB0aGlzLmVuZ2luZSA9IG8odGhpcy51cmksIHRoaXMub3B0cyk7dmFyIGUgPSB0aGlzLmVuZ2luZSwKICAgICAgICAgICAgbiA9IHRoaXM7dGhpcy5yZWFkeVN0YXRlID0gIm9wZW5pbmciLCB0aGlzLnNraXBSZWNvbm5lY3QgPSAhMTt2YXIgciA9IGMoZSwgIm9wZW4iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBuLm9ub3BlbigpLCB0ICYmIHQoKTsKICAgICAgICB9KSwKICAgICAgICAgICAgaSA9IGMoZSwgImVycm9yIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmICgodSgiY29ubmVjdF9lcnJvciIpLCBuLmNsZWFudXAoKSwgbi5yZWFkeVN0YXRlID0gImNsb3NlZCIsIG4uZW1pdEFsbCgiY29ubmVjdF9lcnJvciIsIGUpLCB0KSkgewogICAgICAgICAgICB2YXIgciA9IG5ldyBFcnJvcigiQ29ubmVjdGlvbiBlcnJvciIpO3IuZGF0YSA9IGUsIHQocik7CiAgICAgICAgICB9IGVsc2Ugbi5tYXliZVJlY29ubmVjdE9uT3BlbigpOwogICAgICAgIH0pO2lmICghMSAhPT0gdGhpcy5fdGltZW91dCkgewogICAgICAgICAgdmFyIHMgPSB0aGlzLl90aW1lb3V0O3UoImNvbm5lY3QgYXR0ZW1wdCB3aWxsIHRpbWVvdXQgYWZ0ZXIgJWQiLCBzKTt2YXIgYSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB1KCJjb25uZWN0IGF0dGVtcHQgdGltZWQgb3V0IGFmdGVyICVkIiwgcyksIHIuZGVzdHJveSgpLCBlLmNsb3NlKCksIGUuZW1pdCgiZXJyb3IiLCAidGltZW91dCIpLCBuLmVtaXRBbGwoImNvbm5lY3RfdGltZW91dCIsIHMpOwogICAgICAgICAgfSwgcyk7dGhpcy5zdWJzLnB1c2goeyBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgIGNsZWFyVGltZW91dChhKTsKICAgICAgICAgICAgfSB9KTsKICAgICAgICB9cmV0dXJuIHRoaXMuc3Vicy5wdXNoKHIpLCB0aGlzLnN1YnMucHVzaChpKSwgdGhpczsKICAgICAgfSwgci5wcm90b3R5cGUub25vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIHUoIm9wZW4iKSwgdGhpcy5jbGVhbnVwKCksIHRoaXMucmVhZHlTdGF0ZSA9ICJvcGVuIiwgdGhpcy5lbWl0KCJvcGVuIik7dmFyIHQgPSB0aGlzLmVuZ2luZTt0aGlzLnN1YnMucHVzaChjKHQsICJkYXRhIiwgcCh0aGlzLCAib25kYXRhIikpKSwgdGhpcy5zdWJzLnB1c2goYyh0LCAicGluZyIsIHAodGhpcywgIm9ucGluZyIpKSksIHRoaXMuc3Vicy5wdXNoKGModCwgInBvbmciLCBwKHRoaXMsICJvbnBvbmciKSkpLCB0aGlzLnN1YnMucHVzaChjKHQsICJlcnJvciIsIHAodGhpcywgIm9uZXJyb3IiKSkpLCB0aGlzLnN1YnMucHVzaChjKHQsICJjbG9zZSIsIHAodGhpcywgIm9uY2xvc2UiKSkpLCB0aGlzLnN1YnMucHVzaChjKHRoaXMuZGVjb2RlciwgImRlY29kZWQiLCBwKHRoaXMsICJvbmRlY29kZWQiKSkpOwogICAgICB9LCByLnByb3RvdHlwZS5vbnBpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5sYXN0UGluZyA9IG5ldyBEYXRlKCksIHRoaXMuZW1pdEFsbCgicGluZyIpOwogICAgICB9LCByLnByb3RvdHlwZS5vbnBvbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5lbWl0QWxsKCJwb25nIiwgbmV3IERhdGUoKSAtIHRoaXMubGFzdFBpbmcpOwogICAgICB9LCByLnByb3RvdHlwZS5vbmRhdGEgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHRoaXMuZGVjb2Rlci5hZGQodCk7CiAgICAgIH0sIHIucHJvdG90eXBlLm9uZGVjb2RlZCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdGhpcy5lbWl0KCJwYWNrZXQiLCB0KTsKICAgICAgfSwgci5wcm90b3R5cGUub25lcnJvciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdSgiZXJyb3IiLCB0KSwgdGhpcy5lbWl0QWxsKCJlcnJvciIsIHQpOwogICAgICB9LCByLnByb3RvdHlwZS5zb2NrZXQgPSBmdW5jdGlvbiAodCkgewogICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICB+ZihyLmNvbm5lY3RpbmcsIG4pIHx8IHIuY29ubmVjdGluZy5wdXNoKG4pOwogICAgICAgIH12YXIgbiA9IHRoaXMubnNwc1t0XTtpZiAoIW4pIHsKICAgICAgICAgIG4gPSBuZXcgaSh0aGlzLCB0KSwgdGhpcy5uc3BzW3RdID0gbjt2YXIgciA9IHRoaXM7bi5vbigiY29ubmVjdGluZyIsIGUpLCBuLm9uKCJjb25uZWN0IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBuLmlkID0gci5lbmdpbmUuaWQ7CiAgICAgICAgICB9KSwgdGhpcy5hdXRvQ29ubmVjdCAmJiBlKCk7CiAgICAgICAgfXJldHVybiBuOwogICAgICB9LCByLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IGYodGhpcy5jb25uZWN0aW5nLCB0KTt+ZSAmJiB0aGlzLmNvbm5lY3Rpbmcuc3BsaWNlKGUsIDEpLCB0aGlzLmNvbm5lY3RpbmcubGVuZ3RoIHx8IHRoaXMuY2xvc2UoKTsKICAgICAgfSwgci5wcm90b3R5cGUucGFja2V0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB1KCJ3cml0aW5nIHBhY2tldCAlaiIsIHQpO3ZhciBlID0gdGhpcztlLmVuY29kaW5nID8gZS5wYWNrZXRCdWZmZXIucHVzaCh0KSA6IChlLmVuY29kaW5nID0gITAsIHRoaXMuZW5jb2Rlci5lbmNvZGUodCwgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgbi5sZW5ndGg7IHIrKykgZS5lbmdpbmUud3JpdGUobltyXSwgdC5vcHRpb25zKTtlLmVuY29kaW5nID0gITEsIGUucHJvY2Vzc1BhY2tldFF1ZXVlKCk7CiAgICAgICAgfSkpOwogICAgICB9LCByLnByb3RvdHlwZS5wcm9jZXNzUGFja2V0UXVldWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMucGFja2V0QnVmZmVyLmxlbmd0aCA+IDAgJiYgIXRoaXMuZW5jb2RpbmcpIHsKICAgICAgICAgIHZhciB0ID0gdGhpcy5wYWNrZXRCdWZmZXIuc2hpZnQoKTt0aGlzLnBhY2tldCh0KTsKICAgICAgICB9CiAgICAgIH0sIHIucHJvdG90eXBlLmNsZWFudXAgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdSgiY2xlYW51cCIpO2ZvciAodmFyIHQ7IHQgPSB0aGlzLnN1YnMuc2hpZnQoKTspIHQuZGVzdHJveSgpO3RoaXMucGFja2V0QnVmZmVyID0gW10sIHRoaXMuZW5jb2RpbmcgPSAhMSwgdGhpcy5sYXN0UGluZyA9IG51bGwsIHRoaXMuZGVjb2Rlci5kZXN0cm95KCk7CiAgICAgIH0sIHIucHJvdG90eXBlLmNsb3NlID0gci5wcm90b3R5cGUuZGlzY29ubmVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB1KCJkaXNjb25uZWN0IiksIHRoaXMuc2tpcFJlY29ubmVjdCA9ICEwLCB0aGlzLnJlY29ubmVjdGluZyA9ICExLCAib3BlbmluZyIgPT0gdGhpcy5yZWFkeVN0YXRlICYmIHRoaXMuY2xlYW51cCgpLCB0aGlzLmJhY2tvZmYucmVzZXQoKSwgdGhpcy5yZWFkeVN0YXRlID0gImNsb3NlZCIsIHRoaXMuZW5naW5lICYmIHRoaXMuZW5naW5lLmNsb3NlKCk7CiAgICAgIH0sIHIucHJvdG90eXBlLm9uY2xvc2UgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHUoIm9uY2xvc2UiKSwgdGhpcy5jbGVhbnVwKCksIHRoaXMuYmFja29mZi5yZXNldCgpLCB0aGlzLnJlYWR5U3RhdGUgPSAiY2xvc2VkIiwgdGhpcy5lbWl0KCJjbG9zZSIsIHQpLCB0aGlzLl9yZWNvbm5lY3Rpb24gJiYgIXRoaXMuc2tpcFJlY29ubmVjdCAmJiB0aGlzLnJlY29ubmVjdCgpOwogICAgICB9LCByLnByb3RvdHlwZS5yZWNvbm5lY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMucmVjb25uZWN0aW5nIHx8IHRoaXMuc2tpcFJlY29ubmVjdCkgcmV0dXJuIHRoaXM7dmFyIHQgPSB0aGlzO2lmICh0aGlzLmJhY2tvZmYuYXR0ZW1wdHMgPj0gdGhpcy5fcmVjb25uZWN0aW9uQXR0ZW1wdHMpIHUoInJlY29ubmVjdCBmYWlsZWQiKSwgdGhpcy5iYWNrb2ZmLnJlc2V0KCksIHRoaXMuZW1pdEFsbCgicmVjb25uZWN0X2ZhaWxlZCIpLCB0aGlzLnJlY29ubmVjdGluZyA9ICExO2Vsc2UgewogICAgICAgICAgdmFyIGUgPSB0aGlzLmJhY2tvZmYuZHVyYXRpb24oKTt1KCJ3aWxsIHdhaXQgJWRtcyBiZWZvcmUgcmVjb25uZWN0IGF0dGVtcHQiLCBlKSwgdGhpcy5yZWNvbm5lY3RpbmcgPSAhMDt2YXIgbiA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0LnNraXBSZWNvbm5lY3QgfHwgKHUoImF0dGVtcHRpbmcgcmVjb25uZWN0IiksIHQuZW1pdEFsbCgicmVjb25uZWN0X2F0dGVtcHQiLCB0LmJhY2tvZmYuYXR0ZW1wdHMpLCB0LmVtaXRBbGwoInJlY29ubmVjdGluZyIsIHQuYmFja29mZi5hdHRlbXB0cyksIHQuc2tpcFJlY29ubmVjdCB8fCB0Lm9wZW4oZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBlID8gKHUoInJlY29ubmVjdCBhdHRlbXB0IGVycm9yIiksIHQucmVjb25uZWN0aW5nID0gITEsIHQucmVjb25uZWN0KCksIHQuZW1pdEFsbCgicmVjb25uZWN0X2Vycm9yIiwgZS5kYXRhKSkgOiAodSgicmVjb25uZWN0IHN1Y2Nlc3MiKSwgdC5vbnJlY29ubmVjdCgpKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSwgZSk7dGhpcy5zdWJzLnB1c2goeyBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgIGNsZWFyVGltZW91dChuKTsKICAgICAgICAgICAgfSB9KTsKICAgICAgICB9CiAgICAgIH0sIHIucHJvdG90eXBlLm9ucmVjb25uZWN0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gdGhpcy5iYWNrb2ZmLmF0dGVtcHRzO3RoaXMucmVjb25uZWN0aW5nID0gITEsIHRoaXMuYmFja29mZi5yZXNldCgpLCB0aGlzLnVwZGF0ZVNvY2tldElkcygpLCB0aGlzLmVtaXRBbGwoInJlY29ubmVjdCIsIHQpOwogICAgICB9OwogICAgfSwgeyAiLi9vbiI6IDM1LCAiLi9zb2NrZXQiOiAzNiwgYmFja28yOiAzLCAiY29tcG9uZW50LWJpbmQiOiA3LCAiY29tcG9uZW50LWVtaXR0ZXIiOiAzOCwgZGVidWc6IDEwLCAiZW5naW5lLmlvLWNsaWVudCI6IDEyLCBpbmRleG9mOiAyNywgInNvY2tldC5pby1wYXJzZXIiOiA0MSB9XSwgMzU6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBmdW5jdGlvbiByKHQsIGUsIG4pIHsKICAgICAgICByZXR1cm4gdC5vbihlLCBuKSwgeyBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICB0LnJlbW92ZUxpc3RlbmVyKGUsIG4pOwogICAgICAgICAgfSB9OwogICAgICB9ZS5leHBvcnRzID0gcjsKICAgIH0sIHt9XSwgMzY6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBmdW5jdGlvbiByKHQsIGUpIHsKICAgICAgICB0aGlzLmlvID0gdCwgdGhpcy5uc3AgPSBlLCB0aGlzLmpzb24gPSB0aGlzLCB0aGlzLmlkcyA9IDAsIHRoaXMuYWNrcyA9IHt9LCB0aGlzLnJlY2VpdmVCdWZmZXIgPSBbXSwgdGhpcy5zZW5kQnVmZmVyID0gW10sIHRoaXMuY29ubmVjdGVkID0gITEsIHRoaXMuZGlzY29ubmVjdGVkID0gITAsIHRoaXMuaW8uYXV0b0Nvbm5lY3QgJiYgdGhpcy5vcGVuKCk7CiAgICAgIH12YXIgbyA9IHQoInNvY2tldC5pby1wYXJzZXIiKSwKICAgICAgICAgIGkgPSB0KCJjb21wb25lbnQtZW1pdHRlciIpLAogICAgICAgICAgcyA9IHQoInRvLWFycmF5IiksCiAgICAgICAgICBhID0gdCgiLi9vbiIpLAogICAgICAgICAgYyA9IHQoImNvbXBvbmVudC1iaW5kIiksCiAgICAgICAgICBwID0gdCgiZGVidWciKSgic29ja2V0LmlvLWNsaWVudDpzb2NrZXQiKSwKICAgICAgICAgIHUgPSB0KCJoYXMtYmluYXJ5Iik7ZS5leHBvcnRzID0gbiA9IHI7dmFyIGYgPSB7IGNvbm5lY3Q6IDEsIGNvbm5lY3RfZXJyb3I6IDEsIGNvbm5lY3RfdGltZW91dDogMSwgY29ubmVjdGluZzogMSwgZGlzY29ubmVjdDogMSwgZXJyb3I6IDEsIHJlY29ubmVjdDogMSwgcmVjb25uZWN0X2F0dGVtcHQ6IDEsIHJlY29ubmVjdF9mYWlsZWQ6IDEsIHJlY29ubmVjdF9lcnJvcjogMSwgcmVjb25uZWN0aW5nOiAxLCBwaW5nOiAxLCBwb25nOiAxIH0sCiAgICAgICAgICBoID0gaS5wcm90b3R5cGUuZW1pdDtpKHIucHJvdG90eXBlKSwgci5wcm90b3R5cGUuc3ViRXZlbnRzID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghdGhpcy5zdWJzKSB7CiAgICAgICAgICB2YXIgdCA9IHRoaXMuaW87dGhpcy5zdWJzID0gW2EodCwgIm9wZW4iLCBjKHRoaXMsICJvbm9wZW4iKSksIGEodCwgInBhY2tldCIsIGModGhpcywgIm9ucGFja2V0IikpLCBhKHQsICJjbG9zZSIsIGModGhpcywgIm9uY2xvc2UiKSldOwogICAgICAgIH0KICAgICAgfSwgci5wcm90b3R5cGUub3BlbiA9IHIucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkID8gdGhpcyA6ICh0aGlzLnN1YkV2ZW50cygpLCB0aGlzLmlvLm9wZW4oKSwgIm9wZW4iID09IHRoaXMuaW8ucmVhZHlTdGF0ZSAmJiB0aGlzLm9ub3BlbigpLCB0aGlzLmVtaXQoImNvbm5lY3RpbmciKSwgdGhpcyk7CiAgICAgIH0sIHIucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSBzKGFyZ3VtZW50cyk7cmV0dXJuIHQudW5zaGlmdCgibWVzc2FnZSIpLCB0aGlzLmVtaXQuYXBwbHkodGhpcywgdCksIHRoaXM7CiAgICAgIH0sIHIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiAodCkgewogICAgICAgIGlmIChmLmhhc093blByb3BlcnR5KHQpKSByZXR1cm4gaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0aGlzO3ZhciBlID0gcyhhcmd1bWVudHMpLAogICAgICAgICAgICBuID0gby5FVkVOVDt1KGUpICYmIChuID0gby5CSU5BUllfRVZFTlQpO3ZhciByID0geyB0eXBlOiBuLCBkYXRhOiBlIH07cmV0dXJuIHIub3B0aW9ucyA9IHt9LCByLm9wdGlvbnMuY29tcHJlc3MgPSAhdGhpcy5mbGFncyB8fCAhMSAhPT0gdGhpcy5mbGFncy5jb21wcmVzcywgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZVtlLmxlbmd0aCAtIDFdICYmIChwKCJlbWl0dGluZyBwYWNrZXQgd2l0aCBhY2sgaWQgJWQiLCB0aGlzLmlkcyksIHRoaXMuYWNrc1t0aGlzLmlkc10gPSBlLnBvcCgpLCByLmlkID0gdGhpcy5pZHMrKyksIHRoaXMuY29ubmVjdGVkID8gdGhpcy5wYWNrZXQocikgOiB0aGlzLnNlbmRCdWZmZXIucHVzaChyKSwgZGVsZXRlIHRoaXMuZmxhZ3MsIHRoaXM7CiAgICAgIH0sIHIucHJvdG90eXBlLnBhY2tldCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdC5uc3AgPSB0aGlzLm5zcCwgdGhpcy5pby5wYWNrZXQodCk7CiAgICAgIH0sIHIucHJvdG90eXBlLm9ub3BlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBwKCJ0cmFuc3BvcnQgaXMgb3BlbiAtIGNvbm5lY3RpbmciKSwgIi8iICE9IHRoaXMubnNwICYmIHRoaXMucGFja2V0KHsgdHlwZTogby5DT05ORUNUIH0pOwogICAgICB9LCByLnByb3RvdHlwZS5vbmNsb3NlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICBwKCJjbG9zZSAoJXMpIiwgdCksIHRoaXMuY29ubmVjdGVkID0gITEsIHRoaXMuZGlzY29ubmVjdGVkID0gITAsIGRlbGV0ZSB0aGlzLmlkLCB0aGlzLmVtaXQoImRpc2Nvbm5lY3QiLCB0KTsKICAgICAgfSwgci5wcm90b3R5cGUub25wYWNrZXQgPSBmdW5jdGlvbiAodCkgewogICAgICAgIGlmICh0Lm5zcCA9PSB0aGlzLm5zcCkgc3dpdGNoICh0LnR5cGUpIHtjYXNlIG8uQ09OTkVDVDoKICAgICAgICAgICAgdGhpcy5vbmNvbm5lY3QoKTticmVhaztjYXNlIG8uRVZFTlQ6CiAgICAgICAgICAgIHRoaXMub25ldmVudCh0KTticmVhaztjYXNlIG8uQklOQVJZX0VWRU5UOgogICAgICAgICAgICB0aGlzLm9uZXZlbnQodCk7YnJlYWs7Y2FzZSBvLkFDSzoKICAgICAgICAgICAgdGhpcy5vbmFjayh0KTticmVhaztjYXNlIG8uQklOQVJZX0FDSzoKICAgICAgICAgICAgdGhpcy5vbmFjayh0KTticmVhaztjYXNlIG8uRElTQ09OTkVDVDoKICAgICAgICAgICAgdGhpcy5vbmRpc2Nvbm5lY3QoKTticmVhaztjYXNlIG8uRVJST1I6CiAgICAgICAgICAgIHRoaXMuZW1pdCgiZXJyb3IiLCB0LmRhdGEpO30KICAgICAgfSwgci5wcm90b3R5cGUub25ldmVudCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGUgPSB0LmRhdGEgfHwgW107cCgiZW1pdHRpbmcgZXZlbnQgJWoiLCBlKSwgbnVsbCAhPSB0LmlkICYmIChwKCJhdHRhY2hpbmcgYWNrIGNhbGxiYWNrIHRvIGV2ZW50IiksIGUucHVzaCh0aGlzLmFjayh0LmlkKSkpLCB0aGlzLmNvbm5lY3RlZCA/IGguYXBwbHkodGhpcywgZSkgOiB0aGlzLnJlY2VpdmVCdWZmZXIucHVzaChlKTsKICAgICAgfSwgci5wcm90b3R5cGUuYWNrID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgZSA9IHRoaXMsCiAgICAgICAgICAgIG4gPSAhMTtyZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFuKSB7CiAgICAgICAgICAgIG4gPSAhMDt2YXIgciA9IHMoYXJndW1lbnRzKTtwKCJzZW5kaW5nIGFjayAlaiIsIHIpO3ZhciBpID0gdShyKSA/IG8uQklOQVJZX0FDSyA6IG8uQUNLO2UucGFja2V0KHsgdHlwZTogaSwgaWQ6IHQsIGRhdGE6IHIgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSwgci5wcm90b3R5cGUub25hY2sgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBlID0gdGhpcy5hY2tzW3QuaWRdOyJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyAocCgiY2FsbGluZyBhY2sgJXMgd2l0aCAlaiIsIHQuaWQsIHQuZGF0YSksIGUuYXBwbHkodGhpcywgdC5kYXRhKSwgZGVsZXRlIHRoaXMuYWNrc1t0LmlkXSkgOiBwKCJiYWQgYWNrICVzIiwgdC5pZCk7CiAgICAgIH0sIHIucHJvdG90eXBlLm9uY29ubmVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9ICEwLCB0aGlzLmRpc2Nvbm5lY3RlZCA9ICExLCB0aGlzLmVtaXQoImNvbm5lY3QiKSwgdGhpcy5lbWl0QnVmZmVyZWQoKTsKICAgICAgfSwgci5wcm90b3R5cGUuZW1pdEJ1ZmZlcmVkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0O2ZvciAodCA9IDA7IHQgPCB0aGlzLnJlY2VpdmVCdWZmZXIubGVuZ3RoOyB0KyspIGguYXBwbHkodGhpcywgdGhpcy5yZWNlaXZlQnVmZmVyW3RdKTtmb3IgKHRoaXMucmVjZWl2ZUJ1ZmZlciA9IFtdLCB0ID0gMDsgdCA8IHRoaXMuc2VuZEJ1ZmZlci5sZW5ndGg7IHQrKykgdGhpcy5wYWNrZXQodGhpcy5zZW5kQnVmZmVyW3RdKTt0aGlzLnNlbmRCdWZmZXIgPSBbXTsKICAgICAgfSwgci5wcm90b3R5cGUub25kaXNjb25uZWN0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHAoInNlcnZlciBkaXNjb25uZWN0ICglcykiLCB0aGlzLm5zcCksIHRoaXMuZGVzdHJveSgpLCB0aGlzLm9uY2xvc2UoImlvIHNlcnZlciBkaXNjb25uZWN0Iik7CiAgICAgIH0sIHIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMuc3VicykgewogICAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCB0aGlzLnN1YnMubGVuZ3RoOyB0KyspIHRoaXMuc3Vic1t0XS5kZXN0cm95KCk7dGhpcy5zdWJzID0gbnVsbDsKICAgICAgICB9dGhpcy5pby5kZXN0cm95KHRoaXMpOwogICAgICB9LCByLnByb3RvdHlwZS5jbG9zZSA9IHIucHJvdG90eXBlLmRpc2Nvbm5lY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkICYmIChwKCJwZXJmb3JtaW5nIGRpc2Nvbm5lY3QgKCVzKSIsIHRoaXMubnNwKSwgdGhpcy5wYWNrZXQoeyB0eXBlOiBvLkRJU0NPTk5FQ1QgfSkpLCB0aGlzLmRlc3Ryb3koKSwgdGhpcy5jb25uZWN0ZWQgJiYgdGhpcy5vbmNsb3NlKCJpbyBjbGllbnQgZGlzY29ubmVjdCIpLCB0aGlzOwogICAgICB9LCByLnByb3RvdHlwZS5jb21wcmVzcyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmxhZ3MgPSB0aGlzLmZsYWdzIHx8IHt9LCB0aGlzLmZsYWdzLmNvbXByZXNzID0gdCwgdGhpczsKICAgICAgfTsKICAgIH0sIHsgIi4vb24iOiAzNSwgImNvbXBvbmVudC1iaW5kIjogNywgImNvbXBvbmVudC1lbWl0dGVyIjogMzgsIGRlYnVnOiAxMCwgImhhcy1iaW5hcnkiOiAyNSwgInNvY2tldC5pby1wYXJzZXIiOiA0MSwgInRvLWFycmF5IjogNDQgfV0sIDM3OiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgZnVuY3Rpb24gcih0LCBlKSB7CiAgICAgICAgICB2YXIgciA9IHQsCiAgICAgICAgICAgICAgZSA9IGUgfHwgbi5sb2NhdGlvbjtudWxsID09IHQgJiYgKHQgPSBlLnByb3RvY29sICsgIi8vIiArIGUuaG9zdCksICJzdHJpbmciID09IHR5cGVvZiB0ICYmICgiLyIgPT0gdC5jaGFyQXQoMCkgJiYgKHQgPSAiLyIgPT0gdC5jaGFyQXQoMSkgPyBlLnByb3RvY29sICsgdCA6IGUuaG9zdCArIHQpLCAvXihodHRwcz98d3NzPyk6XC9cLy8udGVzdCh0KSB8fCAoaSgicHJvdG9jb2wtbGVzcyB1cmwgJXMiLCB0KSwgdCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBlID8gZS5wcm90b2NvbCArICIvLyIgKyB0IDogImh0dHBzOi8vIiArIHQpLCBpKCJwYXJzZSAlcyIsIHQpLCByID0gbyh0KSksIHIucG9ydCB8fCAoL14oaHR0cHx3cykkLy50ZXN0KHIucHJvdG9jb2wpID8gci5wb3J0ID0gIjgwIiA6IC9eKGh0dHB8d3MpcyQvLnRlc3Qoci5wcm90b2NvbCkgJiYgKHIucG9ydCA9ICI0NDMiKSksIHIucGF0aCA9IHIucGF0aCB8fCAiLyI7dmFyIHMgPSAtMSAhPT0gci5ob3N0LmluZGV4T2YoIjoiKSwKICAgICAgICAgICAgICBhID0gcyA/ICJbIiArIHIuaG9zdCArICJdIiA6IHIuaG9zdDtyZXR1cm4gci5pZCA9IHIucHJvdG9jb2wgKyAiOi8vIiArIGEgKyAiOiIgKyByLnBvcnQsIHIuaHJlZiA9IHIucHJvdG9jb2wgKyAiOi8vIiArIGEgKyAoZSAmJiBlLnBvcnQgPT0gci5wb3J0ID8gIiIgOiAiOiIgKyByLnBvcnQpLCByOwogICAgICAgIH12YXIgbyA9IHQoInBhcnNldXJpIiksCiAgICAgICAgICAgIGkgPSB0KCJkZWJ1ZyIpKCJzb2NrZXQuaW8tY2xpZW50OnVybCIpO2UuZXhwb3J0cyA9IHI7CiAgICAgIH0pLmNhbGwodGhpcywgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiB7fSk7CiAgICB9LCB7IGRlYnVnOiAxMCwgcGFyc2V1cmk6IDMyIH1dLCAzODogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGZ1bmN0aW9uIHIodCkgewogICAgICAgIHJldHVybiB0ID8gbyh0KSA6IHZvaWQgMDsKICAgICAgfWZ1bmN0aW9uIG8odCkgewogICAgICAgIGZvciAodmFyIGUgaW4gci5wcm90b3R5cGUpIHRbZV0gPSByLnByb3RvdHlwZVtlXTtyZXR1cm4gdDsKICAgICAgfWUuZXhwb3J0cyA9IHIsIHIucHJvdG90eXBlLm9uID0gci5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fSwgKHRoaXMuX2NhbGxiYWNrc1siJCIgKyB0XSA9IHRoaXMuX2NhbGxiYWNrc1siJCIgKyB0XSB8fCBbXSkucHVzaChlKSwgdGhpczsKICAgICAgfSwgci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgZnVuY3Rpb24gbigpIHsKICAgICAgICAgIHRoaXMub2ZmKHQsIG4pLCBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfXJldHVybiBuLmZuID0gZSwgdGhpcy5vbih0LCBuKSwgdGhpczsKICAgICAgfSwgci5wcm90b3R5cGUub2ZmID0gci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSByLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSByLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICBpZiAoKHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fSwgMCA9PSBhcmd1bWVudHMubGVuZ3RoKSkgcmV0dXJuIHRoaXMuX2NhbGxiYWNrcyA9IHt9LCB0aGlzO3ZhciBuID0gdGhpcy5fY2FsbGJhY2tzWyIkIiArIHRdO2lmICghbikgcmV0dXJuIHRoaXM7aWYgKDEgPT0gYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRlbGV0ZSB0aGlzLl9jYWxsYmFja3NbIiQiICsgdF0sIHRoaXM7Zm9yICh2YXIgciwgbyA9IDA7IG8gPCBuLmxlbmd0aDsgbysrKSBpZiAoKHIgPSBuW29dLCByID09PSBlIHx8IHIuZm4gPT09IGUpKSB7CiAgICAgICAgICBuLnNwbGljZShvLCAxKTticmVhazsKICAgICAgICB9cmV0dXJuIHRoaXM7CiAgICAgIH0sIHIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fTt2YXIgZSA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwKICAgICAgICAgICAgbiA9IHRoaXMuX2NhbGxiYWNrc1siJCIgKyB0XTtpZiAobikgewogICAgICAgICAgbiA9IG4uc2xpY2UoMCk7Zm9yICh2YXIgciA9IDAsIG8gPSBuLmxlbmd0aDsgbyA+IHI7ICsrcikgbltyXS5hcHBseSh0aGlzLCBlKTsKICAgICAgICB9cmV0dXJuIHRoaXM7CiAgICAgIH0sIHIucHJvdG90eXBlLmxpc3RlbmVycyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fSwgdGhpcy5fY2FsbGJhY2tzWyIkIiArIHRdIHx8IFtdOwogICAgICB9LCByLnByb3RvdHlwZS5oYXNMaXN0ZW5lcnMgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiAhIXRoaXMubGlzdGVuZXJzKHQpLmxlbmd0aDsKICAgICAgfTsKICAgIH0sIHt9XSwgMzk6IFtmdW5jdGlvbiAoZSwgbiwgcikgewogICAgICAoZnVuY3Rpb24gKGUpIHsKICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgZnVuY3Rpb24gbyh0LCBlKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIG4odCkgewogICAgICAgICAgICAgIGlmIChuW3RdICE9PSBnKSByZXR1cm4gblt0XTt2YXIgbztpZiAoImJ1Zy1zdHJpbmctY2hhci1pbmRleCIgPT0gdCkgbyA9ICJhIiAhPSAiYSJbMF07ZWxzZSBpZiAoImpzb24iID09IHQpIG8gPSBuKCJqc29uLXN0cmluZ2lmeSIpICYmIG4oImpzb24tcGFyc2UiKTtlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBzLAogICAgICAgICAgICAgICAgICAgIGEgPSAie1wiYVwiOlsxLHRydWUsZmFsc2UsbnVsbCxcIlxcdTAwMDBcXGJcXG5cXGZcXHJcXHRcIl19IjtpZiAoImpzb24tc3RyaW5naWZ5IiA9PSB0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBjID0gZS5zdHJpbmdpZnksCiAgICAgICAgICAgICAgICAgICAgICB1ID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgYyAmJiB2O2lmICh1KSB7CiAgICAgICAgICAgICAgICAgICAgKHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICB9KS50b0pTT04gPSBzO3RyeSB7CiAgICAgICAgICAgICAgICAgICAgICB1ID0gIjAiID09PSBjKDApICYmICIwIiA9PT0gYyhuZXcgcigpKSAmJiAnIiInID09IGMobmV3IGkoKSkgJiYgYyhiKSA9PT0gZyAmJiBjKGcpID09PSBnICYmIGMoKSA9PT0gZyAmJiAiMSIgPT09IGMocykgJiYgIlsxXSIgPT0gYyhbc10pICYmICJbbnVsbF0iID09IGMoW2ddKSAmJiAibnVsbCIgPT0gYyhudWxsKSAmJiAiW251bGwsbnVsbCxudWxsXSIgPT0gYyhbZywgYiwgbnVsbF0pICYmIGMoeyBhOiBbcywgITAsICExLCBudWxsLCAiXHgwMFxiXG5cZlxyCSJdIH0pID09IGEgJiYgIjEiID09PSBjKG51bGwsIHMpICYmICJbXG4gMSxcbiAyXG5dIiA9PSBjKFsxLCAyXSwgbnVsbCwgMSkgJiYgJyItMjcxODIxLTA0LTIwVDAwOjAwOjAwLjAwMFoiJyA9PSBjKG5ldyBwKC04NjRlMTMpKSAmJiAnIisyNzU3NjAtMDktMTNUMDA6MDA6MDAuMDAwWiInID09IGMobmV3IHAoODY0ZTEzKSkgJiYgJyItMDAwMDAxLTAxLTAxVDAwOjAwOjAwLjAwMFoiJyA9PSBjKG5ldyBwKC02MjE5ODc1NTJlNSkpICYmICciMTk2OS0xMi0zMVQyMzo1OTo1OS45OTlaIicgPT0gYyhuZXcgcCgtMSkpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGYpIHsKICAgICAgICAgICAgICAgICAgICAgIHUgPSAhMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH1vID0gdTsKICAgICAgICAgICAgICAgIH1pZiAoImpzb24tcGFyc2UiID09IHQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGggPSBlLnBhcnNlO2lmICgiZnVuY3Rpb24iID09IHR5cGVvZiBoKSB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmICgwID09PSBoKCIwIikgJiYgIWgoITEpKSB7CiAgICAgICAgICAgICAgICAgICAgICBzID0gaChhKTt2YXIgbCA9IDUgPT0gcy5hLmxlbmd0aCAmJiAxID09PSBzLmFbMF07aWYgKGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gIWgoJyIJIicpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7fWlmIChsKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAxICE9PSBoKCIwMSIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7fWlmIChsKSB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAxICE9PSBoKCIxLiIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChmKSB7fQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZikgewogICAgICAgICAgICAgICAgICAgIGwgPSAhMTsKICAgICAgICAgICAgICAgICAgfW8gPSBsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH1yZXR1cm4gblt0XSA9ICEhbzsKICAgICAgICAgICAgfXQgfHwgKHQgPSBjLk9iamVjdCgpKSwgZSB8fCAoZSA9IGMuT2JqZWN0KCkpO3ZhciByID0gdC5OdW1iZXIgfHwgYy5OdW1iZXIsCiAgICAgICAgICAgICAgICBpID0gdC5TdHJpbmcgfHwgYy5TdHJpbmcsCiAgICAgICAgICAgICAgICBhID0gdC5PYmplY3QgfHwgYy5PYmplY3QsCiAgICAgICAgICAgICAgICBwID0gdC5EYXRlIHx8IGMuRGF0ZSwKICAgICAgICAgICAgICAgIHUgPSB0LlN5bnRheEVycm9yIHx8IGMuU3ludGF4RXJyb3IsCiAgICAgICAgICAgICAgICBmID0gdC5UeXBlRXJyb3IgfHwgYy5UeXBlRXJyb3IsCiAgICAgICAgICAgICAgICBoID0gdC5NYXRoIHx8IGMuTWF0aCwKICAgICAgICAgICAgICAgIGwgPSB0LkpTT04gfHwgYy5KU09OOyJvYmplY3QiID09IHR5cGVvZiBsICYmIGwgJiYgKGUuc3RyaW5naWZ5ID0gbC5zdHJpbmdpZnksIGUucGFyc2UgPSBsLnBhcnNlKTt2YXIgZCwKICAgICAgICAgICAgICAgIHksCiAgICAgICAgICAgICAgICBnLAogICAgICAgICAgICAgICAgbSA9IGEucHJvdG90eXBlLAogICAgICAgICAgICAgICAgYiA9IG0udG9TdHJpbmcsCiAgICAgICAgICAgICAgICB2ID0gbmV3IHAoLTB4Yzc4MmI1YjgwMGNlYyk7dHJ5IHsKICAgICAgICAgICAgICB2ID0gLTEwOTI1MiA9PSB2LmdldFVUQ0Z1bGxZZWFyKCkgJiYgMCA9PT0gdi5nZXRVVENNb250aCgpICYmIDEgPT09IHYuZ2V0VVRDRGF0ZSgpICYmIDEwID09IHYuZ2V0VVRDSG91cnMoKSAmJiAzNyA9PSB2LmdldFVUQ01pbnV0ZXMoKSAmJiA2ID09IHYuZ2V0VVRDU2Vjb25kcygpICYmIDcwOCA9PSB2LmdldFVUQ01pbGxpc2Vjb25kcygpOwogICAgICAgICAgICB9IGNhdGNoICh3KSB7fWlmICghbigianNvbiIpKSB7CiAgICAgICAgICAgICAgdmFyIGsgPSAiW29iamVjdCBGdW5jdGlvbl0iLAogICAgICAgICAgICAgICAgICB4ID0gIltvYmplY3QgRGF0ZV0iLAogICAgICAgICAgICAgICAgICBBID0gIltvYmplY3QgTnVtYmVyXSIsCiAgICAgICAgICAgICAgICAgIF8gPSAiW29iamVjdCBTdHJpbmddIiwKICAgICAgICAgICAgICAgICAgQiA9ICJbb2JqZWN0IEFycmF5XSIsCiAgICAgICAgICAgICAgICAgIEMgPSAiW29iamVjdCBCb29sZWFuXSIsCiAgICAgICAgICAgICAgICAgIFMgPSBuKCJidWctc3RyaW5nLWNoYXItaW5kZXgiKTtpZiAoIXYpIHZhciBFID0gaC5mbG9vciwKICAgICAgICAgICAgICAgICAgTyA9IFswLCAzMSwgNTksIDkwLCAxMjAsIDE1MSwgMTgxLCAyMTIsIDI0MywgMjczLCAzMDQsIDMzNF0sCiAgICAgICAgICAgICAgICAgIFQgPSBmdW5jdGlvbiBUKHQsIGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBPW2VdICsgMzY1ICogKHQgLSAxOTcwKSArIEUoKHQgLSAxOTY5ICsgKGUgPSArKGUgPiAxKSkpIC8gNCkgLSBFKCh0IC0gMTkwMSArIGUpIC8gMTAwKSArIEUoKHQgLSAxNjAxICsgZSkgLyA0MDApOwogICAgICAgICAgICAgIH07aWYgKCgoZCA9IG0uaGFzT3duUHJvcGVydHkpIHx8IChkID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHZhciBlLAogICAgICAgICAgICAgICAgICAgIG4gPSB7fTtyZXR1cm4gKG4uX19wcm90b19fID0gbnVsbCwgbi5fX3Byb3RvX18gPSB7IHRvU3RyaW5nOiAxIH0sIG4pLnRvU3RyaW5nICE9IGIgPyBkID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl9fcHJvdG9fXywKICAgICAgICAgICAgICAgICAgICAgIG4gPSAodCBpbiAodGhpcy5fX3Byb3RvX18gPSBudWxsLCB0aGlzKSk7cmV0dXJuIHRoaXMuX19wcm90b19fID0gZSwgbjsKICAgICAgICAgICAgICAgIH0gOiAoZSA9IG4uY29uc3RydWN0b3IsIGQgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICB2YXIgbiA9ICh0aGlzLmNvbnN0cnVjdG9yIHx8IGUpLnByb3RvdHlwZTtyZXR1cm4gdCBpbiB0aGlzICYmICEodCBpbiBuICYmIHRoaXNbdF0gPT09IG5bdF0pOwogICAgICAgICAgICAgICAgfSksIG4gPSBudWxsLCBkLmNhbGwodGhpcywgdCk7CiAgICAgICAgICAgICAgfSksIHkgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICAgICAgICBvLAogICAgICAgICAgICAgICAgICAgIGkgPSAwOyhuID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlT2YgPSAwOwogICAgICAgICAgICAgICAgfSkucHJvdG90eXBlLnZhbHVlT2YgPSAwLCByID0gbmV3IG4oKTtmb3IgKG8gaW4gcikgZC5jYWxsKHIsIG8pICYmIGkrKztyZXR1cm4gbiA9IHIgPSBudWxsLCBpID8geSA9IDIgPT0gaSA/IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgICAgICAgciA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgbyA9IGIuY2FsbCh0KSA9PSBrO2ZvciAobiBpbiB0KSBvICYmICJwcm90b3R5cGUiID09IG4gfHwgZC5jYWxsKHIsIG4pIHx8ICEocltuXSA9IDEpIHx8ICFkLmNhbGwodCwgbikgfHwgZShuKTsKICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICAgICAgICBvID0gYi5jYWxsKHQpID09IGs7Zm9yIChuIGluIHQpIG8gJiYgInByb3RvdHlwZSIgPT0gbiB8fCAhZC5jYWxsKHQsIG4pIHx8IChyID0gImNvbnN0cnVjdG9yIiA9PT0gbikgfHwgZShuKTsociB8fCBkLmNhbGwodCwgbiA9ICJjb25zdHJ1Y3RvciIpKSAmJiBlKG4pOwogICAgICAgICAgICAgICAgfSA6IChyID0gWyJ2YWx1ZU9mIiwgInRvU3RyaW5nIiwgInRvTG9jYWxlU3RyaW5nIiwgInByb3BlcnR5SXNFbnVtZXJhYmxlIiwgImlzUHJvdG90eXBlT2YiLCAiaGFzT3duUHJvcGVydHkiLCAiY29uc3RydWN0b3IiXSwgeSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgICAgICAgbywKICAgICAgICAgICAgICAgICAgICAgIGkgPSBiLmNhbGwodCkgPT0gaywKICAgICAgICAgICAgICAgICAgICAgIGEgPSAhaSAmJiAiZnVuY3Rpb24iICE9IHR5cGVvZiB0LmNvbnN0cnVjdG9yICYmIHNbdHlwZW9mIHQuaGFzT3duUHJvcGVydHldICYmIHQuaGFzT3duUHJvcGVydHkgfHwgZDtmb3IgKG4gaW4gdCkgaSAmJiAicHJvdG90eXBlIiA9PSBuIHx8ICFhLmNhbGwodCwgbikgfHwgZShuKTtmb3IgKG8gPSByLmxlbmd0aDsgbiA9IHJbLS1vXTsgYS5jYWxsKHQsIG4pICYmIGUobikpOwogICAgICAgICAgICAgICAgfSksIHkodCwgZSk7CiAgICAgICAgICAgICAgfSwgIW4oImpzb24tc3RyaW5naWZ5IikpKSB7CiAgICAgICAgICAgICAgICB2YXIgaiA9IHsgOTI6ICJcXFxcIiwgMzQ6ICdcXCInLCA4OiAiXFxiIiwgMTI6ICJcXGYiLCAxMDogIlxcbiIsIDEzOiAiXFxyIiwgOTogIlxcdCIgfSwKICAgICAgICAgICAgICAgICAgICBQID0gIjAwMDAwMCIsCiAgICAgICAgICAgICAgICAgICAgTiA9IGZ1bmN0aW9uIE4odCwgZSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gKFAgKyAoZSB8fCAwKSkuc2xpY2UoLXQpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBSID0gIlxcdTAwIiwKICAgICAgICAgICAgICAgICAgICBEID0gZnVuY3Rpb24gRCh0KSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSAnIicsIG4gPSAwLCByID0gdC5sZW5ndGgsIG8gPSAhUyB8fCByID4gMTAsIGkgPSBvICYmIChTID8gdC5zcGxpdCgiIikgOiB0KTsgciA+IG47IG4rKykgewogICAgICAgICAgICAgICAgICAgIHZhciBzID0gdC5jaGFyQ29kZUF0KG4pO3N3aXRjaCAocykge2Nhc2UgODpjYXNlIDk6Y2FzZSAxMDpjYXNlIDEyOmNhc2UgMTM6Y2FzZSAzNDpjYXNlIDkyOgogICAgICAgICAgICAgICAgICAgICAgICBlICs9IGpbc107YnJlYWs7ZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDMyID4gcykgewogICAgICAgICAgICAgICAgICAgICAgICAgIGUgKz0gUiArIE4oMiwgcy50b1N0cmluZygxNikpO2JyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9ZSArPSBvID8gaVtuXSA6IHQuY2hhckF0KG4pO30KICAgICAgICAgICAgICAgICAgfXJldHVybiBlICsgJyInOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBVID0gZnVuY3Rpb24gVSh0LCBlLCBuLCByLCBvLCBpLCBzKSB7CiAgICAgICAgICAgICAgICAgIHZhciBhLCBjLCBwLCB1LCBoLCBsLCBtLCB2LCB3LCBrLCBTLCBPLCBqLCBQLCBSLCBxO3RyeSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IGVbdF07CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEwpIHt9aWYgKCJvYmplY3QiID09IHR5cGVvZiBhICYmIGEpIGlmICgoYyA9IGIuY2FsbChhKSwgYyAhPSB4IHx8IGQuY2FsbChhLCAidG9KU09OIikpKSAiZnVuY3Rpb24iID09IHR5cGVvZiBhLnRvSlNPTiAmJiAoYyAhPSBBICYmIGMgIT0gXyAmJiBjICE9IEIgfHwgZC5jYWxsKGEsICJ0b0pTT04iKSkgJiYgKGEgPSBhLnRvSlNPTih0KSk7ZWxzZSBpZiAoYSA+IC0xIC8gMCAmJiAxIC8gMCA+IGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoVCkgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChoID0gRShhIC8gODY0ZTUpLCBwID0gRShoIC8gMzY1LjI0MjUpICsgMTk3MCAtIDE7IFQocCArIDEsIDApIDw9IGg7IHArKyk7Zm9yICh1ID0gRSgoaCAtIFQocCwgMCkpIC8gMzAuNDIpOyBUKHAsIHUgKyAxKSA8PSBoOyB1KyspO2ggPSAxICsgaCAtIFQocCwgdSksIGwgPSAoYSAlIDg2NGU1ICsgODY0ZTUpICUgODY0ZTUsIG0gPSBFKGwgLyAzNmU1KSAlIDI0LCB2ID0gRShsIC8gNmU0KSAlIDYwLCB3ID0gRShsIC8gMWUzKSAlIDYwLCBrID0gbCAlIDFlMzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgcCA9IGEuZ2V0VVRDRnVsbFllYXIoKSwgdSA9IGEuZ2V0VVRDTW9udGgoKSwgaCA9IGEuZ2V0VVRDRGF0ZSgpLCBtID0gYS5nZXRVVENIb3VycygpLCB2ID0gYS5nZXRVVENNaW51dGVzKCksIHcgPSBhLmdldFVUQ1NlY29uZHMoKSwgayA9IGEuZ2V0VVRDTWlsbGlzZWNvbmRzKCk7YSA9ICgwID49IHAgfHwgcCA+PSAxZTQgPyAoMCA+IHAgPyAiLSIgOiAiKyIpICsgTig2LCAwID4gcCA/IC1wIDogcCkgOiBOKDQsIHApKSArICItIiArIE4oMiwgdSArIDEpICsgIi0iICsgTigyLCBoKSArICJUIiArIE4oMiwgbSkgKyAiOiIgKyBOKDIsIHYpICsgIjoiICsgTigyLCB3KSArICIuIiArIE4oMywgaykgKyAiWiI7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBhID0gbnVsbDtpZiAoKG4gJiYgKGEgPSBuLmNhbGwoZSwgdCwgYSkpLCBudWxsID09PSBhKSkgcmV0dXJuICJudWxsIjtpZiAoKGMgPSBiLmNhbGwoYSksIGMgPT0gQykpIHJldHVybiAiIiArIGE7aWYgKGMgPT0gQSkgcmV0dXJuIGEgPiAtMSAvIDAgJiYgMSAvIDAgPiBhID8gIiIgKyBhIDogIm51bGwiO2lmIChjID09IF8pIHJldHVybiBEKCIiICsgYSk7aWYgKCJvYmplY3QiID09IHR5cGVvZiBhKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChQID0gcy5sZW5ndGg7IFAtLTspIGlmIChzW1BdID09PSBhKSB0aHJvdyBmKCk7aWYgKChzLnB1c2goYSksIFMgPSBbXSwgUiA9IGksIGkgKz0gbywgYyA9PSBCKSkgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMCwgUCA9IGEubGVuZ3RoOyBQID4gajsgaisrKSBPID0gVShqLCBhLCBuLCByLCBvLCBpLCBzKSwgUy5wdXNoKE8gPT09IGcgPyAibnVsbCIgOiBPKTtxID0gUy5sZW5ndGggPyBvID8gIltcbiIgKyBpICsgUy5qb2luKCIsXG4iICsgaSkgKyAiXG4iICsgUiArICJdIiA6ICJbIiArIFMuam9pbigiLCIpICsgIl0iIDogIltdIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeShyIHx8IGEsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IFUodCwgYSwgbiwgciwgbywgaSwgcyk7ZSAhPT0gZyAmJiBTLnB1c2goRCh0KSArICI6IiArIChvID8gIiAiIDogIiIpICsgZSk7CiAgICAgICAgICAgICAgICAgICAgfSksIHEgPSBTLmxlbmd0aCA/IG8gPyAie1xuIiArIGkgKyBTLmpvaW4oIixcbiIgKyBpKSArICJcbiIgKyBSICsgIn0iIDogInsiICsgUy5qb2luKCIsIikgKyAifSIgOiAie30iO3JldHVybiBzLnBvcCgpLCBxOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9O2Uuc3RyaW5naWZ5ID0gZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgICAgICAgICAgICAgdmFyIHIsIG8sIGksIGE7aWYgKHNbdHlwZW9mIGVdICYmIGUpIGlmICgoYSA9IGIuY2FsbChlKSkgPT0gaykgbyA9IGU7ZWxzZSBpZiAoYSA9PSBCKSB7CiAgICAgICAgICAgICAgICAgICAgaSA9IHt9O2ZvciAodmFyIGMsIHAgPSAwLCB1ID0gZS5sZW5ndGg7IHUgPiBwOyBjID0gZVtwKytdLCBhID0gYi5jYWxsKGMpLCAoYSA9PSBfIHx8IGEgPT0gQSkgJiYgKGlbY10gPSAxKSk7CiAgICAgICAgICAgICAgICAgIH1pZiAobikgaWYgKChhID0gYi5jYWxsKG4pKSA9PSBBKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKChuIC09IG4gJSAxKSA+IDApIGZvciAociA9ICIiLCBuID4gMTAgJiYgKG4gPSAxMCk7IHIubGVuZ3RoIDwgbjsgciArPSAiICIpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgYSA9PSBfICYmIChyID0gbi5sZW5ndGggPD0gMTAgPyBuIDogbi5zbGljZSgwLCAxMCkpO3JldHVybiBVKCIiLCAoYyA9IHt9LCBjWyIiXSA9IHQsIGMpLCBvLCBpLCByLCAiIiwgW10pOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9aWYgKCFuKCJqc29uLXBhcnNlIikpIHsKICAgICAgICAgICAgICAgIHZhciBxLAogICAgICAgICAgICAgICAgICAgIEwsCiAgICAgICAgICAgICAgICAgICAgTSA9IGkuZnJvbUNoYXJDb2RlLAogICAgICAgICAgICAgICAgICAgIEkgPSB7IDkyOiAiXFwiLCAzNDogJyInLCA0NzogIi8iLCA5ODogIlxiIiwgMTE2OiAiCSIsIDExMDogIlxuIiwgMTAyOiAiXGYiLCAxMTQ6ICJcciIgfSwKICAgICAgICAgICAgICAgICAgICBIID0gZnVuY3Rpb24gSCgpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgKHEgPSBMID0gbnVsbCwgdSgpKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgSiA9IGZ1bmN0aW9uIEooKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIHQsIGUsIG4sIHIsIG8sIGkgPSBMLCBzID0gaS5sZW5ndGg7IHMgPiBxOykgc3dpdGNoIChvID0gaS5jaGFyQ29kZUF0KHEpKSB7Y2FzZSA5OmNhc2UgMTA6Y2FzZSAxMzpjYXNlIDMyOgogICAgICAgICAgICAgICAgICAgICAgcSsrO2JyZWFrO2Nhc2UgMTIzOmNhc2UgMTI1OmNhc2UgOTE6Y2FzZSA5MzpjYXNlIDU4OmNhc2UgNDQ6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCA9IFMgPyBpLmNoYXJBdChxKSA6IGlbcV0sIHErKywgdDtjYXNlIDM0OgogICAgICAgICAgICAgICAgICAgICAgZm9yICh0ID0gIkAiLCBxKys7IHMgPiBxOykgaWYgKChvID0gaS5jaGFyQ29kZUF0KHEpLCAzMiA+IG8pKSBIKCk7ZWxzZSBpZiAoOTIgPT0gbykgc3dpdGNoIChvID0gaS5jaGFyQ29kZUF0KCsrcSkpIHtjYXNlIDkyOmNhc2UgMzQ6Y2FzZSA0NzpjYXNlIDk4OmNhc2UgMTE2OmNhc2UgMTEwOmNhc2UgMTAyOmNhc2UgMTE0OgogICAgICAgICAgICAgICAgICAgICAgICAgIHQgKz0gSVtvXSwgcSsrO2JyZWFrO2Nhc2UgMTE3OgogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9ICsrcSwgbiA9IHEgKyA0OyBuID4gcTsgcSsrKSBvID0gaS5jaGFyQ29kZUF0KHEpLCBvID49IDQ4ICYmIDU3ID49IG8gfHwgbyA+PSA5NyAmJiAxMDIgPj0gbyB8fCBvID49IDY1ICYmIDcwID49IG8gfHwgSCgpO3QgKz0gTSgiMHgiICsgaS5zbGljZShlLCBxKSk7YnJlYWs7ZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICBIKCk7fSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDM0ID09IG8pIGJyZWFrO2ZvciAobyA9IGkuY2hhckNvZGVBdChxKSwgZSA9IHE7IG8gPj0gMzIgJiYgOTIgIT0gbyAmJiAzNCAhPSBvOykgbyA9IGkuY2hhckNvZGVBdCgrK3EpO3QgKz0gaS5zbGljZShlLCBxKTsKICAgICAgICAgICAgICAgICAgICAgIH1pZiAoMzQgPT0gaS5jaGFyQ29kZUF0KHEpKSByZXR1cm4gcSsrLCB0O0goKTtkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgaWYgKChlID0gcSwgNDUgPT0gbyAmJiAociA9ICEwLCBvID0gaS5jaGFyQ29kZUF0KCsrcSkpLCBvID49IDQ4ICYmIDU3ID49IG8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoNDggPT0gbyAmJiAobyA9IGkuY2hhckNvZGVBdChxICsgMSksIG8gPj0gNDggJiYgNTcgPj0gbykgJiYgSCgpLCByID0gITE7IHMgPiBxICYmIChvID0gaS5jaGFyQ29kZUF0KHEpLCBvID49IDQ4ICYmIDU3ID49IG8pOyBxKyspO2lmICg0NiA9PSBpLmNoYXJDb2RlQXQocSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKG4gPSArK3E7IHMgPiBuICYmIChvID0gaS5jaGFyQ29kZUF0KG4pLCBvID49IDQ4ICYmIDU3ID49IG8pOyBuKyspO24gPT0gcSAmJiBIKCksIHEgPSBuOwogICAgICAgICAgICAgICAgICAgICAgICB9aWYgKChvID0gaS5jaGFyQ29kZUF0KHEpLCAxMDEgPT0gbyB8fCA2OSA9PSBvKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobyA9IGkuY2hhckNvZGVBdCgrK3EpLCAoNDMgPT0gbyB8fCA0NSA9PSBvKSAmJiBxKyssIG4gPSBxOyBzID4gbiAmJiAobyA9IGkuY2hhckNvZGVBdChuKSwgbyA+PSA0OCAmJiA1NyA+PSBvKTsgbisrKTtuID09IHEgJiYgSCgpLCBxID0gbjsKICAgICAgICAgICAgICAgICAgICAgICAgfXJldHVybiAraS5zbGljZShlLCBxKTsKICAgICAgICAgICAgICAgICAgICAgIH1pZiAoKHIgJiYgSCgpLCAidHJ1ZSIgPT0gaS5zbGljZShxLCBxICsgNCkpKSByZXR1cm4gcSArPSA0LCAhMDtpZiAoImZhbHNlIiA9PSBpLnNsaWNlKHEsIHEgKyA1KSkgcmV0dXJuIHEgKz0gNSwgITE7aWYgKCJudWxsIiA9PSBpLnNsaWNlKHEsIHEgKyA0KSkgcmV0dXJuIHEgKz0gNCwgbnVsbDtIKCk7fXJldHVybiAiJCI7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHogPSBmdW5jdGlvbiB6KHQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGUsIG47aWYgKCgiJCIgPT0gdCAmJiBIKCksICJzdHJpbmciID09IHR5cGVvZiB0KSkgewogICAgICAgICAgICAgICAgICAgIGlmICgiQCIgPT0gKFMgPyB0LmNoYXJBdCgwKSA6IHRbMF0pKSByZXR1cm4gdC5zbGljZSgxKTtpZiAoIlsiID09IHQpIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9IFtdOyB0ID0gSigpLCAiXSIgIT0gdDsgbiB8fCAobiA9ICEwKSkgbiAmJiAoIiwiID09IHQgPyAodCA9IEooKSwgIl0iID09IHQgJiYgSCgpKSA6IEgoKSksICIsIiA9PSB0ICYmIEgoKSwgZS5wdXNoKHoodCkpO3JldHVybiBlOwogICAgICAgICAgICAgICAgICAgIH1pZiAoInsiID09IHQpIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9IHt9OyB0ID0gSigpLCAifSIgIT0gdDsgbiB8fCAobiA9ICEwKSkgbiAmJiAoIiwiID09IHQgPyAodCA9IEooKSwgIn0iID09IHQgJiYgSCgpKSA6IEgoKSksICgiLCIgPT0gdCB8fCAic3RyaW5nIiAhPSB0eXBlb2YgdCB8fCAiQCIgIT0gKFMgPyB0LmNoYXJBdCgwKSA6IHRbMF0pIHx8ICI6IiAhPSBKKCkpICYmIEgoKSwgZVt0LnNsaWNlKDEpXSA9IHooSigpKTtyZXR1cm4gZTsKICAgICAgICAgICAgICAgICAgICB9SCgpOwogICAgICAgICAgICAgICAgICB9cmV0dXJuIHQ7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIFggPSBmdW5jdGlvbiBYKHQsIGUsIG4pIHsKICAgICAgICAgICAgICAgICAgdmFyIHIgPSBGKHQsIGUsIG4pO3IgPT09IGcgPyBkZWxldGUgdFtlXSA6IHRbZV0gPSByOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBGID0gZnVuY3Rpb24gRih0LCBlLCBuKSB7CiAgICAgICAgICAgICAgICAgIHZhciByLAogICAgICAgICAgICAgICAgICAgICAgbyA9IHRbZV07aWYgKCJvYmplY3QiID09IHR5cGVvZiBvICYmIG8pIGlmIChiLmNhbGwobykgPT0gQikgZm9yIChyID0gby5sZW5ndGg7IHItLTspIFgobywgciwgbik7ZWxzZSB5KG8sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgICAgWChvLCB0LCBuKTsKICAgICAgICAgICAgICAgICAgfSk7cmV0dXJuIG4uY2FsbCh0LCBlLCBvKTsKICAgICAgICAgICAgICAgIH07ZS5wYXJzZSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBuLCByO3JldHVybiBxID0gMCwgTCA9ICIiICsgdCwgbiA9IHooSigpKSwgIiQiICE9IEooKSAmJiBIKCksIHEgPSBMID0gbnVsbCwgZSAmJiBiLmNhbGwoZSkgPT0gayA/IEYoKHIgPSB7fSwgclsiIl0gPSBuLCByKSwgIiIsIGUpIDogbjsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9cmV0dXJuIGUucnVuSW5Db250ZXh0ID0gbywgZTsKICAgICAgICAgIH12YXIgaSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgdC5hbWQsCiAgICAgICAgICAgICAgcyA9IHsgImZ1bmN0aW9uIjogITAsIG9iamVjdDogITAgfSwKICAgICAgICAgICAgICBhID0gc1t0eXBlb2Ygcl0gJiYgciAmJiAhci5ub2RlVHlwZSAmJiByLAogICAgICAgICAgICAgIGMgPSBzW3R5cGVvZiB3aW5kb3ddICYmIHdpbmRvdyB8fCB0aGlzLAogICAgICAgICAgICAgIHAgPSBhICYmIHNbdHlwZW9mIG5dICYmIG4gJiYgIW4ubm9kZVR5cGUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZTtpZiAoKCFwIHx8IHAuZ2xvYmFsICE9PSBwICYmIHAud2luZG93ICE9PSBwICYmIHAuc2VsZiAhPT0gcCB8fCAoYyA9IHApLCBhICYmICFpKSkgbyhjLCBhKTtlbHNlIHsKICAgICAgICAgICAgdmFyIHUgPSBjLkpTT04sCiAgICAgICAgICAgICAgICBmID0gYy5KU09OMywKICAgICAgICAgICAgICAgIGggPSAhMSwKICAgICAgICAgICAgICAgIGwgPSBvKGMsIGMuSlNPTjMgPSB7IG5vQ29uZmxpY3Q6IGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaCB8fCAoaCA9ICEwLCBjLkpTT04gPSB1LCBjLkpTT04zID0gZiwgdSA9IGYgPSBudWxsKSwgbDsKICAgICAgICAgICAgICB9IH0pO2MuSlNPTiA9IHsgcGFyc2U6IGwucGFyc2UsIHN0cmluZ2lmeTogbC5zdHJpbmdpZnkgfTsKICAgICAgICAgIH1pICYmIHQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbDsKICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhbGwodGhpcyk7CiAgICAgIH0pLmNhbGwodGhpcywgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiB7fSk7CiAgICB9LCB7fV0sIDQwOiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHIgPSB0KCJpc2FycmF5IiksCiAgICAgICAgICAgIG8gPSB0KCIuL2lzLWJ1ZmZlciIpO24uZGVjb25zdHJ1Y3RQYWNrZXQgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgZnVuY3Rpb24gZSh0KSB7CiAgICAgICAgICAgIGlmICghdCkgcmV0dXJuIHQ7aWYgKG8odCkpIHsKICAgICAgICAgICAgICB2YXIgaSA9IHsgX3BsYWNlaG9sZGVyOiAhMCwgbnVtOiBuLmxlbmd0aCB9O3JldHVybiBuLnB1c2godCksIGk7CiAgICAgICAgICAgIH1pZiAocih0KSkgewogICAgICAgICAgICAgIGZvciAodmFyIHMgPSBuZXcgQXJyYXkodC5sZW5ndGgpLCBhID0gMDsgYSA8IHQubGVuZ3RoOyBhKyspIHNbYV0gPSBlKHRbYV0pO3JldHVybiBzOwogICAgICAgICAgICB9aWYgKCJvYmplY3QiID09IHR5cGVvZiB0ICYmICEodCBpbnN0YW5jZW9mIERhdGUpKSB7CiAgICAgICAgICAgICAgdmFyIHMgPSB7fTtmb3IgKHZhciBjIGluIHQpIHNbY10gPSBlKHRbY10pO3JldHVybiBzOwogICAgICAgICAgICB9cmV0dXJuIHQ7CiAgICAgICAgICB9dmFyIG4gPSBbXSwKICAgICAgICAgICAgICBpID0gdC5kYXRhLAogICAgICAgICAgICAgIHMgPSB0O3JldHVybiBzLmRhdGEgPSBlKGkpLCBzLmF0dGFjaG1lbnRzID0gbi5sZW5ndGgsIHsgcGFja2V0OiBzLCBidWZmZXJzOiBuIH07CiAgICAgICAgfSwgbi5yZWNvbnN0cnVjdFBhY2tldCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgICAgICAgaWYgKHQgJiYgdC5fcGxhY2Vob2xkZXIpIHsKICAgICAgICAgICAgICB2YXIgbyA9IGVbdC5udW1dO3JldHVybiBvOwogICAgICAgICAgICB9aWYgKHIodCkpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHQubGVuZ3RoOyBpKyspIHRbaV0gPSBuKHRbaV0pO3JldHVybiB0OwogICAgICAgICAgICB9aWYgKHQgJiYgIm9iamVjdCIgPT0gdHlwZW9mIHQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBzIGluIHQpIHRbc10gPSBuKHRbc10pO3JldHVybiB0OwogICAgICAgICAgICB9cmV0dXJuIHQ7CiAgICAgICAgICB9cmV0dXJuIHQuZGF0YSA9IG4odC5kYXRhKSwgdC5hdHRhY2htZW50cyA9IHZvaWQgMCwgdDsKICAgICAgICB9LCBuLnJlbW92ZUJsb2JzID0gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIGZ1bmN0aW9uIGkodCwgYywgcCkgewogICAgICAgICAgICBpZiAoIXQpIHJldHVybiB0O2lmIChlLkJsb2IgJiYgdCBpbnN0YW5jZW9mIEJsb2IgfHwgZS5GaWxlICYmIHQgaW5zdGFuY2VvZiBGaWxlKSB7CiAgICAgICAgICAgICAgcysrO3ZhciB1ID0gbmV3IEZpbGVSZWFkZXIoKTt1Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHAgPyBwW2NdID0gdGhpcy5yZXN1bHQgOiBhID0gdGhpcy5yZXN1bHQsIC0tcyB8fCBuKGEpOwogICAgICAgICAgICAgIH0sIHUucmVhZEFzQXJyYXlCdWZmZXIodCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocih0KSkgZm9yICh2YXIgZiA9IDA7IGYgPCB0Lmxlbmd0aDsgZisrKSBpKHRbZl0sIGYsIHQpO2Vsc2UgaWYgKHQgJiYgIm9iamVjdCIgPT0gdHlwZW9mIHQgJiYgIW8odCkpIGZvciAodmFyIGggaW4gdCkgaSh0W2hdLCBoLCB0KTsKICAgICAgICAgIH12YXIgcyA9IDAsCiAgICAgICAgICAgICAgYSA9IHQ7aShhKSwgcyB8fCBuKGEpOwogICAgICAgIH07CiAgICAgIH0pLmNhbGwodGhpcywgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiB7fSk7CiAgICB9LCB7ICIuL2lzLWJ1ZmZlciI6IDQyLCBpc2FycmF5OiAyOCB9XSwgNDE6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICBmdW5jdGlvbiByKCkge31mdW5jdGlvbiBvKHQpIHsKICAgICAgICB2YXIgZSA9ICIiLAogICAgICAgICAgICByID0gITE7cmV0dXJuIGUgKz0gdC50eXBlLCAobi5CSU5BUllfRVZFTlQgPT0gdC50eXBlIHx8IG4uQklOQVJZX0FDSyA9PSB0LnR5cGUpICYmIChlICs9IHQuYXR0YWNobWVudHMsIGUgKz0gIi0iKSwgdC5uc3AgJiYgIi8iICE9IHQubnNwICYmIChyID0gITAsIGUgKz0gdC5uc3ApLCBudWxsICE9IHQuaWQgJiYgKHIgJiYgKGUgKz0gIiwiLCByID0gITEpLCBlICs9IHQuaWQpLCBudWxsICE9IHQuZGF0YSAmJiAociAmJiAoZSArPSAiLCIpLCBlICs9IGYuc3RyaW5naWZ5KHQuZGF0YSkpLCB1KCJlbmNvZGVkICVqIGFzICVzIiwgdCwgZSksIGU7CiAgICAgIH1mdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgICAgIHZhciBuID0gbC5kZWNvbnN0cnVjdFBhY2tldCh0KSwKICAgICAgICAgICAgICByID0gbyhuLnBhY2tldCksCiAgICAgICAgICAgICAgaSA9IG4uYnVmZmVycztpLnVuc2hpZnQociksIGUoaSk7CiAgICAgICAgfWwucmVtb3ZlQmxvYnModCwgbik7CiAgICAgIH1mdW5jdGlvbiBzKCkgewogICAgICAgIHRoaXMucmVjb25zdHJ1Y3RvciA9IG51bGw7CiAgICAgIH1mdW5jdGlvbiBhKHQpIHsKICAgICAgICB2YXIgZSA9IHt9LAogICAgICAgICAgICByID0gMDtpZiAoKGUudHlwZSA9IE51bWJlcih0LmNoYXJBdCgwKSksIG51bGwgPT0gbi50eXBlc1tlLnR5cGVdKSkgcmV0dXJuIHAoKTtpZiAobi5CSU5BUllfRVZFTlQgPT0gZS50eXBlIHx8IG4uQklOQVJZX0FDSyA9PSBlLnR5cGUpIHsKICAgICAgICAgIGZvciAodmFyIG8gPSAiIjsgIi0iICE9IHQuY2hhckF0KCsrcikgJiYgKG8gKz0gdC5jaGFyQXQociksIHIgIT0gdC5sZW5ndGgpOyk7aWYgKG8gIT0gTnVtYmVyKG8pIHx8ICItIiAhPSB0LmNoYXJBdChyKSkgdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIGF0dGFjaG1lbnRzIik7ZS5hdHRhY2htZW50cyA9IE51bWJlcihvKTsKICAgICAgICB9aWYgKCIvIiA9PSB0LmNoYXJBdChyICsgMSkpIGZvciAoZS5uc3AgPSAiIjsgKytyOykgewogICAgICAgICAgdmFyIGkgPSB0LmNoYXJBdChyKTtpZiAoIiwiID09IGkpIGJyZWFrO2lmICgoZS5uc3AgKz0gaSwgciA9PSB0Lmxlbmd0aCkpIGJyZWFrOwogICAgICAgIH0gZWxzZSBlLm5zcCA9ICIvIjt2YXIgcyA9IHQuY2hhckF0KHIgKyAxKTtpZiAoIiIgIT09IHMgJiYgTnVtYmVyKHMpID09IHMpIHsKICAgICAgICAgIGZvciAoZS5pZCA9ICIiOyArK3I7KSB7CiAgICAgICAgICAgIHZhciBpID0gdC5jaGFyQXQocik7aWYgKG51bGwgPT0gaSB8fCBOdW1iZXIoaSkgIT0gaSkgewogICAgICAgICAgICAgIC0tcjticmVhazsKICAgICAgICAgICAgfWlmICgoZS5pZCArPSB0LmNoYXJBdChyKSwgciA9PSB0Lmxlbmd0aCkpIGJyZWFrOwogICAgICAgICAgfWUuaWQgPSBOdW1iZXIoZS5pZCk7CiAgICAgICAgfWlmICh0LmNoYXJBdCgrK3IpKSB0cnkgewogICAgICAgICAgZS5kYXRhID0gZi5wYXJzZSh0LnN1YnN0cihyKSk7CiAgICAgICAgfSBjYXRjaCAoYSkgewogICAgICAgICAgcmV0dXJuIHAoKTsKICAgICAgICB9cmV0dXJuIHUoImRlY29kZWQgJXMgYXMgJWoiLCB0LCBlKSwgZTsKICAgICAgfWZ1bmN0aW9uIGModCkgewogICAgICAgIHRoaXMucmVjb25QYWNrID0gdCwgdGhpcy5idWZmZXJzID0gW107CiAgICAgIH1mdW5jdGlvbiBwKHQpIHsKICAgICAgICByZXR1cm4geyB0eXBlOiBuLkVSUk9SLCBkYXRhOiAicGFyc2VyIGVycm9yIiB9OwogICAgICB9dmFyIHUgPSB0KCJkZWJ1ZyIpKCJzb2NrZXQuaW8tcGFyc2VyIiksCiAgICAgICAgICBmID0gdCgianNvbjMiKSwKICAgICAgICAgIGggPSAodCgiaXNhcnJheSIpLCB0KCJjb21wb25lbnQtZW1pdHRlciIpKSwKICAgICAgICAgIGwgPSB0KCIuL2JpbmFyeSIpLAogICAgICAgICAgZCA9IHQoIi4vaXMtYnVmZmVyIik7bi5wcm90b2NvbCA9IDQsIG4udHlwZXMgPSBbIkNPTk5FQ1QiLCAiRElTQ09OTkVDVCIsICJFVkVOVCIsICJCSU5BUllfRVZFTlQiLCAiQUNLIiwgIkJJTkFSWV9BQ0siLCAiRVJST1IiXSwgbi5DT05ORUNUID0gMCwgbi5ESVNDT05ORUNUID0gMSwgbi5FVkVOVCA9IDIsIG4uQUNLID0gMywgbi5FUlJPUiA9IDQsIG4uQklOQVJZX0VWRU5UID0gNSwgbi5CSU5BUllfQUNLID0gNiwgbi5FbmNvZGVyID0gciwgbi5EZWNvZGVyID0gcywgci5wcm90b3R5cGUuZW5jb2RlID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICBpZiAoKHUoImVuY29kaW5nIHBhY2tldCAlaiIsIHQpLCBuLkJJTkFSWV9FVkVOVCA9PSB0LnR5cGUgfHwgbi5CSU5BUllfQUNLID09IHQudHlwZSkpIGkodCwgZSk7ZWxzZSB7CiAgICAgICAgICB2YXIgciA9IG8odCk7ZShbcl0pOwogICAgICAgIH0KICAgICAgfSwgaChzLnByb3RvdHlwZSksIHMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGU7aWYgKCJzdHJpbmciID09IHR5cGVvZiB0KSBlID0gYSh0KSwgbi5CSU5BUllfRVZFTlQgPT0gZS50eXBlIHx8IG4uQklOQVJZX0FDSyA9PSBlLnR5cGUgPyAodGhpcy5yZWNvbnN0cnVjdG9yID0gbmV3IGMoZSksIDAgPT09IHRoaXMucmVjb25zdHJ1Y3Rvci5yZWNvblBhY2suYXR0YWNobWVudHMgJiYgdGhpcy5lbWl0KCJkZWNvZGVkIiwgZSkpIDogdGhpcy5lbWl0KCJkZWNvZGVkIiwgZSk7ZWxzZSB7CiAgICAgICAgICBpZiAoIWQodCkgJiYgIXQuYmFzZTY0KSB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gdHlwZTogIiArIHQpO2lmICghdGhpcy5yZWNvbnN0cnVjdG9yKSB0aHJvdyBuZXcgRXJyb3IoImdvdCBiaW5hcnkgZGF0YSB3aGVuIG5vdCByZWNvbnN0cnVjdGluZyBhIHBhY2tldCIpO2UgPSB0aGlzLnJlY29uc3RydWN0b3IudGFrZUJpbmFyeURhdGEodCksIGUgJiYgKHRoaXMucmVjb25zdHJ1Y3RvciA9IG51bGwsIHRoaXMuZW1pdCgiZGVjb2RlZCIsIGUpKTsKICAgICAgICB9CiAgICAgIH0sIHMucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5yZWNvbnN0cnVjdG9yICYmIHRoaXMucmVjb25zdHJ1Y3Rvci5maW5pc2hlZFJlY29uc3RydWN0aW9uKCk7CiAgICAgIH0sIGMucHJvdG90eXBlLnRha2VCaW5hcnlEYXRhID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICBpZiAoKHRoaXMuYnVmZmVycy5wdXNoKHQpLCB0aGlzLmJ1ZmZlcnMubGVuZ3RoID09IHRoaXMucmVjb25QYWNrLmF0dGFjaG1lbnRzKSkgewogICAgICAgICAgdmFyIGUgPSBsLnJlY29uc3RydWN0UGFja2V0KHRoaXMucmVjb25QYWNrLCB0aGlzLmJ1ZmZlcnMpO3JldHVybiB0aGlzLmZpbmlzaGVkUmVjb25zdHJ1Y3Rpb24oKSwgZTsKICAgICAgICB9cmV0dXJuIG51bGw7CiAgICAgIH0sIGMucHJvdG90eXBlLmZpbmlzaGVkUmVjb25zdHJ1Y3Rpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5yZWNvblBhY2sgPSBudWxsLCB0aGlzLmJ1ZmZlcnMgPSBbXTsKICAgICAgfTsKICAgIH0sIHsgIi4vYmluYXJ5IjogNDAsICIuL2lzLWJ1ZmZlciI6IDQyLCAiY29tcG9uZW50LWVtaXR0ZXIiOiA0MywgZGVidWc6IDEwLCBpc2FycmF5OiAyOCwganNvbjM6IDM5IH1dLCA0MjogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIChmdW5jdGlvbiAodCkgewogICAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgICAgcmV0dXJuIHQuQnVmZmVyICYmIHQuQnVmZmVyLmlzQnVmZmVyKGUpIHx8IHQuQXJyYXlCdWZmZXIgJiYgZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyOwogICAgICAgIH1lLmV4cG9ydHMgPSBuOwogICAgICB9KS5jYWxsKHRoaXMsICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWwgPyBnbG9iYWwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygc2VsZiA/IHNlbGYgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDoge30pOwogICAgfSwge31dLCA0MzogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgIGFyZ3VtZW50c1s0XVs4XVswXS5hcHBseShuLCBhcmd1bWVudHMpOwogICAgfSwgeyBkdXA6IDggfV0sIDQ0OiBbZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgZnVuY3Rpb24gcih0LCBlKSB7CiAgICAgICAgdmFyIG4gPSBbXTtlID0gZSB8fCAwO2ZvciAodmFyIHIgPSBlIHx8IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSBuW3IgLSBlXSA9IHRbcl07cmV0dXJuIG47CiAgICAgIH1lLmV4cG9ydHMgPSByOwogICAgfSwge31dLCA0NTogW2Z1bmN0aW9uIChlLCBuLCByKSB7CiAgICAgIChmdW5jdGlvbiAoZSkgewogICAgICAgICEoZnVuY3Rpb24gKG8pIHsKICAgICAgICAgIGZ1bmN0aW9uIGkodCkgewogICAgICAgICAgICBmb3IgKHZhciBlLCBuLCByID0gW10sIG8gPSAwLCBpID0gdC5sZW5ndGg7IGkgPiBvOykgZSA9IHQuY2hhckNvZGVBdChvKyspLCBlID49IDU1Mjk2ICYmIDU2MzE5ID49IGUgJiYgaSA+IG8gPyAobiA9IHQuY2hhckNvZGVBdChvKyspLCA1NjMyMCA9PSAoNjQ1MTIgJiBuKSA/IHIucHVzaCgoKDEwMjMgJiBlKSA8PCAxMCkgKyAoMTAyMyAmIG4pICsgNjU1MzYpIDogKHIucHVzaChlKSwgby0tKSkgOiByLnB1c2goZSk7cmV0dXJuIHI7CiAgICAgICAgICB9ZnVuY3Rpb24gcyh0KSB7CiAgICAgICAgICAgIGZvciAodmFyIGUsIG4gPSB0Lmxlbmd0aCwgciA9IC0xLCBvID0gIiI7ICsrciA8IG47KSBlID0gdFtyXSwgZSA+IDY1NTM1ICYmIChlIC09IDY1NTM2LCBvICs9IHcoZSA+Pj4gMTAgJiAxMDIzIHwgNTUyOTYpLCBlID0gNTYzMjAgfCAxMDIzICYgZSksIG8gKz0gdyhlKTtyZXR1cm4gbzsKICAgICAgICAgIH1mdW5jdGlvbiBhKHQpIHsKICAgICAgICAgICAgaWYgKHQgPj0gNTUyOTYgJiYgNTczNDMgPj0gdCkgdGhyb3cgRXJyb3IoIkxvbmUgc3Vycm9nYXRlIFUrIiArIHQudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCkgKyAiIGlzIG5vdCBhIHNjYWxhciB2YWx1ZSIpOwogICAgICAgICAgfWZ1bmN0aW9uIGModCwgZSkgewogICAgICAgICAgICByZXR1cm4gdyh0ID4+IGUgJiA2MyB8IDEyOCk7CiAgICAgICAgICB9ZnVuY3Rpb24gcCh0KSB7CiAgICAgICAgICAgIGlmICgwID09ICg0Mjk0OTY3MTY4ICYgdCkpIHJldHVybiB3KHQpO3ZhciBlID0gIiI7cmV0dXJuIDAgPT0gKDQyOTQ5NjUyNDggJiB0KSA/IGUgPSB3KHQgPj4gNiAmIDMxIHwgMTkyKSA6IDAgPT0gKDQyOTQ5MDE3NjAgJiB0KSA/IChhKHQpLCBlID0gdyh0ID4+IDEyICYgMTUgfCAyMjQpLCBlICs9IGModCwgNikpIDogMCA9PSAoNDI5Mjg3MDE0NCAmIHQpICYmIChlID0gdyh0ID4+IDE4ICYgNyB8IDI0MCksIGUgKz0gYyh0LCAxMiksIGUgKz0gYyh0LCA2KSksIGUgKz0gdyg2MyAmIHQgfCAxMjgpOwogICAgICAgICAgfWZ1bmN0aW9uIHUodCkgewogICAgICAgICAgICBmb3IgKHZhciBlLCBuID0gaSh0KSwgciA9IG4ubGVuZ3RoLCBvID0gLTEsIHMgPSAiIjsgKytvIDwgcjspIGUgPSBuW29dLCBzICs9IHAoZSk7cmV0dXJuIHM7CiAgICAgICAgICB9ZnVuY3Rpb24gZigpIHsKICAgICAgICAgICAgaWYgKHYgPj0gYikgdGhyb3cgRXJyb3IoIkludmFsaWQgYnl0ZSBpbmRleCIpO3ZhciB0ID0gMjU1ICYgbVt2XTtpZiAoKHYrKywgMTI4ID09ICgxOTIgJiB0KSkpIHJldHVybiA2MyAmIHQ7dGhyb3cgRXJyb3IoIkludmFsaWQgY29udGludWF0aW9uIGJ5dGUiKTsKICAgICAgICAgIH1mdW5jdGlvbiBoKCkgewogICAgICAgICAgICB2YXIgdCwgZSwgbiwgciwgbztpZiAodiA+IGIpIHRocm93IEVycm9yKCJJbnZhbGlkIGJ5dGUgaW5kZXgiKTtpZiAodiA9PSBiKSByZXR1cm4gITE7aWYgKCh0ID0gMjU1ICYgbVt2XSwgdisrLCAwID09ICgxMjggJiB0KSkpIHJldHVybiB0O2lmICgxOTIgPT0gKDIyNCAmIHQpKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSBmKCk7aWYgKChvID0gKDMxICYgdCkgPDwgNiB8IGUsIG8gPj0gMTI4KSkgcmV0dXJuIG87dGhyb3cgRXJyb3IoIkludmFsaWQgY29udGludWF0aW9uIGJ5dGUiKTsKICAgICAgICAgICAgfWlmICgyMjQgPT0gKDI0MCAmIHQpKSB7CiAgICAgICAgICAgICAgaWYgKChlID0gZigpLCBuID0gZigpLCBvID0gKDE1ICYgdCkgPDwgMTIgfCBlIDw8IDYgfCBuLCBvID49IDIwNDgpKSByZXR1cm4gYShvKSwgbzt0aHJvdyBFcnJvcigiSW52YWxpZCBjb250aW51YXRpb24gYnl0ZSIpOwogICAgICAgICAgICB9aWYgKDI0MCA9PSAoMjQ4ICYgdCkgJiYgKGUgPSBmKCksIG4gPSBmKCksIHIgPSBmKCksIG8gPSAoMTUgJiB0KSA8PCAxOCB8IGUgPDwgMTIgfCBuIDw8IDYgfCByLCBvID49IDY1NTM2ICYmIDExMTQxMTEgPj0gbykpIHJldHVybiBvO3Rocm93IEVycm9yKCJJbnZhbGlkIFVURi04IGRldGVjdGVkIik7CiAgICAgICAgICB9ZnVuY3Rpb24gbCh0KSB7CiAgICAgICAgICAgIG0gPSBpKHQpLCBiID0gbS5sZW5ndGgsIHYgPSAwO2ZvciAodmFyIGUsIG4gPSBbXTsgKGUgPSBoKCkpICE9PSAhMTspIG4ucHVzaChlKTtyZXR1cm4gcyhuKTsKICAgICAgICAgIH12YXIgZCA9ICJvYmplY3QiID09IHR5cGVvZiByICYmIHIsCiAgICAgICAgICAgICAgeSA9ICJvYmplY3QiID09IHR5cGVvZiBuICYmIG4gJiYgbi5leHBvcnRzID09IGQgJiYgbiwKICAgICAgICAgICAgICBnID0gIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZTsoZy5nbG9iYWwgPT09IGcgfHwgZy53aW5kb3cgPT09IGcpICYmIChvID0gZyk7dmFyIG0sCiAgICAgICAgICAgICAgYiwKICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgIHcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLAogICAgICAgICAgICAgIGsgPSB7IHZlcnNpb246ICIyLjAuMCIsIGVuY29kZTogdSwgZGVjb2RlOiBsIH07aWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgIm9iamVjdCIgPT0gdHlwZW9mIHQuYW1kICYmIHQuYW1kKSB0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGs7CiAgICAgICAgICB9KTtlbHNlIGlmIChkICYmICFkLm5vZGVUeXBlKSBpZiAoeSkgeS5leHBvcnRzID0gaztlbHNlIHsKICAgICAgICAgICAgdmFyIHggPSB7fSwKICAgICAgICAgICAgICAgIEEgPSB4Lmhhc093blByb3BlcnR5O2ZvciAodmFyIF8gaW4gaykgQS5jYWxsKGssIF8pICYmIChkW19dID0ga1tfXSk7CiAgICAgICAgICB9IGVsc2Ugby51dGY4ID0gazsKICAgICAgICB9KSh0aGlzKTsKICAgICAgfSkuY2FsbCh0aGlzLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IHt9KTsKICAgIH0sIHt9XSwgNDY6IFtmdW5jdGlvbiAodCwgZSwgbikgewogICAgICAidXNlIHN0cmljdCI7ZnVuY3Rpb24gcih0KSB7CiAgICAgICAgdmFyIGUgPSAiIjtkbyBlID0gYVt0ICUgY10gKyBlLCB0ID0gTWF0aC5mbG9vcih0IC8gYyk7IHdoaWxlICh0ID4gMCk7cmV0dXJuIGU7CiAgICAgIH1mdW5jdGlvbiBvKHQpIHsKICAgICAgICB2YXIgZSA9IDA7Zm9yIChmID0gMDsgZiA8IHQubGVuZ3RoOyBmKyspIGUgPSBlICogYyArIHBbdC5jaGFyQXQoZildO3JldHVybiBlOwogICAgICB9ZnVuY3Rpb24gaSgpIHsKICAgICAgICB2YXIgdCA9IHIoK25ldyBEYXRlKCkpO3JldHVybiB0ICE9PSBzID8gKHUgPSAwLCBzID0gdCkgOiB0ICsgIi4iICsgcih1KyspOwogICAgICB9Zm9yICh2YXIgcywgYSA9ICIwMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ei1fIi5zcGxpdCgiIiksIGMgPSA2NCwgcCA9IHt9LCB1ID0gMCwgZiA9IDA7IGMgPiBmOyBmKyspIHBbYVtmXV0gPSBmO2kuZW5jb2RlID0gciwgaS5kZWNvZGUgPSBvLCBlLmV4cG9ydHMgPSBpOwogICAgfSwge31dLCA0NzogW2Z1bmN0aW9uICh0LCBlLCBuKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiByKHQsIGUpIHsKICAgICAgICBpZiAoISh0IGluc3RhbmNlb2YgZSkpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICB9ZnVuY3Rpb24gbyh0LCBlLCBuKSB7CiAgICAgICAgcmV0dXJuIHsgbmFtZTogIk5vZGVqc1Byb3RvU3R1YiIsIGluc3RhbmNlOiBuZXcgYSh0LCBlLCBuKSB9OwogICAgICB9T2JqZWN0LmRlZmluZVByb3BlcnR5KG4sICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogITAgfSk7dmFyIGkgPSAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIHQodCwgZSkgewogICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBlLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICAgIHZhciByID0gZVtuXTtyLmVudW1lcmFibGUgPSByLmVudW1lcmFibGUgfHwgITEsIHIuY29uZmlndXJhYmxlID0gITAsICJ2YWx1ZSIgaW4gciAmJiAoci53cml0YWJsZSA9ICEwKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIHIua2V5LCByKTsKICAgICAgICAgIH0KICAgICAgICB9cmV0dXJuIGZ1bmN0aW9uIChlLCBuLCByKSB7CiAgICAgICAgICByZXR1cm4gbiAmJiB0KGUucHJvdG90eXBlLCBuKSwgciAmJiB0KGUsIHIpLCBlOwogICAgICAgIH07CiAgICAgIH0pKCk7blsiZGVmYXVsdCJdID0gbzt2YXIgcyA9IHQoInNvY2tldC5pby1jbGllbnQiKSwKICAgICAgICAgIGEgPSAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIHQoZSwgbiwgbykgewogICAgICAgICAgcih0aGlzLCB0KTt2YXIgaSA9IHRoaXM7dGhpcy5faWQgPSAwLCB0aGlzLl9ydW50aW1lUHJvdG9TdHViVVJMID0gZSwgdGhpcy5fYnVzID0gbiwgdGhpcy5fY29uZmlnID0gbywgdGhpcy5fYnVzLmFkZExpc3RlbmVyKCIqIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgaS5fb3BlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaS5fc29jay5lbWl0KCJtZXNzYWdlIiwgSlNPTi5zdHJpbmdpZnkodCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH1yZXR1cm4gaSh0LCBbeyBrZXk6ICJjb25uZWN0IiwgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgICAgICB2YXIgdCA9IHRoaXM7dC5fb3BlbihmdW5jdGlvbiAoKSB7fSk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiZGlzY29ubmVjdCIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzO3QuX3NvY2sgJiYgdC5fc2VuZENsb3NlKCk7CiAgICAgICAgICB9IH0sIHsga2V5OiAicG9zdE1lc3NhZ2UiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUodCkgewogICAgICAgICAgICB0aGlzLl9zb2NrLnNlbmQoSlNPTi5zdHJpbmdpZnkodCkpOwogICAgICAgICAgfSB9LCB7IGtleTogIl9zZW5kT3BlbiIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0KSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9pZCsrO3ZhciBuID0geyBoZWFkZXI6IHsgaWQ6IGUuX2lkLCB0eXBlOiAib3BlbiIsIGZyb206IGUuX2NvbmZpZy5ydW50aW1lVVJMLCB0bzogIm1uOi9zZXNzaW9uIiwgdG9rZW5JRDogIj8/IiB9IH0sCiAgICAgICAgICAgICAgICByID0gITE7ZS5fc2Vzc2lvbkNhbGxiYWNrID0gZnVuY3Rpb24gKG8pIHsKICAgICAgICAgICAgICAicmVwbHkiID09PSBvLmhlYWRlci50eXBlICYgby5oZWFkZXIuaWQgPT09IG4uaGVhZGVyLmlkICYmIChyID0gITAsICJvayIgPT09IG8uYm9keS5jb2RlID8gKGUuX3NlbmRTdGF0dXMoImNvbm5lY3RlZCIpLCB0KCkpIDogZS5fc2VuZFN0YXR1cygiZGlzY29ubmVjdGVkIiwgby5ib2R5LmRlc2MpKTsKICAgICAgICAgICAgfSwgZS5fc29jay5zZW5kKEpTT04uc3RyaW5naWZ5KG4pKSwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgciB8fCBlLl9zZW5kU3RhdHVzKCJkaXNjb25uZWN0ZWQiLCAiVGltZW91dCBmcm9tIG1uOi9zZXNzaW9uIik7CiAgICAgICAgICAgIH0sIDNlMyk7CiAgICAgICAgICB9IH0sIHsga2V5OiAiX3NlbmRDbG9zZSIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzO3QuX2lkKys7dmFyIGUgPSB7IGhlYWRlcjogeyBpZDogdC5faWQsIHR5cGU6ICJjbG9zZSIsIGZyb206IHQuX2NvbmZpZy5ydW50aW1lVVJMLCB0bzogIm1uOi9zZXNzaW9uIiwgdG9rZW5JRDogIj8/IiB9IH07dC5fc29jay5zZW5kKEpTT04uc3RyaW5naWZ5KGUpKTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfc2VuZFN0YXR1cyIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0LCBlKSB7CiAgICAgICAgICAgIHZhciBuID0gdGhpcywKICAgICAgICAgICAgICAgIHIgPSB7IGhlYWRlcjogeyB0eXBlOiAidXBkYXRlIiwgZnJvbTogbi5fcnVudGltZVByb3RvU3R1YlVSTCwgdG86IG4uX3J1bnRpbWVQcm90b1N0dWJVUkwgKyAiL3N0YXR1cyIgfSwgYm9keTogeyB2YWx1ZTogdCB9IH07ZSAmJiAoci5ib2R5LmRlc2MgPSBlKSwgbi5fYnVzLnBvc3RNZXNzYWdlKHIpOwogICAgICAgICAgfSB9LCB7IGtleTogIl93YWl0UmVhZHkiLCB2YWx1ZTogZnVuY3Rpb24gdmFsdWUodCkgewogICAgICAgICAgICB2YXIgZSA9IHRoaXM7MSA9PT0gZS5fc29jay5yZWFkeVN0YXRlID8gdCgpIDogc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgZS5fd2FpdFJlYWR5KHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gfSwgeyBrZXk6ICJfb3BlbiIsIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0KSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcztlLl9zb2NrID8gZS5fd2FpdFJlYWR5KHQpIDogKGUuX3NvY2sgPSBzKGUuX2NvbmZpZy51cmwsIHsgZm9yY2VOZXc6ICEwIH0pLCBlLl9zb2NrLm9uKCJjb25uZWN0IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGUuX3NlbmRPcGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHQoKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSksIGUuX3NvY2sub24oIm1lc3NhZ2UiLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIGlmICgib2JqZWN0IiAhPSB0eXBlb2YgdCkgdHJ5IHsKICAgICAgICAgICAgICAgIHQgPSBKU09OLnBhcnNlKHQpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICAgICAgICAgIHQgPSB7fTsKICAgICAgICAgICAgICB9dC5oYXNPd25Qcm9wZXJ0eSgiaGVhZGVyIikgJiYgdC5oZWFkZXIuaGFzT3duUHJvcGVydHkoImZyb20iKSAmJiAibW46L3Nlc3Npb24iID09PSB0LmhlYWRlci5mcm9tID8gZS5fc2Vzc2lvbkNhbGxiYWNrICYmIGUuX3Nlc3Npb25DYWxsYmFjayh0KSA6IGUuX2J1cy5wb3N0TWVzc2FnZSh0KTsKICAgICAgICAgICAgfSksIGUuX3NvY2sub24oImRpc2Nvbm5lY3QiLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIGUuX3NlbmRTdGF0dXMoImRpc2Nvbm5lY3RlZCIsIHQpLCBkZWxldGUgZS5fc29jazsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSB9LCB7IGtleTogImNvbmZpZyIsIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnOwogICAgICAgICAgfSB9XSksIHQ7CiAgICAgIH0pKCk7ZS5leHBvcnRzID0gblsiZGVmYXVsdCJdOwogICAgfSwgeyAic29ja2V0LmlvLWNsaWVudCI6IDMzIH1dIH0sIHt9LCBbNDddKSg0Nyk7Cn0pOwovLyB2ZXJzaW9uOiAwLjEuMAoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0se31dfSx7fSxbMV0pKDEpCn0pOw==","sourceCodeClassname":"NodejsProtoStub","encoding":"Base64","signature":""},"language":"Javascript ECMA5","signature":"","messageSchemas":"","configuration":{"url":"ws://msg-node.localhost:9080"},"constraints":"","hypertyCapabilities":"","protocolCapabilities":"","policies":"","dataObjects":[]}}
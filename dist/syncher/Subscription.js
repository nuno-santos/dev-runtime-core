"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),Subscription=function(){function e(r,s,t,i,a){(0,_classCallCheck3.default)(this,e);var l=this,n=t+"/children/",o=t+"/changes";l._deleteListener=r.addListener(o,function(e){if("delete"===e.type){console.log("Subscription-DELETE: ",e);var i={type:"delete",from:e.from,to:s,body:{identity:e.body.identity,resource:t}};r.postMessage(i,function(e){console.log("Subscription-DELETE-REPLY: ",e),200===e.body.code&&l._releaseListeners()})}}),a?l._changeListener=r.addPublish(o):l._changeListener=r.addForward(o,s),l._childrenListeners=[],i.forEach(function(e){var t=n+e,i=r.addPublish(t);if(l._childrenListeners.push(i),!a){var o=r.addForward(t,s);l._childrenListeners.push(o)}})}return(0,_createClass3.default)(e,[{key:"_releaseListeners",value:function(){var e=this;e._deleteListener.remove(),e._changeListener.remove(),e._childrenListeners.forEach(function(e){e.remove()})}}]),e}();exports.default=Subscription,module.exports=exports.default;
//# sourceMappingURL=Subscription.js.map

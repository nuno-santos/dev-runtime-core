"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_AdvancedCondition=require("../conditions/AdvancedCondition"),_AdvancedCondition2=_interopRequireDefault(_AdvancedCondition),_Condition=require("../conditions/Condition"),_Condition2=_interopRequireDefault(_Condition),_Policy2=require("../Policy"),_Policy3=_interopRequireDefault(_Policy2),_Rule=require("../Rule"),_Rule2=_interopRequireDefault(_Rule),_SubscriptionCondition=require("../conditions/SubscriptionCondition"),_SubscriptionCondition2=_interopRequireDefault(_SubscriptionCondition),UserPolicy=function(e){function i(e,t,r,n){return(0,_classCallCheck3.default)(this,i),n||(n="denyOverrides"),(0,_possibleConstructorReturn3.default)(this,(0,_getPrototypeOf2.default)(i).call(this,e,t,r,n))}return(0,_inherits3.default)(i,e),(0,_createClass3.default)(i,[{key:"createRule",value:function(e,i,t,r,n,o){if(!(t instanceof _Condition2.default))switch(e){case"advanced":t=new _AdvancedCondition2.default(t);case"simple":t=new _Condition2.default(t[0],t[1],t[2]);break;case"subscription":t=new _SubscriptionCondition2.default(t[0],t[1],t[2])}void 0===o&&(o=this.getLastPriority()+1);var u=new _Rule2.default(i,t,o,r,n);this.rules.push(u)}},{key:"deleteRule",value:function(e){var i=this.rules.indexOf(e);this.rules.splice(i,1)}},{key:"getLastPriority",value:function(){var e=[];if(0!==this.rules.length){for(var i in this.rules)e.push(this.rules[i].priority);return Math.max.apply(Math,e)}return-1}},{key:"getRuleByPriority",value:function(e){for(var i in this.rules)if(this.rules[i].priority==e)return this.rules[i];throw Error("Rule with priority "+e+" does not exist!")}},{key:"hasSubscriptionRule",value:function(){for(var e in this.rules)if("global"===this.rules[e].scope){if(this.rules[e].condition instanceof _SubscriptionCondition2.default)return!0;if(this.rules[e].condition instanceof _AdvancedCondition2.default)for(var i in this.rules[e].condition.condition)if(this.rules[e].condition.condition[i]instanceof _SubscriptionCondition2.default)return!0}return!1}},{key:"sortRules",value:function(){return this.rules.sort(function(e,i){var t=e.priority,r=i.priority;return t<r?-1:t>r?1:0})}}]),i}(_Policy3.default);exports.default=UserPolicy,module.exports=exports.default;
//# sourceMappingURL=UserPolicy.js.map

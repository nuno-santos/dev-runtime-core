"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_PEP=require("./PEP"),_PEP2=_interopRequireDefault(_PEP),_PDP=require("./PDP"),_PDP2=_interopRequireDefault(_PDP),_UserPolicy=require("./policies/UserPolicy"),_UserPolicy2=_interopRequireDefault(_UserPolicy),PolicyEngine=function(){function e(t){(0,_classCallCheck3.default)(this,e),this.context=t,t.policyEngine=this,t.loadActivePolicy(),t.loadGroups(),t.loadSPPolicies(),t.loadUserPolicies(),this.pdp=new _PDP2.default(t),this.pep=new _PEP2.default(t)}return(0,_createClass3.default)(e,[{key:"addPolicy",value:function(e,t,i){if("SERVICE_PROVIDER"===e)this.context.serviceProviderPolicies[t]=i,this.context.savePolicies(e);else{if("USER"!==e)throw Error("Unknown policy source: "+e);i||(i=new _UserPolicy2.default(t,[],[])),this.context.userPolicies[t]=i,this.context.savePolicies(e)}}},{key:"removePolicy",value:function(e,t){if("*"===e)this.context.serviceProviderPolicies={},this.context.userPolicies={},this.context.activeUserPolicy=void 0;else if("SERVICE_PROVIDER"===e)delete this.context.serviceProviderPolicies[t];else{if("USER"!==e)throw Error("Unknown policy source: "+e);delete this.context.userPolicies[t],t===this.context.activeUserPolicy&&(this.context.activeUserPolicy=void 0)}this.context.savePolicies("USER"),this.context.savePolicies("SERVICE_PROVIDER"),this.context.saveActivePolicy()}},{key:"removeRule",value:function(e,t){delete this.context.userPolicies[e][t.scope][t.target][t.condition]}},{key:"authorise",value:function(e){var t=this;return t.context.authorise(e)}},{key:"getGroupsNames",value:function(){var e=this.context.groups,t=[];if(void 0!==e)for(var i in e)t.push(i);return t}},{key:"getGroup",value:function(e){var t=this.context.groups,i=[];return void 0!==t[e]&&(i=t[e]),i}},{key:"createGroup",value:function(e){this.context.groups[e]=[],this.context.saveGroups()}},{key:"deleteGroup",value:function(e){delete this.context.groups[e],this.context.saveGroups()}},{key:"addToGroup",value:function(e,t){var i=this.context.groups;if(void 0===i[e])throw Error('Group "'+e+'" does not exist!');i[e].indexOf(t)===-1&&(i[e].push(t),this.context.saveGroups())}},{key:"removeFromGroup",value:function(e,t){var i=this.context.groups[e];i.splice(i.indexOf(t),1),this.context.saveGroups()}}]),e}();exports.default=PolicyEngine,module.exports=exports.default;
//# sourceMappingURL=PolicyEngine.js.map

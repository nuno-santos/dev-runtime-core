"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2);require("babel-polyfill");var _Registry=require("../registry/Registry"),_Registry2=_interopRequireDefault(_Registry),_IdentityModule=require("../identity/IdentityModule"),_IdentityModule2=_interopRequireDefault(_IdentityModule),_PolicyEngine=require("../policy/PolicyEngine"),_PolicyEngine2=_interopRequireDefault(_PolicyEngine),_MessageBus=require("../bus/MessageBus"),_MessageBus2=_interopRequireDefault(_MessageBus),_Loader=require("./Loader"),_Loader2=_interopRequireDefault(_Loader),_SyncherManager=require("../syncher/SyncherManager"),_SyncherManager2=_interopRequireDefault(_SyncherManager),_RuntimeCoreCtx=require("../policy/context/RuntimeCoreCtx"),_RuntimeCoreCtx2=_interopRequireDefault(_RuntimeCoreCtx),RuntimeUA=function(){function e(r,t){if((0,_classCallCheck3.default)(this,e),!r)throw new Error("The sandbox factory is a needed parameter");if(!t)throw new Error("You need the domain of runtime");var i=this;i.runtimeFactory=r,i.runtimeCatalogue=r.createRuntimeCatalogue(),i.loader=new _Loader2.default;var n="runtime://"+t+"/"+Math.floor(1e4*Math.random()+1);i.runtimeURL=n,i.domain=t,i.runtimeCatalogue.runtimeURL=n,i.identityModule=new _IdentityModule2.default(n);var a=r.createAppSandbox();i.registry=new _Registry2.default(n,a,i.identityModule,i.runtimeCatalogue),i.registry.loader=i.loader,i.messageBus=new _MessageBus2.default(i.registry),i.policyEngine=new _PolicyEngine2.default(new _RuntimeCoreCtx2.default(i.identityModule,i.registry)),i.messageBus.pipeline.handlers=[function(e){i.policyEngine.authorise(e.msg).then(function(r){e.msg=r,e.next()}).catch(function(r){console.error(r),e.fail(r)})}],a.addListener("*",function(e){i.messageBus.postMessage(e)}),i.registry.messageBus=i.messageBus,i.identityModule.registry=i.registry,r.messageBus=i.messageBus,i.syncherManager=new _SyncherManager2.default(i.runtimeURL,i.messageBus,i.registry,i.runtimeCatalogue),i.loader.registry=i.registry,i.loader.runtimeURL=i.runtimeURL,i.loader.messageBus=i.messageBus,i.loader.runtimeCatalogue=i.runtimeCatalogue,i.loader.runtimeFactory=i.runtimeFactory}return(0,_createClass3.default)(e,[{key:"discoverHiperty",value:function(e){}},{key:"registerHyperty",value:function(e,r){}},{key:"loadHyperty",value:function(e){var r=this;if(!e)throw new Error("Hyperty descriptor url parameter is needed");return new _promise2.default(function(t,i){r.loader.loadHyperty(e).then(function(e){t(e)}).catch(function(e){i(e)})})}},{key:"loadStub",value:function(e){var r=this;if(!e)throw new Error("ProtoStub descriptor url parameter is needed");return new _promise2.default(function(t,i){r.loader.loadStub(e).then(function(e){t(e)}).catch(function(e){i(e)})})}},{key:"loadIdpProxy",value:function(e){var r=this;if(!e)throw new Error("The IDP Proxy URL is a needed parameter, could be a DOMAIN or a URL");return new _promise2.default(function(t,i){r.loader.loadIdpProxy(e).then(function(e){t(e)}).catch(function(e){i(e)})})}},{key:"close",value:function(){var e=this;return console.info("Unregister all hyperties"),new _promise2.default(function(r,t){e.registry.unregisterAllHyperties().then(function(e){console.info("All the hyperties are unregisted with Success:",e),r(!0)}).catch(function(e){console.error("Failed to unregister the hyperties",e),t(!1)})})}},{key:"checkForUpdate",value:function(e){}}]),e}();exports.default=RuntimeUA,module.exports=exports.default;
//# sourceMappingURL=RuntimeUA.js.map

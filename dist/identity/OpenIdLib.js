"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),OpenIdLib=function(){function e(t,o){(0,_classCallCheck3.default)(this,e);var n=this;switch(n.clientID=o,n.identityProvider=t,t){case"google":var a=new GoogleInfo;n.info=a;break;case"facebook":var r=new FacebookInfo;n.info=r;break;case"windows":var s=new MicrosoftInfo;n.info=s}}return(0,_createClass3.default)(e,[{key:"openPopup",value:function(){var e=this,t=(e.info.REDIRECT,e.info.URL),o=void 0,n=void 0,a=void 0;return new _promise2.default(function(r,s){function i(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o="[\\#&?]"+t+"=([^&#]*)",n=new RegExp(o),a=n.exec(e);return null===a?"":a[1]}var c=window.open(t,"openIDrequest","width=800, height=600"),u=window.setInterval(function(){try{c.closed&&(s("Some error occured."),clearInterval(u));var t=document.URL;if(c.document.URL.indexOf("REDIRECT")!==-1||c.document.URL.indexOf(t)!==-1){window.clearInterval(u);var l=c.document.URL;"windows"===e.identityProvider?!function(){var t=i(l,"code");i(l,"session_state"),e.info.TOKENEND+"redirect_uri="+e.info.REDIRECT+"&grant_type=authorization_code&client_id="+e.info.CLIENTID+"&code="+t;c.close();var o=new XMLHttpRequest;o.open("POST",e.info.TOKENEND,!0),o.setRequestHeader("Access-Control-Allow-Origin","*");var n=new FormData;n.append("redirect_uri",e.info.REDIRECT),n.append("grant_type","authorization_code"),n.append("client_id",e.info.CLIENTID),n.append("code",t),o.onreadystatechange=function(e){4===o.readyState&&(200===o.status?r("null"):s(400===o.status?"There was an error processing the token":"something else other than 200 was returned"))},o.send(n)}():(o=i(l,"access_token"),n=i(l,"token_type"),a=i(l,"expires_in"),c.close(),"facebook"===e.identityProvider&&(e.info.VALIDURL="https://graph.facebook.com/debug_token?input_token="+o+"&access_token="),r(o))}}catch(e){}},1e3)})}},{key:"validateToken",value:function(e){var t=this,o=void 0,n=t.info.VALIDURL;return new _promise2.default(function(t,a){var r=new XMLHttpRequest;r.open("GET",n+e,!0),r.onreadystatechange=function(n){4===r.readyState&&(200===r.status?(o=JSON.parse(r.responseText),t({token:e,tokenID:o})):a(400===r.status?"There was an error processing the token":"something else other than 200 was returned"))},r.send()})}},{key:"getInfoToken",value:function(e,t){var o=this;return new _promise2.default(function(n,a){var r=o.info.USERINFURL,s=new XMLHttpRequest;s.open("GET",r+e,!0),s.onreadystatechange=function(o){if(4===s.readyState)if(200===s.status){var r=JSON.parse(s.responseText),i=r.email,c="user://"+i.substring(i.indexOf("@")+1,i.length)+"/"+i.substring(0,i.indexOf("@")),u={identity:c,token:r,accessToken:e,idToken:t,infoToken:r,idp:"google"};n(u)}else a(400===s.status?"There was an error processing the token":"something else other than 200 was returned")},s.send()})}}]),e}(),GoogleInfo=function e(){(0,_classCallCheck3.default)(this,e);var t=this;t.OAUTHURL="https://accounts.google.com/o/oauth2/auth?",t.SCOPE="email%20profile",t.CLIENTID="808329566012-tqr8qoh111942gd2kg007t0s8f277roi.apps.googleusercontent.com",t.REDIRECT=document.URL,t.TYPE="token",t.VALIDURL="https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=",t.USERINFURL="https://www.googleapis.com/oauth2/v1/userinfo?access_token=",t.URL=t.OAUTHURL+"scope="+t.SCOPE+"&client_id="+t.CLIENTID+"&redirect_uri="+t.REDIRECT+"&response_type="+t.TYPE},FacebookInfo=function e(){(0,_classCallCheck3.default)(this,e);var t=this;t.OAUTHURL="https://www.facebook.com/dialog/oauth?",t.CLIENTID=655302667942219,t.REDIRECT=document.URL,t.TYPE="token",t.VALIDURL="https://graph.facebook.com/debug_token?input_token=",t.USERINFURL="https://graph.facebook.com/v2.5/me?fields=id,name,email,picture&access_token=",t.URL=t.OAUTHURL+"client_id="+t.CLIENTID+"&redirect_uri="+t.REDIRECT+"&response_type="+t.TYPE},MicrosoftInfo=function e(){(0,_classCallCheck3.default)(this,e);var t=this;t.OAUTHURL="https://login.microsoftonline.com/common/oauth2/authorize?",t.CLIENTID="7e2f3589-4b38-4b1c-a321-c9251de00ef2",t.REDIRECT=document.URL,t.TYPE="code",t.TOKENEND="https://login.microsoftonline.com/3fa4042c-7c4d-4382-aba8-fc8ec61103a4/oauth2/token",t.AUTHEND="https://login.microsoftonline.com/3fa4042c-7c4d-4382-aba8-fc8ec61103a4/oauth2/authorize?",t.URL=t.AUTHEND+"response_type="+t.TYPE+"&client_id="+t.CLIENTID};exports.default=OpenIdLib,module.exports=exports.default;
//# sourceMappingURL=OpenIdLib.js.map

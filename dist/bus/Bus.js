"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),Bus=function(){function e(){(0,_classCallCheck3.default)(this,e);var s=this;s._msgId=0,s._subscriptions={},s._responseTimeOut=5e3,s._responseCallbacks={},s._registerExternalListener()}return(0,_createClass3.default)(e,[{key:"addListener",value:function(e,s){var t=this,n=new MsgListener(t._subscriptions,e,s),i=t._subscriptions[e];return i||(i=[],t._subscriptions[e]=i),i.push(n),n}},{key:"addResponseListener",value:function(e,s,t){this._responseCallbacks[e+s]=t}},{key:"removeResponseListener",value:function(e,s){delete this._responseCallbacks[e+s]}},{key:"removeAllListenersOf",value:function(e){delete this._subscriptions[e]}},{key:"bind",value:function(e,s,t){var n=this,i=this,r=i.addListener(e,function(e){t.postMessage(e)}),a=t.addListener(s,function(e){i.postMessage(e)});return{thisListener:r,targetListener:a,unbind:function(){n.thisListener.remove(),n.targetListener.remove()}}}},{key:"_publishOnDefault",value:function(e){var s=this._subscriptions["*"];s&&this._publishOn(s,e)}},{key:"_publishOn",value:function(e,s){e.forEach(function(e){e._callback(s)})}},{key:"_responseCallback",value:function(e,s){var t=this;s&&!function(){var n=e.from+e.id;t._responseCallbacks[n]=s,setTimeout(function(){var s=t._responseCallbacks[n];if(delete t._responseCallbacks[n],s){var i={id:e.id,type:"response",body:{code:408,desc:"Response timeout!",value:e}};s(i)}},t._responseTimeOut)}()}},{key:"_onResponse",value:function(e){var s=this;if("response"===e.type){var t=e.to+e.id,n=s._responseCallbacks[t];if(e.body.code>=200&&delete s._responseCallbacks[t],n)return n(e),!0}return!1}},{key:"_onMessage",value:function(e){var s=this;if(!s._onResponse(e)){var t=s._subscriptions[e.to];t?s._publishOn(t,e):s._publishOnDefault(e)}}},{key:"_genId",value:function(e){e.id&&0!==e.id||(this._msgId++,e.id=this._msgId)}},{key:"postMessage",value:function(e,s){}},{key:"_onPostMessage",value:function(e){}},{key:"_registerExternalListener",value:function(){}}]),e}(),MsgListener=function(){function e(s,t,n){(0,_classCallCheck3.default)(this,e);var i=this;i._subscriptions=s,i._url=t,i._callback=n}return(0,_createClass3.default)(e,[{key:"remove",value:function(){var e=this,s=e._subscriptions[e._url];if(s){var t=s.indexOf(e);s.splice(t,1),0===s.length&&delete e._subscriptions[e._url]}}},{key:"url",get:function(){return this._url}}]),e}();exports.default=Bus,module.exports=exports.default;
//# sourceMappingURL=Bus.js.map

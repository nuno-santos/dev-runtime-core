"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_Bus2=require("./Bus"),_Bus3=_interopRequireDefault(_Bus2),_Pipeline=require("./Pipeline"),_Pipeline2=_interopRequireDefault(_Pipeline),MessageBus=function(e){function r(e){(0,_classCallCheck3.default)(this,r);var t=(0,_possibleConstructorReturn3.default)(this,(0,_getPrototypeOf2.default)(r).call(this));return t._registry=e,t._forwards={},t._pipeline=new _Pipeline2.default(function(e){console.log("PIPELINE-ERROR: ",(0,_stringify2.default)(e))}),t}return(0,_inherits3.default)(r,e),(0,_createClass3.default)(r,[{key:"postMessage",value:function(e,r){var t=this;return t._genId(e),t._pipeline.process(e,function(s){if(t._responseCallback(e,r),!t._onResponse(s)){var i=t._subscriptions[s.to];i?t._publishOn(i,s):t._onPostMessage(s)}}),e.id}},{key:"addPublish",value:function(e){var r=this,t=this,s=t._forwards[e];if(!s){var i=t.addListener(e,function(r){console.log("MB-PUBLISH: ( "+e+" )"),t._onPostMessage(r)});s={counter:0,fl:i,remove:function(){r.counter--,0===r.counter&&(r.fl.remove(),delete t._forwards[e])}},t._forwards[e]=s}return s.counter++,s}},{key:"addForward",value:function(e,r){var t=this;return t.addListener(e,function(s){console.log("MB-FORWARD: ( "+e+" to "+r+" )"),t.forward(r,s)})}},{key:"forward",value:function(e,r){var t=this,s=t._subscriptions[e];s&&t._publishOn(s,r)}},{key:"_onPostMessage",value:function(e){var r=this;r._registry.resolve(e.to).then(function(t){r.forward(t,e)}).catch(function(e){console.log("RESOLVE-ERROR: ",e)})}},{key:"pipeline",get:function(){return this._pipeline}}]),r}(_Bus3.default);exports.default=MessageBus,module.exports=exports.default;
//# sourceMappingURL=MessageBus.js.map
